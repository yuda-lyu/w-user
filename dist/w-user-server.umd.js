/*!
 * w-user-server v1.0.12
 * (c) 2018-2019 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("events"),require("dayjs"),require("@hapi/hapi"),require("mongodb"),require("stream"),require("nodemailer")):"function"==typeof define&&define.amd?define(["events","dayjs","@hapi/hapi","mongodb","stream","nodemailer"],t):(e=e||self)["w-user-server"]=t(e.events,e.dayjs,e["@hapi/hapi"],e.mongodb,e.stream,e.nodemailer)}(this,(function(e,t,r,n,o,a){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,n=n&&n.hasOwnProperty("default")?n.default:n,o=o&&o.hasOwnProperty("default")?o.default:o,a=a&&a.hasOwnProperty("default")?a.default:a;var i=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e};function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}function s(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){u(a,n,o,i,c,"next",e)}function c(e){u(a,n,o,i,c,"throw",e)}i(void 0)}))}}var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function f(e,t){return e(t={exports:{}},t.exports),t.exports}var p=f((function(e){var t=function(e){var t,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function s(e,t,r,n){var o=t&&t.prototype instanceof y?t:y,a=Object.create(o.prototype),i=new E(n||[]);return a._invoke=function(e,t,r){var n=f;return function(o,a){if(n===v)throw new Error("Generator is already running");if(n===h){if("throw"===o)throw a;return A()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var c=O(i,r);if(c){if(c===d)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=v;var u=l(e,t,r);if("normal"===u.type){if(n=r.done?h:p,u.arg===d)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=h,r.method="throw",r.arg=u.arg)}}}(e,r,i),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var f="suspendedStart",p="suspendedYield",v="executing",h="completed",d={};function y(){}function g(){}function b(){}var m={};m[a]=function(){return this};var w=Object.getPrototypeOf,j=w&&w(w(C([])));j&&j!==r&&n.call(j,a)&&(m=j);var x=b.prototype=y.prototype=Object.create(m);function k(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function _(e){var t;this._invoke=function(r,o){function a(){return new Promise((function(t,a){!function t(r,o,a,i){var u=l(e[r],e,o);if("throw"!==u.type){var s=u.arg,f=s.value;return f&&"object"===c(f)&&n.call(f,"__await")?Promise.resolve(f.__await).then((function(e){t("next",e,a,i)}),(function(e){t("throw",e,a,i)})):Promise.resolve(f).then((function(e){s.value=e,a(s)}),(function(e){return t("throw",e,a,i)}))}i(u.arg)}(r,o,t,a)}))}return t=t?t.then(a,a):a()}}function O(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method))return d;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var o=l(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,d;var a=o.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,d):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function C(e){if(e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}return{next:A}}function A(){return{value:t,done:!0}}return g.prototype=x.constructor=b,b.constructor=g,b[u]=g.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},k(_.prototype),_.prototype[i]=function(){return this},e.AsyncIterator=_,e.async=function(t,r,n,o){var a=new _(s(t,r,n,o));return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(x),x[u]="Generator",x[a]=function(){return this},x.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=C,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;M(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:C(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),d}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));function v(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,o)}var h=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){v(a,n,o,i,c,"next",e)}function c(e){v(a,n,o,i,c,"throw",e)}i(void 0)}))}};var d=function(){this.__data__=[],this.size=0};var y=function(e,t){return e===t||e!=e&&t!=t};var g=function(e,t){for(var r=e.length;r--;)if(y(e[r][0],t))return r;return-1},b=Array.prototype.splice;var m=function(e){var t=this.__data__,r=g(t,e);return!(r<0)&&(r==t.length-1?t.pop():b.call(t,r,1),--this.size,!0)};var w=function(e){var t=this.__data__,r=g(t,e);return r<0?void 0:t[r][1]};var j=function(e){return g(this.__data__,e)>-1};var x=function(e,t){var r=this.__data__,n=g(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function k(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}k.prototype.clear=d,k.prototype.delete=m,k.prototype.get=w,k.prototype.has=j,k.prototype.set=x;var _=k;var O=function(){this.__data__=new _,this.size=0};var S=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var M=function(e){return this.__data__.get(e)};var E=function(e){return this.__data__.has(e)},C="object"==c(l)&&l&&l.Object===Object&&l,A="object"==("undefined"==typeof self?"undefined":c(self))&&self&&self.Object===Object&&self,P=C||A||Function("return this")(),L=P.Symbol,B=Object.prototype,W=B.hasOwnProperty,T=B.toString,N=L?L.toStringTag:void 0;var U=function(e){var t=W.call(e,N),r=e[N];try{e[N]=void 0;var n=!0}catch(e){}var o=T.call(e);return n&&(t?e[N]=r:delete e[N]),o},R=Object.prototype.toString;var D=function(e){return R.call(e)},z="[object Null]",H="[object Undefined]",I=L?L.toStringTag:void 0;var F=function(e){return null==e?void 0===e?H:z:I&&I in Object(e)?U(e):D(e)};var G=function(e){var t=c(e);return null!=e&&("object"==t||"function"==t)},Y="[object AsyncFunction]",$="[object Function]",V="[object GeneratorFunction]",q="[object Proxy]";var Z,J=function(e){if(!G(e))return!1;var t=F(e);return t==$||t==V||t==Y||t==q},X=P["__core-js_shared__"],K=(Z=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||""))?"Symbol(src)_1."+Z:"";var Q=function(e){return!!K&&K in e},ee=Function.prototype.toString;var te=function(e){if(null!=e){try{return ee.call(e)}catch(e){}try{return e+""}catch(e){}}return""},re=/^\[object .+?Constructor\]$/,ne=Function.prototype,oe=Object.prototype,ae=ne.toString,ie=oe.hasOwnProperty,ce=RegExp("^"+ae.call(ie).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ue=function(e){return!(!G(e)||Q(e))&&(J(e)?ce:re).test(te(e))};var se=function(e,t){return null==e?void 0:e[t]};var le=function(e,t){var r=se(e,t);return ue(r)?r:void 0},fe=le(P,"Map"),pe=le(Object,"create");var ve=function(){this.__data__=pe?pe(null):{},this.size=0};var he=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},de="__lodash_hash_undefined__",ye=Object.prototype.hasOwnProperty;var ge=function(e){var t=this.__data__;if(pe){var r=t[e];return r===de?void 0:r}return ye.call(t,e)?t[e]:void 0},be=Object.prototype.hasOwnProperty;var me=function(e){var t=this.__data__;return pe?void 0!==t[e]:be.call(t,e)},we="__lodash_hash_undefined__";var je=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=pe&&void 0===t?we:t,this};function xe(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}xe.prototype.clear=ve,xe.prototype.delete=he,xe.prototype.get=ge,xe.prototype.has=me,xe.prototype.set=je;var ke=xe;var _e=function(){this.size=0,this.__data__={hash:new ke,map:new(fe||_),string:new ke}};var Oe=function(e){var t=c(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Se=function(e,t){var r=e.__data__;return Oe(t)?r["string"==typeof t?"string":"hash"]:r.map};var Me=function(e){var t=Se(this,e).delete(e);return this.size-=t?1:0,t};var Ee=function(e){return Se(this,e).get(e)};var Ce=function(e){return Se(this,e).has(e)};var Ae=function(e,t){var r=Se(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Pe(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Pe.prototype.clear=_e,Pe.prototype.delete=Me,Pe.prototype.get=Ee,Pe.prototype.has=Ce,Pe.prototype.set=Ae;var Le=Pe,Be=200;var We=function(e,t){var r=this.__data__;if(r instanceof _){var n=r.__data__;if(!fe||n.length<Be-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Le(n)}return r.set(e,t),this.size=r.size,this};function Te(e){var t=this.__data__=new _(e);this.size=t.size}Te.prototype.clear=O,Te.prototype.delete=S,Te.prototype.get=M,Te.prototype.has=E,Te.prototype.set=We;var Ne=Te;var Ue=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e},Re=function(){try{var e=le(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();var De=function(e,t,r){"__proto__"==t&&Re?Re(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r},ze=Object.prototype.hasOwnProperty;var He=function(e,t,r){var n=e[t];ze.call(e,t)&&y(n,r)&&(void 0!==r||t in e)||De(e,t,r)};var Ie=function(e,t,r,n){var o=!r;r||(r={});for(var a=-1,i=t.length;++a<i;){var c=t[a],u=n?n(r[c],e[c],c,r,e):void 0;void 0===u&&(u=e[c]),o?De(r,c,u):He(r,c,u)}return r};var Fe=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var Ge=function(e){return null!=e&&"object"==c(e)},Ye="[object Arguments]";var $e=function(e){return Ge(e)&&F(e)==Ye},Ve=Object.prototype,qe=Ve.hasOwnProperty,Ze=Ve.propertyIsEnumerable,Je=$e(function(){return arguments}())?$e:function(e){return Ge(e)&&qe.call(e,"callee")&&!Ze.call(e,"callee")},Xe=Array.isArray;var Ke=function(){return!1},Qe=f((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?P.Buffer:void 0,a=(o?o.isBuffer:void 0)||Ke;e.exports=a})),et=9007199254740991,tt=/^(?:0|[1-9]\d*)$/;var rt=function(e,t){var r=c(e);return!!(t=null==t?et:t)&&("number"==r||"symbol"!=r&&tt.test(e))&&e>-1&&e%1==0&&e<t},nt=9007199254740991;var ot=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=nt},at={};at["[object Float32Array]"]=at["[object Float64Array]"]=at["[object Int8Array]"]=at["[object Int16Array]"]=at["[object Int32Array]"]=at["[object Uint8Array]"]=at["[object Uint8ClampedArray]"]=at["[object Uint16Array]"]=at["[object Uint32Array]"]=!0,at["[object Arguments]"]=at["[object Array]"]=at["[object ArrayBuffer]"]=at["[object Boolean]"]=at["[object DataView]"]=at["[object Date]"]=at["[object Error]"]=at["[object Function]"]=at["[object Map]"]=at["[object Number]"]=at["[object Object]"]=at["[object RegExp]"]=at["[object Set]"]=at["[object String]"]=at["[object WeakMap]"]=!1;var it=function(e){return Ge(e)&&ot(e.length)&&!!at[F(e)]};var ct=function(e){return function(t){return e(t)}},ut=f((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r&&C.process,a=function(){try{var e=n&&n.require&&n.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a})),st=ut&&ut.isTypedArray,lt=st?ct(st):it,ft=Object.prototype.hasOwnProperty;var pt=function(e,t){var r=Xe(e),n=!r&&Je(e),o=!r&&!n&&Qe(e),a=!r&&!n&&!o&&lt(e),i=r||n||o||a,c=i?Fe(e.length,String):[],u=c.length;for(var s in e)!t&&!ft.call(e,s)||i&&("length"==s||o&&("offset"==s||"parent"==s)||a&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||rt(s,u))||c.push(s);return c},vt=Object.prototype;var ht=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||vt)};var dt=function(e,t){return function(r){return e(t(r))}},yt=dt(Object.keys,Object),gt=Object.prototype.hasOwnProperty;var bt=function(e){if(!ht(e))return yt(e);var t=[];for(var r in Object(e))gt.call(e,r)&&"constructor"!=r&&t.push(r);return t};var mt=function(e){return null!=e&&ot(e.length)&&!J(e)};var wt=function(e){return mt(e)?pt(e):bt(e)};var jt=function(e,t){return e&&Ie(t,wt(t),e)};var xt=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t},kt=Object.prototype.hasOwnProperty;var _t=function(e){if(!G(e))return xt(e);var t=ht(e),r=[];for(var n in e)("constructor"!=n||!t&&kt.call(e,n))&&r.push(n);return r};var Ot=function(e){return mt(e)?pt(e,!0):_t(e)};var St=function(e,t){return e&&Ie(t,Ot(t),e)},Mt=f((function(e,t){var r=t&&!t.nodeType&&t,n=r&&e&&!e.nodeType&&e,o=n&&n.exports===r?P.Buffer:void 0,a=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=a?a(r):new e.constructor(r);return e.copy(n),n}}));var Et=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t};var Ct=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var i=e[r];t(i,r,e)&&(a[o++]=i)}return a};var At=function(){return[]},Pt=Object.prototype.propertyIsEnumerable,Lt=Object.getOwnPropertySymbols,Bt=Lt?function(e){return null==e?[]:(e=Object(e),Ct(Lt(e),(function(t){return Pt.call(e,t)})))}:At;var Wt=function(e,t){return Ie(e,Bt(e),t)};var Tt=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e},Nt=dt(Object.getPrototypeOf,Object),Ut=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Tt(t,Bt(e)),e=Nt(e);return t}:At;var Rt=function(e,t){return Ie(e,Ut(e),t)};var Dt=function(e,t,r){var n=t(e);return Xe(e)?n:Tt(n,r(e))};var zt=function(e){return Dt(e,wt,Bt)};var Ht=function(e){return Dt(e,Ot,Ut)},It=le(P,"DataView"),Ft=le(P,"Promise"),Gt=le(P,"Set"),Yt=le(P,"WeakMap"),$t=te(It),Vt=te(fe),qt=te(Ft),Zt=te(Gt),Jt=te(Yt),Xt=F;(It&&"[object DataView]"!=Xt(new It(new ArrayBuffer(1)))||fe&&"[object Map]"!=Xt(new fe)||Ft&&"[object Promise]"!=Xt(Ft.resolve())||Gt&&"[object Set]"!=Xt(new Gt)||Yt&&"[object WeakMap]"!=Xt(new Yt))&&(Xt=function(e){var t=F(e),r="[object Object]"==t?e.constructor:void 0,n=r?te(r):"";if(n)switch(n){case $t:return"[object DataView]";case Vt:return"[object Map]";case qt:return"[object Promise]";case Zt:return"[object Set]";case Jt:return"[object WeakMap]"}return t});var Kt=Xt,Qt=Object.prototype.hasOwnProperty;var er=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&Qt.call(e,"index")&&(r.index=e.index,r.input=e.input),r},tr=P.Uint8Array;var rr=function(e){var t=new e.constructor(e.byteLength);return new tr(t).set(new tr(e)),t};var nr=function(e,t){var r=t?rr(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)},or=/\w*$/;var ar=function(e){var t=new e.constructor(e.source,or.exec(e));return t.lastIndex=e.lastIndex,t},ir=L?L.prototype:void 0,cr=ir?ir.valueOf:void 0;var ur=function(e){return cr?Object(cr.call(e)):{}};var sr=function(e,t){var r=t?rr(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)},lr="[object Boolean]",fr="[object Date]",pr="[object Map]",vr="[object Number]",hr="[object RegExp]",dr="[object Set]",yr="[object String]",gr="[object Symbol]",br="[object ArrayBuffer]",mr="[object DataView]",wr="[object Float32Array]",jr="[object Float64Array]",xr="[object Int8Array]",kr="[object Int16Array]",_r="[object Int32Array]",Or="[object Uint8Array]",Sr="[object Uint8ClampedArray]",Mr="[object Uint16Array]",Er="[object Uint32Array]";var Cr=function(e,t,r){var n=e.constructor;switch(t){case br:return rr(e);case lr:case fr:return new n(+e);case mr:return nr(e,r);case wr:case jr:case xr:case kr:case _r:case Or:case Sr:case Mr:case Er:return sr(e,r);case pr:return new n;case vr:case yr:return new n(e);case hr:return ar(e);case dr:return new n;case gr:return ur(e)}},Ar=Object.create,Pr=function(){function e(){}return function(t){if(!G(t))return{};if(Ar)return Ar(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();var Lr=function(e){return"function"!=typeof e.constructor||ht(e)?{}:Pr(Nt(e))},Br="[object Map]";var Wr=function(e){return Ge(e)&&Kt(e)==Br},Tr=ut&&ut.isMap,Nr=Tr?ct(Tr):Wr,Ur="[object Set]";var Rr=function(e){return Ge(e)&&Kt(e)==Ur},Dr=ut&&ut.isSet,zr=Dr?ct(Dr):Rr,Hr=1,Ir=2,Fr=4,Gr="[object Arguments]",Yr="[object Function]",$r="[object GeneratorFunction]",Vr="[object Object]",qr={};qr[Gr]=qr["[object Array]"]=qr["[object ArrayBuffer]"]=qr["[object DataView]"]=qr["[object Boolean]"]=qr["[object Date]"]=qr["[object Float32Array]"]=qr["[object Float64Array]"]=qr["[object Int8Array]"]=qr["[object Int16Array]"]=qr["[object Int32Array]"]=qr["[object Map]"]=qr["[object Number]"]=qr[Vr]=qr["[object RegExp]"]=qr["[object Set]"]=qr["[object String]"]=qr["[object Symbol]"]=qr["[object Uint8Array]"]=qr["[object Uint8ClampedArray]"]=qr["[object Uint16Array]"]=qr["[object Uint32Array]"]=!0,qr["[object Error]"]=qr[Yr]=qr["[object WeakMap]"]=!1;var Zr=function e(t,r,n,o,a,i){var c,u=r&Hr,s=r&Ir,l=r&Fr;if(n&&(c=a?n(t,o,a,i):n(t)),void 0!==c)return c;if(!G(t))return t;var f=Xe(t);if(f){if(c=er(t),!u)return Et(t,c)}else{var p=Kt(t),v=p==Yr||p==$r;if(Qe(t))return Mt(t,u);if(p==Vr||p==Gr||v&&!a){if(c=s||v?{}:Lr(t),!u)return s?Rt(t,St(c,t)):Wt(t,jt(c,t))}else{if(!qr[p])return a?t:{};c=Cr(t,p,u)}}i||(i=new Ne);var h=i.get(t);if(h)return h;i.set(t,c),zr(t)?t.forEach((function(o){c.add(e(o,r,n,o,t,i))})):Nr(t)&&t.forEach((function(o,a){c.set(a,e(o,r,n,a,t,i))}));var d=l?s?Ht:zt:s?keysIn:wt,y=f?void 0:d(t);return Ue(y||t,(function(o,a){y&&(o=t[a=o]),He(c,a,e(o,r,n,a,t,i))})),c},Jr=1,Xr=4;var Kr=function(e){return Zr(e,Jr|Xr)};var Qr=function(e){return function(t,r,n){for(var o=-1,a=Object(t),i=n(t),c=i.length;c--;){var u=i[e?c:++o];if(!1===r(a[u],u,a))break}return t}}();var en=function(e,t){return function(r,n){if(null==r)return r;if(!mt(r))return e(r,n);for(var o=r.length,a=t?o:-1,i=Object(r);(t?a--:++a<o)&&!1!==n(i[a],a,i););return r}}((function(e,t){return e&&Qr(e,t,wt)}));var tn=function(e){return e};var rn=function(e){return"function"==typeof e?e:tn};var nn=function(e,t){return(Xe(e)?Ue:en)(e,rn(t))};var on=function(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o},an="__lodash_hash_undefined__";var cn=function(e){return this.__data__.set(e,an),this};var un=function(e){return this.__data__.has(e)};function sn(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Le;++t<r;)this.add(e[t])}sn.prototype.add=sn.prototype.push=cn,sn.prototype.has=un;var ln=sn;var fn=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1};var pn=function(e,t){return e.has(t)},vn=1,hn=2;var dn=function(e,t,r,n,o,a){var i=r&vn,c=e.length,u=t.length;if(c!=u&&!(i&&u>c))return!1;var s=a.get(e);if(s&&a.get(t))return s==t;var l=-1,f=!0,p=r&hn?new ln:void 0;for(a.set(e,t),a.set(t,e);++l<c;){var v=e[l],h=t[l];if(n)var d=i?n(h,v,l,t,e,a):n(v,h,l,e,t,a);if(void 0!==d){if(d)continue;f=!1;break}if(p){if(!fn(t,(function(e,t){if(!pn(p,t)&&(v===e||o(v,e,r,n,a)))return p.push(t)}))){f=!1;break}}else if(v!==h&&!o(v,h,r,n,a)){f=!1;break}}return a.delete(e),a.delete(t),f};var yn=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r};var gn=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},bn=1,mn=2,wn="[object Boolean]",jn="[object Date]",xn="[object Error]",kn="[object Map]",_n="[object Number]",On="[object RegExp]",Sn="[object Set]",Mn="[object String]",En="[object Symbol]",Cn="[object ArrayBuffer]",An="[object DataView]",Pn=L?L.prototype:void 0,Ln=Pn?Pn.valueOf:void 0;var Bn=function(e,t,r,n,o,a,i){switch(r){case An:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Cn:return!(e.byteLength!=t.byteLength||!a(new tr(e),new tr(t)));case wn:case jn:case _n:return y(+e,+t);case xn:return e.name==t.name&&e.message==t.message;case On:case Mn:return e==t+"";case kn:var c=yn;case Sn:var u=n&bn;if(c||(c=gn),e.size!=t.size&&!u)return!1;var s=i.get(e);if(s)return s==t;n|=mn,i.set(e,t);var l=dn(c(e),c(t),n,o,a,i);return i.delete(e),l;case En:if(Ln)return Ln.call(e)==Ln.call(t)}return!1},Wn=1,Tn=Object.prototype.hasOwnProperty;var Nn=function(e,t,r,n,o,a){var i=r&Wn,c=zt(e),u=c.length;if(u!=zt(t).length&&!i)return!1;for(var s=u;s--;){var l=c[s];if(!(i?l in t:Tn.call(t,l)))return!1}var f=a.get(e);if(f&&a.get(t))return f==t;var p=!0;a.set(e,t),a.set(t,e);for(var v=i;++s<u;){var h=e[l=c[s]],d=t[l];if(n)var y=i?n(d,h,l,t,e,a):n(h,d,l,e,t,a);if(!(void 0===y?h===d||o(h,d,r,n,a):y)){p=!1;break}v||(v="constructor"==l)}if(p&&!v){var g=e.constructor,b=t.constructor;g!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof g&&g instanceof g&&"function"==typeof b&&b instanceof b)&&(p=!1)}return a.delete(e),a.delete(t),p},Un=1,Rn="[object Arguments]",Dn="[object Array]",zn="[object Object]",Hn=Object.prototype.hasOwnProperty;var In=function(e,t,r,n,o,a){var i=Xe(e),c=Xe(t),u=i?Dn:Kt(e),s=c?Dn:Kt(t),l=(u=u==Rn?zn:u)==zn,f=(s=s==Rn?zn:s)==zn,p=u==s;if(p&&Qe(e)){if(!Qe(t))return!1;i=!0,l=!1}if(p&&!l)return a||(a=new Ne),i||lt(e)?dn(e,t,r,n,o,a):Bn(e,t,u,r,n,o,a);if(!(r&Un)){var v=l&&Hn.call(e,"__wrapped__"),h=f&&Hn.call(t,"__wrapped__");if(v||h){var d=v?e.value():e,y=h?t.value():t;return a||(a=new Ne),o(d,y,r,n,a)}}return!!p&&(a||(a=new Ne),Nn(e,t,r,n,o,a))};var Fn=function e(t,r,n,o,a){return t===r||(null==t||null==r||!Ge(t)&&!Ge(r)?t!=t&&r!=r:In(t,r,n,o,e,a))},Gn=1,Yn=2;var $n=function(e,t,r,n){var o=r.length,a=o,i=!n;if(null==e)return!a;for(e=Object(e);o--;){var c=r[o];if(i&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++o<a;){var u=(c=r[o])[0],s=e[u],l=c[1];if(i&&c[2]){if(void 0===s&&!(u in e))return!1}else{var f=new Ne;if(n)var p=n(s,l,u,e,t,f);if(!(void 0===p?Fn(l,s,Gn|Yn,n,f):p))return!1}}return!0};var Vn=function(e){return e==e&&!G(e)};var qn=function(e){for(var t=wt(e),r=t.length;r--;){var n=t[r],o=e[n];t[r]=[n,o,Vn(o)]}return t};var Zn=function(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}};var Jn=function(e){var t=qn(e);return 1==t.length&&t[0][2]?Zn(t[0][0],t[0][1]):function(r){return r===e||$n(r,e,t)}},Xn="[object Symbol]";var Kn=function(e){return"symbol"==c(e)||Ge(e)&&F(e)==Xn},Qn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,eo=/^\w*$/;var to=function(e,t){if(Xe(e))return!1;var r=c(e);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!Kn(e))||(eo.test(e)||!Qn.test(e)||null!=t&&e in Object(t))},ro="Expected a function";function no(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(ro);var r=function r(){var n=arguments,o=t?t.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var i=e.apply(this,n);return r.cache=a.set(o,i)||a,i};return r.cache=new(no.Cache||Le),r}no.Cache=Le;var oo=no,ao=500;var io=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,co=/\\(\\)?/g,uo=function(e){var t=oo(e,(function(e){return r.size===ao&&r.clear(),e})),r=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(io,(function(e,r,n,o){t.push(n?o.replace(co,"$1"):r||e)})),t})),so=1/0,lo=L?L.prototype:void 0,fo=lo?lo.toString:void 0;var po=function e(t){if("string"==typeof t)return t;if(Xe(t))return on(t,e)+"";if(Kn(t))return fo?fo.call(t):"";var r=t+"";return"0"==r&&1/t==-so?"-0":r};var vo=function(e){return null==e?"":po(e)};var ho=function(e,t){return Xe(e)?e:to(e,t)?[e]:uo(vo(e))},yo=1/0;var go=function(e){if("string"==typeof e||Kn(e))return e;var t=e+"";return"0"==t&&1/e==-yo?"-0":t};var bo=function(e,t){for(var r=0,n=(t=ho(t,e)).length;null!=e&&r<n;)e=e[go(t[r++])];return r&&r==n?e:void 0};var mo=function(e,t,r){var n=null==e?void 0:bo(e,t);return void 0===n?r:n};var wo=function(e,t){return null!=e&&t in Object(e)};var jo=function(e,t,r){for(var n=-1,o=(t=ho(t,e)).length,a=!1;++n<o;){var i=go(t[n]);if(!(a=null!=e&&r(e,i)))break;e=e[i]}return a||++n!=o?a:!!(o=null==e?0:e.length)&&ot(o)&&rt(i,o)&&(Xe(e)||Je(e))};var xo=function(e,t){return null!=e&&jo(e,t,wo)},ko=1,_o=2;var Oo=function(e,t){return to(e)&&Vn(t)?Zn(go(e),t):function(r){var n=mo(r,e);return void 0===n&&n===t?xo(r,e):Fn(t,n,ko|_o)}};var So=function(e){return function(t){return null==t?void 0:t[e]}};var Mo=function(e){return function(t){return bo(t,e)}};var Eo=function(e){return to(e)?So(go(e)):Mo(e)};var Co=function(e){return"function"==typeof e?e:null==e?tn:"object"==c(e)?Xe(e)?Oo(e[0],e[1]):Jn(e):Eo(e)};var Ao=function(e,t){var r=-1,n=mt(e)?Array(e.length):[];return en(e,(function(e,o,a){n[++r]=t(e,o,a)})),n};var Po=function(e,t){return(Xe(e)?on:Ao)(e,Co(t))},Lo=L?L.isConcatSpreadable:void 0;var Bo=function(e){return Xe(e)||Je(e)||!!(Lo&&e&&e[Lo])};var Wo=function e(t,r,n,o,a){var i=-1,c=t.length;for(n||(n=Bo),a||(a=[]);++i<c;){var u=t[i];r>0&&n(u)?r>1?e(u,r-1,n,o,a):Tt(a,u):o||(a[a.length]=u)}return a};var To=function(){var e=arguments.length;if(!e)return[];for(var t=Array(e-1),r=arguments[0],n=e;n--;)t[n-1]=arguments[n];return Tt(Xe(r)?Et(r):[r],Wo(t,1))},No=Array.prototype.join;var Uo=function(e,t){return null==e?"":No.call(e,t)};var Ro=function(e,t,r,n){if(!G(e))return e;for(var o=-1,a=(t=ho(t,e)).length,i=a-1,c=e;null!=c&&++o<a;){var u=go(t[o]),s=r;if(o!=i){var l=c[u];void 0===(s=n?n(l,u,c):void 0)&&(s=G(l)?l:rt(t[o+1])?[]:{})}He(c,u,s),c=c[u]}return e};var Do=function(e,t,r){for(var n=-1,o=t.length,a={};++n<o;){var i=t[n],c=bo(e,i);r(c,i)&&Ro(a,ho(i,e),c)}return a};var zo=function(e,t){return Do(e,t,(function(t,r){return xo(e,r)}))};var Ho=function(e){return(null==e?0:e.length)?Wo(e,1):[]};var Io=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)},Fo=Math.max;var Go=function(e,t,r){return t=Fo(void 0===t?e.length-1:t,0),function(){for(var n=arguments,o=-1,a=Fo(n.length-t,0),i=Array(a);++o<a;)i[o]=n[t+o];o=-1;for(var c=Array(t+1);++o<t;)c[o]=n[o];return c[t]=r(i),Io(e,this,c)}};var Yo=function(e){return function(){return e}},$o=Re?function(e,t){return Re(e,"toString",{configurable:!0,enumerable:!1,value:Yo(t),writable:!0})}:tn,Vo=800,qo=16,Zo=Date.now;var Jo=function(e){var t=0,r=0;return function(){var n=Zo(),o=qo-(n-r);if(r=n,o>0){if(++t>=Vo)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}($o);var Xo=function(e){return Jo(Go(e,void 0,Ho),e+"")},Ko=Xo((function(e,t){return null==e?{}:zo(e,t)}));function Qo(){var e,t,r=new Promise((function(){e=arguments[0],t=arguments[1]}));return r.resolve=e,r.reject=t,r}var ea=NaN,ta=/^\s+|\s+$/g,ra=/^[-+]0x[0-9a-f]+$/i,na=/^0b[01]+$/i,oa=/^0o[0-7]+$/i,aa=parseInt;var ia=function(e){if("number"==typeof e)return e;if(Kn(e))return ea;if(G(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=G(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(ta,"");var r=na.test(e);return r||oa.test(e)?aa(e.slice(2),r?2:8):ra.test(e)?ea:+e},ca=1/0,ua=17976931348623157e292;var sa=function(e){return e?(e=ia(e))===ca||e===-ca?(e<0?-1:1)*ua:e==e?e:0:0===e?e:0};var la=function(e){var t=sa(e),r=t%1;return t==t?r?t-r:t:0};var fa=function(e){return"number"==typeof e&&e==la(e)};function pa(e){return"[object String]"===Object.prototype.toString.call(e)}function va(e){return!(!pa(e)||""===e)}function ha(e){var t=!1;return va(e)?t=!isNaN(Number(e)):function(e){return"[object Number]"===Object.prototype.toString.call(e)}(e)&&(t=!0),t}function da(e){return ha(e)?sa(e):0}var ya=P.isFinite,ga=Math.min;var ba=function(e){var t=Math[e];return function(e,r){if(e=ia(e),(r=null==r?0:ga(la(r),292))&&ya(e)){var n=(vo(e)+"e").split("e"),o=t(n[0]+"e"+(+n[1]+r));return+((n=(vo(o)+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}("round");function ma(e){return!!function(e){return!!ha(e)&&(e=da(e),fa(e))}(e)&&function(e){if(!ha(e))return 0;e=da(e);var t=ba(e);return"0"===String(t)?0:t}(e)>0}function wa(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[],o=r.length;if(ma(t))for(e=0;e<t;e++)n[e]=r[0|Math.random()*o];else{if("rfc4122"!==t)return"";var a;for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",e=0;e<36;e++)n[e]||(a=0|16*Math.random(),n[e]=r[19===e?3&a|8:a])}return n.join("")}function ja(e){return"[object Object]"===Object.prototype.toString.call(e)}function xa(e){if(ja(e)){for(var t in e)return!0;return!1}return!1}function ka(e,t){if(!va(e))return"";if(!xa(t))return"";var r=!1;return nn(t,(function(e,t){pa(e)||(r=!0)})),r?"":(nn(t,(function(t,r){e=function(e,t,r){if(!va(e))return"";if(!va(t))return"";if(!pa(r))return"";var n=new RegExp(t,"g");return String(e).replace(n,r)}(e,r,t)})),e)}function _a(e,t){return!!ja(e)&&(!!va(t)&&t in e)}function Oa(){return t().format("YYYY-MM-DDTHH:mm:ssZ")}function Sa(e){return"[object Array]"===Object.prototype.toString.call(e)}function Ma(e){return!!function(e){return"[object Undefined]"===Object.prototype.toString.call(e)}(e)||(!!function(e){return"[object Null]"===Object.prototype.toString.call(e)}(e)||(!!function(e){if(ja(e)){for(var t in e)return!1;return!0}return!1}(e)||(!!function(e){return!(!pa(e)||""!==e)}(e)||!!function(e){return!!Sa(e)&&0===e.length}(e))))}function Ea(e){return!!Sa(e)&&(0!==e.length&&(1!==e.length||!Ma(e[0])))}function Ca(e,t){return va(e)&&ma(t)?function(e,t){return va(e)&&ma(t)?e.substr(0,t):""}(e,e.length-t):""}function Aa(e){if(!va(e))return!1;var r=function(e,t){if(!va(e))return"";if(!ma(t))return"";var r=e.length-t;return r<0&&(r=0),e.substr(r,t)}(e,6);if(!/[+|-]\d\d:\d\d/.test(r))return!1;var n=Ca(e,6),o="YYYY-MM-DDTHH:mm:ss";return n===t(n,o).format(o)}function Pa(e){return!!va(e)&&/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e)}var La=f((function(e,t){var r;e.exports=(r=r||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),n={},o=n.lib={},a=o.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},i=o.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,o=e.sigBytes;if(this.clamp(),n%4)for(var a=0;a<o;a++){var i=r[a>>>2]>>>24-a%4*8&255;t[n+a>>>2]|=i<<24-(n+a)%4*8}else for(a=0;a<o;a+=4)t[n+a>>>2]=r[a>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r,n=[],o=function(t){t=t;var r=987654321,n=4294967295;return function(){var o=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return o/=4294967296,(o+=.5)*(e.random()>.5?1:-1)}},a=0;a<t;a+=4){var c=o(4294967296*(r||e.random()));r=987654071*c(),n.push(4294967296*c()|0)}return new i.init(n,t)}}),c=n.enc={},u=c.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var a=t[o>>>2]>>>24-o%4*8&255;n.push((a>>>4).toString(16)),n.push((15&a).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new i.init(r,t/2)}},s=c.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var a=t[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(a))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new i.init(r,t)}},l=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(s.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return s.parse(unescape(encodeURIComponent(e)))}},f=o.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,o=r.sigBytes,a=this.blockSize,c=o/(4*a),u=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*a,s=e.min(4*u,o);if(u){for(var l=0;l<u;l+=a)this._doProcessBlock(n,l);var f=n.splice(0,u);r.sigBytes-=s}return new i.init(f,s)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),p=(o.Hasher=f.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}}),n.algo={});return n}(Math),r)})),Ba=(f((function(e,t){var r,n,o,a,i,c;e.exports=(n=(r=c=La).lib,o=n.Base,a=n.WordArray,(i=r.x64={}).Word=o.extend({init:function(e,t){this.high=e,this.low=t}}),i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],n=0;n<t;n++){var o=e[n];r.push(o.high),r.push(o.low)}return a.create(r,this.sigBytes)},clone:function(){for(var e=o.clone.call(this),t=e.words=this.words.slice(0),r=t.length,n=0;n<r;n++)t[n]=t[n].clone();return e}}),c)})),f((function(e,t){var r;e.exports=(r=La,function(){var e=r,t=e.lib.Hasher,n=e.x64,o=n.Word,a=n.WordArray,i=e.algo;function c(){return o.create.apply(o,arguments)}var u=[c(1116352408,3609767458),c(1899447441,602891725),c(3049323471,3964484399),c(3921009573,2173295548),c(961987163,4081628472),c(1508970993,3053834265),c(2453635748,2937671579),c(2870763221,3664609560),c(3624381080,2734883394),c(310598401,1164996542),c(607225278,1323610764),c(1426881987,3590304994),c(1925078388,4068182383),c(2162078206,991336113),c(2614888103,633803317),c(3248222580,3479774868),c(3835390401,2666613458),c(4022224774,944711139),c(264347078,2341262773),c(604807628,2007800933),c(770255983,1495990901),c(1249150122,1856431235),c(1555081692,3175218132),c(1996064986,2198950837),c(2554220882,3999719339),c(2821834349,766784016),c(2952996808,2566594879),c(3210313671,3203337956),c(3336571891,1034457026),c(3584528711,2466948901),c(113926993,3758326383),c(338241895,168717936),c(666307205,1188179964),c(773529912,1546045734),c(1294757372,1522805485),c(1396182291,2643833823),c(1695183700,2343527390),c(1986661051,1014477480),c(2177026350,1206759142),c(2456956037,344077627),c(2730485921,1290863460),c(2820302411,3158454273),c(3259730800,3505952657),c(3345764771,106217008),c(3516065817,3606008344),c(3600352804,1432725776),c(4094571909,1467031594),c(275423344,851169720),c(430227734,3100823752),c(506948616,1363258195),c(659060556,3750685593),c(883997877,3785050280),c(958139571,3318307427),c(1322822218,3812723403),c(1537002063,2003034995),c(1747873779,3602036899),c(1955562222,1575990012),c(2024104815,1125592928),c(2227730452,2716904306),c(2361852424,442776044),c(2428436474,593698344),c(2756734187,3733110249),c(3204031479,2999351573),c(3329325298,3815920427),c(3391569614,3928383900),c(3515267271,566280711),c(3940187606,3454069534),c(4118630271,4000239992),c(116418474,1914138554),c(174292421,2731055270),c(289380356,3203993006),c(460393269,320620315),c(685471733,587496836),c(852142971,1086792851),c(1017036298,365543100),c(1126000580,2618297676),c(1288033470,3409855158),c(1501505948,4234509866),c(1607167915,987167468),c(1816402316,1246189591)],s=[];!function(){for(var e=0;e<80;e++)s[e]=c()}();var l=i.SHA512=t.extend({_doReset:function(){this._hash=new a.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],a=r[2],i=r[3],c=r[4],l=r[5],f=r[6],p=r[7],v=n.high,h=n.low,d=o.high,y=o.low,g=a.high,b=a.low,m=i.high,w=i.low,j=c.high,x=c.low,k=l.high,_=l.low,O=f.high,S=f.low,M=p.high,E=p.low,C=v,A=h,P=d,L=y,B=g,W=b,T=m,N=w,U=j,R=x,D=k,z=_,H=O,I=S,F=M,G=E,Y=0;Y<80;Y++){var $=s[Y];if(Y<16)var V=$.high=0|e[t+2*Y],q=$.low=0|e[t+2*Y+1];else{var Z=s[Y-15],J=Z.high,X=Z.low,K=(J>>>1|X<<31)^(J>>>8|X<<24)^J>>>7,Q=(X>>>1|J<<31)^(X>>>8|J<<24)^(X>>>7|J<<25),ee=s[Y-2],te=ee.high,re=ee.low,ne=(te>>>19|re<<13)^(te<<3|re>>>29)^te>>>6,oe=(re>>>19|te<<13)^(re<<3|te>>>29)^(re>>>6|te<<26),ae=s[Y-7],ie=ae.high,ce=ae.low,ue=s[Y-16],se=ue.high,le=ue.low;V=(V=(V=K+ie+((q=Q+ce)>>>0<Q>>>0?1:0))+ne+((q+=oe)>>>0<oe>>>0?1:0))+se+((q+=le)>>>0<le>>>0?1:0),$.high=V,$.low=q}var fe,pe=U&D^~U&H,ve=R&z^~R&I,he=C&P^C&B^P&B,de=A&L^A&W^L&W,ye=(C>>>28|A<<4)^(C<<30|A>>>2)^(C<<25|A>>>7),ge=(A>>>28|C<<4)^(A<<30|C>>>2)^(A<<25|C>>>7),be=(U>>>14|R<<18)^(U>>>18|R<<14)^(U<<23|R>>>9),me=(R>>>14|U<<18)^(R>>>18|U<<14)^(R<<23|U>>>9),we=u[Y],je=we.high,xe=we.low,ke=F+be+((fe=G+me)>>>0<G>>>0?1:0),_e=ge+de;F=H,G=I,H=D,I=z,D=U,z=R,U=T+(ke=(ke=(ke=ke+pe+((fe+=ve)>>>0<ve>>>0?1:0))+je+((fe+=xe)>>>0<xe>>>0?1:0))+V+((fe+=q)>>>0<q>>>0?1:0))+((R=N+fe|0)>>>0<N>>>0?1:0)|0,T=B,N=W,B=P,W=L,P=C,L=A,C=ke+(ye+he+(_e>>>0<ge>>>0?1:0))+((A=fe+_e|0)>>>0<fe>>>0?1:0)|0}h=n.low=h+A,n.high=v+C+(h>>>0<A>>>0?1:0),y=o.low=y+L,o.high=d+P+(y>>>0<L>>>0?1:0),b=a.low=b+W,a.high=g+B+(b>>>0<W>>>0?1:0),w=i.low=w+N,i.high=m+T+(w>>>0<N>>>0?1:0),x=c.low=x+R,c.high=j+U+(x>>>0<R>>>0?1:0),_=l.low=_+z,l.high=k+D+(_>>>0<z>>>0?1:0),S=f.low=S+I,f.high=O+H+(S>>>0<I>>>0?1:0),E=p.low=E+G,p.high=M+F+(E>>>0<G>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[30+(n+128>>>10<<5)]=Math.floor(r/4294967296),t[31+(n+128>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(l),e.HmacSHA512=t._createHmacHelper(l)}(),r.SHA512)}))),Wa=f((function(e,t){var r,n,o;e.exports=(n=(r=o=La).lib.WordArray,r.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var o=[],a=0;a<r;a+=3)for(var i=(t[a>>>2]>>>24-a%4*8&255)<<16|(t[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|t[a+2>>>2]>>>24-(a+2)%4*8&255,c=0;c<4&&a+.75*c<r;c++)o.push(n.charAt(i>>>6*(3-c)&63));var u=n.charAt(64);if(u)for(;o.length%4;)o.push(u);return o.join("")},parse:function(e){var t=e.length,r=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var a=0;a<r.length;a++)o[r.charCodeAt(a)]=a}var i=r.charAt(64);if(i){var c=e.indexOf(i);-1!==c&&(t=c)}return function(e,t,r){for(var o=[],a=0,i=0;i<t;i++)if(i%4){var c=r[e.charCodeAt(i-1)]<<i%4*2,u=r[e.charCodeAt(i)]>>>6-i%4*2;o[a>>>2]|=(c|u)<<24-a%4*8,a++}return n.create(o,a)}(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},o.enc.Base64)})),Ta=f((function(e,t){e.exports=La.enc.Hex})),Na="[object Boolean]";var Ua=function(e){return!0===e||!1===e||Ge(e)&&F(e)==Na};function Ra(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!va(e))return"";if(!Ua(t))return"";var r=Ba(e);return t?r.toString(Wa):r.toString(Ta)}function Da(e){return function(){var t=Qo();return e.apply(this,arguments).then((function(e){t.resolve({state:"success",msg:e})})).catch((function(e){t.resolve({state:"error",msg:e})})),t}}var za=function(e,t,r,n){for(var o=e.length,a=r+(n?1:-1);n?a--:++a<o;)if(t(e[a],a,e))return a;return-1};var Ha=function(e){return e!=e};var Ia=function(e,t,r){for(var n=r-1,o=e.length;++n<o;)if(e[n]===t)return n;return-1};var Fa=function(e,t,r){return t==t?Ia(e,t,r):za(e,Ha,r)};var Ga=function(e,t){return!!(null==e?0:e.length)&&Fa(e,t,0)>-1};var Ya=function(e,t,r){for(var n=-1,o=null==e?0:e.length;++n<o;)if(r(t,e[n]))return!0;return!1};var $a=function(){},Va=Gt&&1/gn(new Gt([,-0]))[1]==1/0?function(e){return new Gt(e)}:$a,qa=200;var Za=function(e,t,r){var n=-1,o=Ga,a=e.length,i=!0,c=[],u=c;if(r)i=!1,o=Ya;else if(a>=qa){var s=t?null:Va(e);if(s)return gn(s);i=!1,o=pn,u=new ln}else u=t?[]:c;e:for(;++n<a;){var l=e[n],f=t?t(l):l;if(l=r||0!==l?l:0,i&&f==f){for(var p=u.length;p--;)if(u[p]===f)continue e;t&&u.push(f),c.push(l)}else o(u,f,r)||(u!==c&&u.push(f),c.push(l))}return c};var Ja=function(e,t){return e&&e.length?Za(e,Co(t)):[]};var Xa=function(e,t){return Fn(e,t)};function Ka(e,t){return xa(e)&&va(t)?mo(e,t,""):""}function Qa(e,t){var r,n=Ka(e,t);return n=va(r=n)||ha(r)?String(r):""}function ei(e){var t=Object.prototype.toString.call(e);return"[object Function]"===t||"[object AsyncFunction]"===t}function ti(e,t){if(va(e))e=[e];else if(!Ea(e))return!1;if(va(t))t=[t];else if(!Ea(t))return!1;for(var r=0;r<e.length;r++)for(var n=0;n<t.length;n++)if(e[r]===t[n])return!0;return!1}function ri(e){var t=[],n=[];(e=Kr(e)).port||(e.port=8080),e.apiName||(e.apiName="api"),e.routes||(e.routes=[]);var o=[];function a(t){var r=Qo();return ei(e.authenticate)?e.authenticate(t).then((function(e){r.resolve(e)})):r.resolve(!0),r}function i(){return(i=s(regeneratorRuntime.mark((function t(r){var n,i,c,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Qa(r,"token"),t.next=3,a(n);case 3:if(!t.sent){t.next=25;break}if(i=Qa(r,"func"),c=Ka(r,"input"),"getFuncs"!==i){t.next=15;break}if(!ei(e.filterFuncs)){t.next=12;break}return t.next=11,e.filterFuncs(n,o);case 11:o=t.sent;case 12:r.output={sys:"sys",funcs:o},t.next=23;break;case 15:if(!ti(o,i)){t.next=22;break}return t.next=18,e.funcs[i](c);case 18:u=t.sent,r.output=u,t.next=23;break;case 22:r.output={err:"can not find: ".concat(i)};case 23:t.next=26;break;case 25:r.output={err:"can not authenticate token: ".concat(n)};case 26:return delete r.input,t.abrupt("return",JSON.stringify(r));case 28:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function c(t){if(ei(e.onClientChange)){var r=Ja(t,"clientId");Xa(n,r)||(n=r,e.onClientChange(n,e))}}_a(e,"funcs")&&(o=wt(e.funcs));var u={path:"/"+e.apiName,method:"POST",handler:function(e,r){var n=Qo(),o=wa(),a=mo(e.payload,"clientId"),u={headers:e.headers,info:e.info};return t.push({clientId:a,connId:o,data:u}),c(t),function(e){return i.apply(this,arguments)}(e.payload).then((function(e){n.resolve(e)})).catch((function(e){n.reject(e)})).finally((function(){c(t=t.filter((function(e){return e.connId!==o})))})),n}};function l(){return(l=s(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=r.server({port:e.port,routes:{cors:!0}})).route(u),nn(e.routes,(function(e){n.route(e)})),t.next=5,n.start();case 5:console.log("Server running at: ".concat(n.info.uri));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}e.serverHapi?e.serverHapi.route(u):function(){l.apply(this,arguments)}()}var ni=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0};var oi=function(e,t,r){var n=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(r=r>o?o:r)<0&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;for(var a=Array(o);++n<o;)a[n]=e[n+t];return a};var ai=function(e,t){return t.length<2?e:bo(e,oi(t,0,-1))};var ii=function(e,t){return t=ho(t,e),null==(e=ai(e,t))||delete e[go(ni(t))]},ci="[object Object]",ui=Function.prototype,si=Object.prototype,li=ui.toString,fi=si.hasOwnProperty,pi=li.call(Object);var vi=function(e){if(!Ge(e)||F(e)!=ci)return!1;var t=Nt(e);if(null===t)return!0;var r=fi.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&li.call(r)==pi};var hi=function(e){return vi(e)?void 0:e},di=Xo((function(e,t){var r={};if(null==e)return r;var n=!1;t=on(t,(function(t){return t=ho(t,e),n||(n=t.length>1),t})),Ie(e,Ht(e),r),n&&(r=Zr(r,7,hi));for(var o=t.length;o--;)ii(r,t[o]);return r}));var yi=function(e,t,r){var n=null==e?0:e.length;return n?(t=r||void 0===t?1:la(t),oi(e,t<0?0:t,n)):[]};function gi(e,t){var r=Qo();if(!Sa(e))return r.reject("rs is not array"),r;ei(t)||(t=function(e){return e});var n=-1,o=[];return e.reduce((function(e,r){return e.then((function(e){return o.push(e),t(r,n+=1)}))}),Promise.resolve()).then((function(e){o.push(e),o=yi(o),r.resolve(o)})).catch((function(e){r.reject(e)})),r}var bi={useNewUrlParser:!0,useUnifiedTopology:!0};function mi(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Qo(),r=mo(e,"srcName","system by w-email"),n=mo(e,"srcEmail","");if(!Pa(n))return t.reject("srcEmail is not email"),t;var o=mo(e,"srcPW",""),i=mo(e,"srcHost","smtp.gmail.com"),c=mo(e,"srcPort",587),u=mo(e,"emTitle",""),s=mo(e,"emContent",""),l=mo(e,"emAttachments",[]);ja(l)&&(l=[l]);var f=mo(e,"toEmails",[]);pa(f)&&(f=[f]);var p=mo(e,"toEmailsCC",[]);pa(p)&&(p=[p]);var v=mo(e,"toEmailsBCC",[]);pa(v)&&(v=[v]);var h=a.createTransport({host:i,secureConnecton:!0,port:c,auth:{user:n,pass:o}}),d={from:"".concat(r," <").concat(n,">"),to:f.join(","),cc:p.join(","),bcc:v.join(","),subject:u,html:s,attachments:l};return h.sendMail(d,(function(e,r){e?t.reject(e):t.resolve(r.response)})),t}var wi='<table style="width:100%;">\n<tbody>\n\n<tr style="display:none;">\n    <td>\n        {emMessage}\n    </td>\n</tr>\n\n<tr>\n    <td style="padding:30px; font-family:\'Microsoft JhengHei\'; background-color:#666; text-align:center;">\n        <a style="color:#aaffff; font-size:24pt; text-decoration:none;" href="{emWebUrl}" target="_blank">{emWebName}</a>\n        <p style="margin:10px 0px 0px 0px; color:#eee; font-size:12pt;">\n            {emWebDescription}\n        </p>\n    </td>\n</tr>\n\n<tr>\n    <td style="padding:20px; font-family:\'Microsoft JhengHei\';">\n        <p style="">{emMessage}</p>\n    </td>\n</tr>\n\n<tr>\n    <td style="padding:20px; font-family:\'Microsoft JhengHei\'; background-color:#f5f5f5; text-align:center;">\n        <p style="color:#f26; font-size:11pt;">【{emLetterDoNotReplayMessage}】</p>\n        <p style="">{emLetterTeamMessage}</p>\n        <p style="padding:1em 0px 0px 0px; color:#aaa;">{emLetterLinks}</p>\n    </td>\n</tr>\n\n</tbody>\n</table>',ji='<p>Dear {name} :</p>\n\n<p>Your registration request has been received. Please click the link below to verify your account.</p>\n\n<p><a href="{urlCheckCode}" target="_blank">Confirm Account</a></p>',xi='<p>Dear {name} :</p>\n\n<p>You have received your change password request. Please click the link below to verify your account.</p>\n\n<p><a href="{urlCheckCode}" target="_blank">Confirm Account</a></p>',ki='<!DOCTYPE html>\n<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-tw">\n\n    <head>\n        <meta http-equiv="content-type" content="text/html charset=UTF-8" />\n        <title>{rdWebName}</title>\n\n        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.slim.js"><\/script>\n\n    </head>\n\n    <body style="padding:0; margin:0;">\n    \n        <div style="display:flex; align-items:center; justify-content:center;">\n            \n            <div style="padding:30px; font-family:\'Microsoft JhengHei\';">\n            \n                <div style="margin:10px 0px 20px 0px; display:flex; align-items:center;">\n\n                    <div style="margin-right:10px;">\n                        {rdLogo}\n                    </div>\n\n                    <div style="margin:-5px 0px 0px 0px;">\n                        <div style="margin:0px 0px 0px 0px; font-size:12pt; color:#999;">Single Sign-On</div>\n                        <div style="margin:-3px 0px 0px 0px; font-size:24pt;">{rdWebName}</div>\n                    </div>\n\n                </div>\n    \n                <div style="padding:20px; text-align:center; background-color:#fee; border-radius:10px;">\n\n                    <div style="">{rdMessage}</div>\n    \n                    <div id="cd" style="margin:10px 0px 0px 0px; font-size:10pt; color:#999; display:none;"></div>\n\n                </div>\n                \n            </div>\n            \n        </div>\n        \n        <script>\n\n            function countdown() {\n                $(\'#cd\').show()\n                let n = 5\n                let tmp = \'{rdCountdownMessage}\'\n                $(\'#cd\').text(tmp.replace(\'{s}\', n))\n                setInterval(function() {\n                    n -= 1\n                    if (n<=0) {\n                        window.location.href = \'{rdWebUrl}\'\n                    }\n                    $(\'#cd\').text(tmp.replace(\'{s}\', n))\n                }, 1000)\n            }\n            if ({rdCountdown}) {\n                countdown()\n            }\n\n        <\/script>\n\n    </body>\n\n</html>',_i='<svg width="64" height="64" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><defs><style>.cls-1{fill:#c8da52;}.cls-2{fill:#995f5b;}</style></defs><title/><path class="cls-1" d="M23.85,38.78c9.63-2,15,2.07,16.22,8.17S38,58.88,28.4,60.86,5.33,54.71,5.21,54.13,14.23,40.76,23.85,38.78Z"/><path class="cls-1" d="M45.72,18.87C51.31,27,49.66,33.45,44.54,37s-11.78,2.78-17.36-5.3S23.83,8,24.31,7.7,40.14,10.78,45.72,18.87Z"/><path class="cls-1" d="M72.6,31.21c-5.26,8.3-11.88,9.33-17.14,6s-7.16-9.75-1.9-18.05,20.45-12.32,21-12S77.86,22.91,72.6,31.21Z"/><path class="cls-1" d="M71.73,60.78c-9.69-1.6-13.22-7.3-12.21-13.44s6.19-10.4,15.88-8.8,19.33,14,19.24,14.59S81.43,62.38,71.73,60.78Z"/><path class="cls-2" d="M57.46,43.08a1,1,0,0,0-1.41-1.41l-6.22,6.21-6.21-6.21a1,1,0,0,0-1.41,1.41l6.62,6.63v5.08l-5.21-5.21A1,1,0,1,0,42.21,51l6.62,6.63V93.78a1,1,0,0,0,2,0V57.62L57.46,51a1,1,0,0,0-1.41-1.41l-5.22,5.21V49.71Z"/><path class="cls-2" d="M75.86,78.39a1,1,0,0,0-1,1V93.78a1,1,0,0,0,2,0V79.39A1,1,0,0,0,75.86,78.39Z"/><path class="cls-1" d="M65.37,77.4c3.88-.8,6,.83,6.53,3.28s-.83,4.8-4.7,5.6-9.28-2.48-9.32-2.71S61.5,78.2,65.37,77.4Z"/><path class="cls-1" d="M74.17,69.39c2.25,3.25,1.58,5.86-.48,7.29s-4.73,1.11-7-2.14S65.36,65,65.56,64.9,71.92,66.14,74.17,69.39Z"/><path class="cls-1" d="M85,74.35c-2.11,3.34-4.78,3.75-6.89,2.41s-2.88-3.92-.77-7.26,8.23-5,8.43-4.83S87.1,71,85,74.35Z"/><path class="cls-1" d="M84.63,86.25c-3.9-.65-5.32-2.94-4.91-5.41s2.49-4.18,6.39-3.54,7.78,5.64,7.74,5.87S88.53,86.89,84.63,86.25Z"/></svg>';function Oi(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Si(e){return e.format("YYYY-MM-DDTHH:mm:ssZ")}function Mi(){return{state:"success",msg:arguments.length>0&&void 0!==arguments[0]?arguments[0]:null}}function Ei(){return{state:"error",msg:arguments.length>0&&void 0!==arguments[0]?arguments[0]:null}}var Ci={roleSystem:"system",roleGeneral:"general"},Ai={activeYes:"yes",activeNo:"no"},Pi=["<",">"];return function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=new e.EventEmitter;function c(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];setTimeout((function(){a.emit.apply(a,[e].concat(r)),a.emit("all",{eventName:e,data:[].concat(r)})}),1)}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(){var r=Qo(),n=Kr(arguments);function o(e){t&&c(t,{input:n,output:e})}return e.apply(this,arguments).then((function(e){o(e),r.resolve(e)})).catch((function(e){o(e),r.resolve(e)})),r}}if(va((r=Kr(r)).mongoUrl)||(r.mongoUrl="mongodb://127.0.0.1:27017"),va(r.mongoDb)||(r.mongoDb="wuser"),va(r.mongoCl)||(r.mongoCl="users"),ma(r.port)||(r.port=8080),va(r.apiName)||(r.apiName="api"),va(r.authUrl)||(r.authUrl="http://localhost:8080/auth"),va(r.salt)||(r.salt=""),ma(r.timeTokenExp)||(r.timeTokenExp=30),va(r.webName)||(r.webName=""),va(r.webUrl)||(r.webUrl=""),va(r.webDescription)||(r.webDescription=""),va(r.emSenderName)||(r.emSenderName="WUserServer"),!va(r.emSenderEmail))return console.log("invalid emSenderEmail"),a;va(r.emSenderPW)||(r.emSenderPW=""),va(r.emBCC)||(r.emBCC=""),va(r.emLetterHtml)||(r.emLetterHtml=wi),va(r.emLetterTeamMessage)||(r.emLetterTeamMessage="Global-User International Company"),va(r.emLetterDoNotReplayMessage)||(r.emLetterDoNotReplayMessage="This letter is automatically sent by the system, please do not reply to this email."),Sa(r.emLetterLinks)||(r.emLetterLinks=[]),va(r.emSignUpTitle)||(r.emSignUpTitle="Verification letter"),va(r.emSignUpHtml)||(r.emSignUpHtml=ji),va(r.emResetPWTitle)||(r.emResetPWTitle="Password reset letter"),va(r.emResetPWHtml)||(r.emResetPWHtml=xi),va(r.verifyWebHtml)||(r.verifyWebHtml=ki),va(r.verifyWebLogo)||(r.verifyWebLogo=_i),va(r.verifyWebMsgSuccess)||(r.verifyWebMsgSuccess="Verify successfully"),va(r.verifyWebMsgExpired)||(r.verifyWebMsgExpired="Code has expired"),va(r.verifyWebMsgCount)||(r.verifyWebMsgCount="Go to the website automatically after {s} seconds..."),ja(r.funcs)||(r.funcs={}),Sa(r.routes)||(r.routes=[]);var l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.url||(e.url="mongodb://127.0.0.1:27017"),e.db||(e.db="worm"),e.cl||(e.cl="test");var t=n.MongoClient;function r(){return(r=s(regeneratorRuntime.mark((function r(){var n,o,a,i,c=arguments;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=c.length>0&&void 0!==c[0]?c[0]:{},o=Qo(),r.next=4,t.connect(e.url,bi);case 4:return a=r.sent,i=a.db(e.db),i.collection(e.cl).find(n).toArray((function(e,t){e?o.reject(e):(t=Po(t,(function(e){return e=di(e,"_id")})),o.resolve(t)),a.close()})),r.abrupt("return",o);case 9:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function a(e){return i.apply(this,arguments)}function i(){return(i=s(regeneratorRuntime.mark((function r(n){var o,a,i,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=Kr(n),o=Qo(),r.next=4,t.connect(e.url,bi);case 4:return a=r.sent,i=a.db(e.db),c=i.collection(e.cl),Sa(n)||(n=[n]),n=Po(n,(function(e){return e.id||(e.id=wa()),e})),c.insertMany(n,(function(e,t){e?o.reject(e):t.insertedCount>0?o.resolve(t.result):o.reject(e),a.close()})),r.abrupt("return",o);case 11:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function c(){return(c=s(regeneratorRuntime.mark((function r(n){var o,i,c,u,s,l,f,p,v=arguments;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=v.length>1&&void 0!==v[1]?v[1]:{},n=Kr(n),i=mo(o,"autoInsert",!0),c=mo(o,"atomic",!1),u=Qo(),r.next=7,t.connect(e.url,bi);case 7:return s=r.sent,l=s.db(e.db),f=l.collection(e.cl),Sa(n)||(n=[n]),p=null,p=c?"findOneAndUpdate":"updateOne",gi(n,(function(e){var t=Qo();return f[p]({id:e.id},{$set:e},(function(r,n){r?t.reject(r):(n.lastErrorObject&&(n.result={n:n.lastErrorObject.n,nModified:n.lastErrorObject.updatedExisting?1:0,ok:1}),i&&0===n.result.n?a(e).then((function(e){e.nInserted=1,t.resolve(e)})).catch((function(e){t.reject(e)})):t.resolve(n.result))})),t})).then((function(e){u.resolve(e)})).catch((function(e){u.reject(e)})).finally((function(){s.close()})),r.abrupt("return",u);case 15:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function u(){return(u=s(regeneratorRuntime.mark((function r(n){var o,a,i,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=Kr(n),o=Qo(),r.next=4,t.connect(e.url,bi);case 4:return a=r.sent,i=a.db(e.db),c=i.collection(e.cl),Sa(n)||(n=[n]),gi(n,(function(e){var t=Qo();return c.deleteOne({id:e.id},(function(e,r){e?t.resolve(e):((r=r.result).nDeleted=1,t.resolve(r))})),t})).then((function(e){o.resolve(e)})).catch((function(e){o.reject(e)})).finally((function(){a.close()})),r.abrupt("return",o);case 10:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function l(){return(l=s(regeneratorRuntime.mark((function r(){var n,o,a,i,c=arguments;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=c.length>0&&void 0!==c[0]?c[0]:{},o=Qo(),r.next=4,t.connect(e.url,bi);case 4:return a=r.sent,i=a.db(e.db),i.collection(e.cl).deleteMany(n,(function(e,t){e?o.resolve(e):(t=t.result,o.resolve(t)),a.close()})),r.abrupt("return",o);case 9:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function f(){return(f=s(regeneratorRuntime.mark((function r(a){var i,c,u,s,l,f,p;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=Qo(),c=wa(),u=Buffer.from(a),r.next=5,t.connect(e.url,bi);case 5:return s=r.sent,l=s.db(e.db),f=new n.GridFSBucket(l,{chunkSizeBytes:10485760,bucketName:e.cl}),(p=new o.Readable)._read=function(){},p.push(u),p.push(null),p.pipe(f.openUploadStream(c)).on("error",(function(e){i.reject(e),s.close()})).on("finish",(function(){i.resolve({n:1,ok:1,id:c}),s.close()})),r.abrupt("return",i);case 14:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function p(){return(p=s(regeneratorRuntime.mark((function r(o){var a,i,c,u,s,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=Qo(),r.next=3,t.connect(e.url,bi);case 3:return i=r.sent,c=i.db(e.db),u=new n.GridFSBucket(c,{chunkSizeBytes:10485760,bucketName:e.cl}),s=Buffer.from(""),(l=u.openDownloadStreamByName(o)).on("data",(function(e){s=Buffer.concat([s,e])})),l.on("error",(function(e){a.reject(e),i.close()})),l.on("end",(function(){var e=new Uint8Array(s);s=null,a.resolve(e),i.close()})),r.abrupt("return",a);case 12:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function v(){return h.apply(this,arguments)}function h(){return(h=s(regeneratorRuntime.mark((function r(){var o,a,i,c,u,s=arguments;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=s.length>0&&void 0!==s[0]?s[0]:{},a=s.length>1&&void 0!==s[1]?s[1]:null,i=Qo(),null!==a){r.next=9;break}return r.next=6,t.connect(e.url,bi);case 6:c=r.sent,u=c.db(e.db),a=new n.GridFSBucket(u,{chunkSizeBytes:10485760,bucketName:e.cl});case 9:return a.find(o).toArray((function(e,t){e?i.reject(e):i.resolve(t)})),r.abrupt("return",i);case 11:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function d(){return(d=s(regeneratorRuntime.mark((function r(o){var a,i,c,u,s,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=Qo(),r.next=3,t.connect(e.url,bi);case 3:return i=r.sent,c=i.db(e.db),u=new n.GridFSBucket(c,{chunkSizeBytes:10485760,bucketName:e.cl}),r.next=8,v({filename:o},u);case 8:return 0===(s=r.sent).length?(a.reject("can not find id"),i.close()):s.length>1?(a.reject("duplicate id"),i.close()):(l=s[0]._id,u.delete(l,(function(e){e?a.reject(e):a.resolve({n:1,nDeleted:1,ok:1}),i.close()}))),r.abrupt("return",a);case 11:case"end":return r.stop()}}),r)})))).apply(this,arguments)}function y(e,t){return g.apply(this,arguments)}function g(){return(g=s(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Qo(),r.delete(t,(function(e){e?n.reject(e):n.resolve({n:1,nDeleted:1,ok:1})})),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return(b=s(regeneratorRuntime.mark((function r(){var o,a,i,c,u,s,l,f=arguments;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=f.length>0&&void 0!==f[0]?f[0]:{},a=Qo(),r.next=4,t.connect(e.url,bi);case 4:return i=r.sent,c=i.db(e.db),u=new n.GridFSBucket(c,{chunkSizeBytes:10485760,bucketName:e.cl}),r.next=9,v(o,u);case 9:return s=r.sent,l=Po(s,(function(e){return y(e._id,u)})),Promise.all(l).then((function(e){a.resolve({n:s.length,ok:1})})).catch((function(e){a.reject(e)})).finally((function(){i.close()})),r.abrupt("return",a);case 13:case"end":return r.stop()}}),r)})))).apply(this,arguments)}return{select:function(){return r.apply(this,arguments)},insert:a,save:function(e){return c.apply(this,arguments)},del:function(e){return u.apply(this,arguments)},delAll:function(){return l.apply(this,arguments)},selectGfs:function(e){return p.apply(this,arguments)},insertGfs:function(e){return f.apply(this,arguments)},delGfs:function(e){return d.apply(this,arguments)},delAllGfs:function(){return b.apply(this,arguments)}}}({url:r.mongoUrl,db:r.mongoDb,cl:r.mongoCl}),f={id:{type:"String",public:!0,necessary:!0,exclude:[],canModify:!1},name:{type:"String",public:!0,necessary:!1,exclude:Pi,canModify:!0},pwEnc:{type:"String",public:!1,necessary:!0,exclude:[],canModify:!1},email:{type:"String",public:!0,necessary:!0,exclude:Pi,canModify:!0},address:{type:"String",public:!0,necessary:!1,exclude:Pi,canModify:!0},phone:{type:"String",public:!0,necessary:!1,exclude:Pi,canModify:!0},organization:{type:"String",public:!0,necessary:!1,exclude:Pi,canModify:!0},position:{type:"String",public:!0,necessary:!1,exclude:Pi,canModify:!0},role:{type:"String",public:!0,necessary:!0,exclude:Pi,canModify:!1},checkCode:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},token:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},tokenExp:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},timeCreate:{type:"String",public:!1,necessary:!0,exclude:[],canModify:!1},timeLogin:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},data:{type:"Object",public:!1,necessary:!1,exclude:[],canModify:!1},active:{type:"String",public:!1,necessary:!0,exclude:[],canModify:!1}},v=Da(l.save);function d(e,t){if(_a(f,e)){var r=f[e].type,n=f[e].exclude;return"String"===r?pa(t)?function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"anyone";if(!va(e))return!1;if("anyone"!==r&&"all"!==r)return!1;if(pa(t)){if(!va(t))return!1;t=[t]}if(!Ea(t))return!1;var n=!1;if(nn(t,(function(e){va(e)||(n=!0)})),n)return!1;var o=0;return nn(t,(function(t){-1!==function(e,t){return e.indexOf(t)}(e,t)&&o++})),"anyone"===r?o>0:"all"===r&&o===t.length}(t,n)?Ei('can not contain special characters: "<" or ">"'):Mi():Ei("value is not string: "+t):"Object"===r?ja(t)?Mi():Ei("value is not object: "+t):Ei("type is not defined: "+r)}return Ei("invalid key: "+e)}function y(e){return nn(e,(function(e,t){var r=d(t,e);if("error"===r.state)return r})),Mi()}function g(e){return nn(f,(function(t,r){var n="";"Object"===t.type&&(n={}),_a(e,r)&&null!==e[r]&&void 0!==e[r]||(e[r]=n)})),e}function b(){return(b=h(p.mark((function e(t){var r,n,o,a;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.token,n=t.find,o=Qo(),a=null,e.next=5,N(r);case 5:if("error"!==(a=e.sent).state){e.next=9;break}return o.reject(a.msg),e.abrupt("return",o);case 9:return l.select(n).then((function(e){if(e.length>=1){var t=e,r=[];nn(f,(function(e,t){e.public&&r.push(t)})),t=Po(t,(function(e){return Ko(e,r)})),o.resolve(t)}else o.reject("can not find user")})).catch((function(e){console.log("selectPublic catch:",e,"find:",n),o.reject("error")})),e.abrupt("return",o);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=Da((function(e){return b.apply(this,arguments)}));function w(){return(w=h(p.mark((function e(t){var n,o;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Qo(),o=null,va(t.pwEnc)){e.next=5;break}return n.reject("invalid password"),e.abrupt("return",n);case 5:if(Pa(t.email)){e.next=8;break}return n.reject("invalid email"),e.abrupt("return",n);case 8:return e.next=10,_({email:t.email});case 10:if(!e.sent){e.next=14;break}return n.reject("email has been used"),e.abrupt("return",n);case 14:if("error"!==(o=y(t)).state){e.next=18;break}return n.reject(o.msg),e.abrupt("return",n);case 18:return(t=g(t)).id=wa(),""!==r.salt&&(t.pwEnc=Ra(t.pwEnc+r.salt)),t.checkCode=wa(),t.timeCreate=Oa(),t.role=Ci.roleGeneral,t.active=Ai.activeYes,l.insert(t).then((function(e){n.resolve({id:t.id,checkCode:t.checkCode})})).catch((function(e){console.log("insert catch:",e,"user:",t),n.reject("error")})),e.abrupt("return",n);case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var j=Da((function(e){return w.apply(this,arguments)}));function x(e){var t=Qo();return l.select(e).then((function(e){1===e.length?t.resolve(e[0]):e.length>1?t.reject("find ".concat(e.length," users")):t.reject("can not find user")})).catch((function(r){console.log("selectOne catch:",r,"find:",e),t.reject("error")})),t}var k=Da(x);function _(e){var t=Qo();return xa(e)?(l.select(e).then((function(e){e.length>=1?t.resolve(!0):t.resolve(!1)})).catch((function(r){console.log("select catch:",r,"find:",e),t.reject("error")})),t):(t.reject("invalid find"),t)}function O(){return(O=h(p.mark((function e(t){var n,o,a,i,c;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Qo(),o=null,e.next=4,j(t);case 4:if("error"!==(o=e.sent).state){e.next=8;break}return n.reject(o.msg),e.abrupt("return",n);case 8:return a=o.msg.id,t.id=a,i=o.msg.checkCode,t.checkCode=i,c="".concat(r.authUrl,"?checkCode=").concat(i),e.next=15,q(t.name,c,t.email);case 15:if("error"!==(o=e.sent).state){e.next=20;break}return console.log("signUp catch:",o.msg,"emailObj:",{name:t.name,urlCheckCode:c,email:t.email}),n.reject("can not send email"),e.abrupt("return",n);case 20:return n.resolve(t.id),e.abrupt("return",n);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S=Da((function(e){return O.apply(this,arguments)}));function M(){return(M=h(p.mark((function e(n){var o,a,i,c,u,s,l,f;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.email,a=n.pwEnc,i=Qo(),c=null,va(o)){e.next=6;break}return i.reject("invalid email"),e.abrupt("return",i);case 6:if(va(a)){e.next=9;break}return i.reject("invalid password"),e.abrupt("return",i);case 9:return u={email:o},e.next=12,k(u);case 12:if("error"!==(c=e.sent).state){e.next=17;break}return console.log("logIn catch:",c.msg,"find:",u),i.reject("email or password is incorrect"),e.abrupt("return",i);case 17:if(""===(s=c.msg).checkCode){e.next=21;break}return i.reject("account is not verified"),e.abrupt("return",i);case 21:if(""!==r.salt&&(a=Ra(a+r.salt)),s.pwEnc===a){e.next=25;break}return i.reject("email or password is incorrect"),e.abrupt("return",i);case 25:if(s.active===Ai.activeYes){e.next=28;break}return i.reject("account is suspended"),e.abrupt("return",i);case 28:return e.next=30,N(s.token);case 30:if("success"!==(c=e.sent).state){e.next=34;break}return i.resolve(s.token),e.abrupt("return",i);case 34:return l=wa(),f={id:s.id,token:l,tokenExp:Si(t().add(r.timeTokenExp,"minute")),timeLogin:Oa()},e.next=38,v(f);case 38:if("error"!==(c=e.sent).state){e.next=43;break}return console.log("logIn catch:",c.msg,"userModify:",f),i.reject("can not save token"),e.abrupt("return",i);case 43:return i.resolve(l),e.abrupt("return",i);case 45:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=Da((function(e){return M.apply(this,arguments)}));function C(){return(C=h(p.mark((function e(t){var r,n,o,a,i;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Qo(),n=null,va(t)){e.next=5;break}return r.reject("invalid token"),e.abrupt("return",r);case 5:return o={token:t},e.next=8,k(o);case 8:if("error"!==(n=e.sent).state){e.next=13;break}return console.log("logOut catch:",n.msg,"find:",o),r.reject("invalid token"),e.abrupt("return",r);case 13:return a=n.msg,i={id:a.id,token:"",tokenExp:""},e.next=17,v(i);case 17:if("error"!==(n=e.sent).state){e.next=22;break}return console.log("logOut catch:",n.msg,"userModify:",i),r.reject("can not update token"),e.abrupt("return",r);case 22:return r.resolve("success"),e.abrupt("return",r);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var A=Da((function(e){return C.apply(this,arguments)}));function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"false",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=r.verifyWebHtml;return o=ka(o,{"{rdWebName}":r.webName,"{rdWebDescription}":r.webDescription,"{rdWebUrl}":r.webUrl,"{rdLogo}":r.verifyWebLogo,"{rdMessage}":e,"{rdCountdown}":t,"{rdCountdownMessage}":n})}function L(e){var t=Qo(),n=r.verifyWebMsgCount;return function(e){var t=Qo();if(!va(e))return t.reject(r.verifyWebMsgExpired),t;var n={checkCode:e};return x(n).then((function(e){var t={id:e.id,checkCode:""};return l.save(t)})).then((function(e){t.resolve(r.verifyWebMsgSuccess)})).catch((function(e){console.log("verifyCheckCode catch:",e,"find:",n),t.reject(r.verifyWebMsgExpired)})),t}(e).then((function(r){c("verifyCheckCodeAndGetHtml",{state:"success",msg:r,checkCode:e}),t.resolve(P(r,"true",n))})).catch((function(r){c("verifyCheckCodeAndGetHtml",{state:"error",msg:r,checkCode:e}),t.resolve(P(r,"false",""))})),t}function B(e){var n=Qo();if(Aa(e)){var o=t(),a=t(e,"YYYY-MM-DDTHH:mm:ssZ").diff(o,"minute");a>0?n.resolve("success"):a>r.timeTokenExp?(console.log("verifyTokenExp error:","iMinutes="+a,">","timeTokenExp="+r.timeTokenExp),n.reject("invalid tokenExp")):n.reject("token expired")}else n.reject("no expire time for token");return n}var W=Da(B);function T(){return(T=h(p.mark((function e(t){var r,n,o,a;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Qo(),n=null,va(t)){e.next=5;break}return r.reject("invalid token"),e.abrupt("return",r);case 5:return o={token:t},e.next=8,k(o);case 8:if("error"!==(n=e.sent).state){e.next=13;break}return console.log("isValidToken catch:",n.msg,"find:",o),r.reject("invalid token"),e.abrupt("return",r);case 13:if(a=n.msg,"error"!==(n=W(a.tokenExp)).state){e.next=18;break}return r.reject(n.msg),e.abrupt("return",r);case 18:return r.resolve("success"),e.abrupt("return",r);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=Da((function(e){return T.apply(this,arguments)}));function U(){return(U=h(p.mark((function e(n){var o,a,i,c,u;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=Qo(),a=null,va(n)){e.next=5;break}return o.reject("invalid token"),e.abrupt("return",o);case 5:return i={token:n},e.next=8,k(i);case 8:if("error"!==(a=e.sent).state){e.next=13;break}return console.log("refreshTokenExp catch:",a.msg,"find:",i),o.reject("invalid token"),e.abrupt("return",o);case 13:if(c=a.msg,"error"!==(a=B(c.tokenExp)).state){e.next=18;break}return o.reject(a.err),e.abrupt("return",o);case 18:return u={id:c.id,tokenExp:Si(t().add(r.timeTokenExp,"minute"))},e.next=21,v(u);case 21:if("error"!==(a=e.sent).state){e.next=26;break}return console.log("refreshTokenExp catch:",a.msg,"userModify:",u),o.reject("can not update token"),e.abrupt("return",o);case 26:return o.resolve("success"),e.abrupt("return",o);case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var R=Da((function(e){return U.apply(this,arguments)}));function D(e){return z.apply(this,arguments)}function z(){return(z=h(p.mark((function e(t){var r,n,o,a;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Qo(),n=null,o={token:t},e.next=5,k(o);case 5:if("error"!==(n=e.sent).state){e.next=10;break}return console.log("getUserFromToken catch:",n.msg,"find:",o),r.reject("invalid token"),e.abrupt("return",r);case 10:return a=n.msg,r.resolve(a),e.abrupt("return",r);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(){return(H=h(p.mark((function e(t){var n,o,a,i,c,u,s,l;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.email,o=t.pwEnc,a=t.pwEncNew,i=Qo(),c=null,va(n)){e.next=6;break}return i.reject("invalid email"),e.abrupt("return",i);case 6:if(va(o)){e.next=9;break}return i.reject("invalid old password"),e.abrupt("return",i);case 9:if(va(a)){e.next=12;break}return i.reject("invalid new password"),e.abrupt("return",i);case 12:return u={email:n},e.next=15,k(u);case 15:if("error"!==(c=e.sent).state){e.next=20;break}return console.log("changePW catch:",c.msg,"find:",u),i.reject("email or password is incorrect"),e.abrupt("return",i);case 20:if(""===(s=c.msg).checkCode){e.next=24;break}return i.reject("account is not verified"),e.abrupt("return",i);case 24:if(s.active===Ai.activeYes){e.next=27;break}return i.reject("account is suspended"),e.abrupt("return",i);case 27:if(""!==r.salt&&(o=Ra(o+r.salt),a=Ra(a+r.salt)),s.pwEnc===o){e.next=31;break}return i.reject("email or password is incorrect"),e.abrupt("return",i);case 31:return l={id:s.id,pwEnc:a},e.next=34,v(l);case 34:if("error"!==(c=e.sent).state){e.next=39;break}return console.log("changePW catch:",c.msg,"userModify:",l),i.reject("can not update password"),e.abrupt("return",i);case 39:return i.resolve("success"),e.abrupt("return",i);case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=Da((function(e){return H.apply(this,arguments)}));function F(){return(F=h(p.mark((function e(t){var n,o,a,i,c,u,s,l,f;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.email,o=t.pwEncNew,a=Qo(),i=null,va(n)){e.next=6;break}return a.reject("invalid email"),e.abrupt("return",a);case 6:if(va(o)){e.next=9;break}return a.reject("invalid new password"),e.abrupt("return",a);case 9:return c={email:n},e.next=12,k(c);case 12:if("error"!==(i=e.sent).state){e.next=17;break}return console.log("resetPW catch:",i.msg,"find:",c),a.reject("email is incorrect"),e.abrupt("return",a);case 17:if((u=i.msg).active===Ai.activeYes){e.next=21;break}return a.reject("account is suspended"),e.abrupt("return",a);case 21:return""!==r.salt&&(o=Ra(o+r.salt)),s=wa(),l={id:u.id,pwEnc:o,checkCode:s},e.next=26,v(l);case 26:if("error"!==(i=e.sent).state){e.next=31;break}return console.log("resetPW catch:",i.msg,"userModify:",l),a.reject("can not update password"),e.abrupt("return",a);case 31:return f="".concat(r.authUrl,"?checkCode=").concat(s),e.next=34,Z(u.name,f,u.email);case 34:if("error"!==(i=e.sent).state){e.next=39;break}return console.log("resetPW catch:",i.msg,"emailObj:",{name:u.name,urlCheckCode:f,email:u.email}),a.reject("can not send email"),e.abrupt("return",a);case 39:return a.resolve("success"),e.abrupt("return",a);case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var G=Da((function(e){return F.apply(this,arguments)}));function Y(){return(Y=h(p.mark((function e(t){var r,n,o,a,i,c,u;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.token,n=t.user,o=Qo(),a=null,e.next=5,N(r);case 5:if("error"!==(a=e.sent).state){e.next=9;break}return o.reject(a.msg),e.abrupt("return",o);case 9:if("error"!==(a=y(n)).state){e.next=13;break}return o.reject(a.msg),e.abrupt("return",o);case 13:return e.next=15,D(r);case 15:if(i=e.sent,c={id:i.id},u=!1,nn(f,(function(e,t){e.canModify&&n[t]&&i[t]!==n[t]&&(u=!0,c[t]=n[t])})),u){e.next=22;break}return o.resolve("no change"),e.abrupt("return",o);case 22:return e.next=24,v(c);case 24:if("error"!==(a=e.sent).state){e.next=29;break}return console.log("modifyInfor catch:",a.msg,"userModify:",c),o.reject("can not modify"),e.abrupt("return",o);case 29:return o.resolve("success"),e.abrupt("return",o);case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $=Da((function(e){return Y.apply(this,arguments)}));function V(e,t,n,o,a){var i=r.emLetterHtml,c=r.webName,u=r.webUrl,s=r.emLetterLinks;return""!==c&&""!==u&&(s=To({name:c,url:u},s)),s=Po(s,(function(e){var t=mo(e,"name",""),r=mo(e,"url","");return'<a style="text-decoration:none" href="'.concat(r,'" target="_blank" >').concat(t,"</a>")})),s="| ".concat(Uo(s," | ")," |"),function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return new mi({srcName:r.emSenderName,srcEmail:r.emSenderEmail,srcPW:r.emSenderPW,emTitle:e,emContent:t,toEmails:n,toEmailsCC:o,toEmailsBCC:a})}(e,i=ka(i,{"{emMessage}":t,"{emWebName}":c,"{emWebUrl}":u,"{emWebDescription}":r.webDescription,"{emLetterDoNotReplayMessage}":r.emLetterDoNotReplayMessage,"{emLetterTeamMessage}":r.emLetterTeamMessage,"{emLetterLinks}":s}),n,o,a)}var q=Da((function(e,t,n){var o=r.emSignUpTitle,a=r.emSignUpHtml;return V(o,a=ka(a,{"{name}":e,"{urlCheckCode}":t}),n,[],r.emBCC)})),Z=Da((function(e,t,n){var o=r.emResetPWTitle,a=r.emResetPWHtml;return V(o,a=ka(a,{"{name}":e,"{urlCheckCode}":t}),n,[],r.emBCC)})),J={select:function(e){return u(m,"selectPublic")(e)},signUp:function(e){return u(S,"signUp")(e)},logIn:function(e){return u(E,"logIn")(e)},refreshTokenExp:function(e){return u(R,"refreshTokenExp")(e)},isValidToken:function(e){return u(N,"isValidToken")(e)},logOut:function(e){return u(A,"logOut")(e)},changePW:function(e){return u(I,"changePW")(e)},resetPW:function(e){return u(G,"resetPW")(e)},modifyInfor:function(e){return u($,"modifyInfor")(e)}};nn(r.funcs,(function(e,t){_a(J,t)?console.log("invalid func: "+t):J[t]=r.funcs[t]}));var X,K=[{method:"GET",path:"/auth",handler:(X=h(p.mark((function e(t,r){var n;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.query.checkCode,e.abrupt("return",L(n));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return X.apply(this,arguments)})}];return nn(r.routes,(function(e){K.push(e)})),new ri(r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Oi(r,!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Oi(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},r,{onClientChange:function(e,t){c("clientChange",e.length,e)},funcs:J,routes:K})),a}}));
//# sourceMappingURL=w-user-server.umd.js.map
