/*!
 * w-user-server v1.0.2
 * (c) 2018-2019 yuda-lyu(semisphere)
 * Released under the MIT License.
 */(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("events"),require("dayjs"),require("@hapi/hapi"),require("mongodb"),require("stream"),require("nodemailer")):"function"==typeof define&&define.amd?define(["events","dayjs","@hapi/hapi","mongodb","stream","nodemailer"],t):(e=e||self,e["w-user-server"]=t(e.events,e.dayjs,e["@hapi/hapi"],e.mongodb,e.stream,e.nodemailer))})(this,function(e,n,o,a,s,l){'use strict';var Oe=Math.min,We=Math.max;function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function p(e,t,r,n,o,a,s){try{var l=e[a](s),i=l.value}catch(e){return void r(e)}l.done?t(i):Promise.resolve(i).then(n,o)}function d(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){function a(e){p(l,n,o,a,s,"next",e)}function s(e){p(l,n,o,a,s,"throw",e)}var l=e.apply(t,r);a(void 0)})}}function u(e,t){return t={exports:{}},e(t,t.exports),t.exports}function y(e,t,r,n,o,a,s){try{var l=e[a](s),i=l.value}catch(e){return void r(e)}l.done?t(i):Promise.resolve(i).then(n,o)}function g(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function h(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":at&&at in Object(e)?tt(e):ot(e)}function m(e){var t=c(e);return null!=e&&("object"==t||"function"==t)}function f(e){return!!dt&&dt in e}function b(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function x(e){var t=c(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function j(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function w(e){var t=this.__data__=new Ge(e);this.size=t.size}function k(e,t,r){var n=e[t];Ft.call(e,t)&&De(n,r)&&(r!==void 0||t in e)||Bt(e,t,r)}function v(e){return null!=e&&"object"==c(e)}function _(e,t){var r=c(e);return t=null==t?9007199254740991:t,!!t&&("number"==r||"symbol"!=r&&nr.test(e))&&-1<e&&0==e%1&&e<t}function S(e,t,r,n,o,a){var s=1&t,l=2&t,i;if(r&&(i=o?r(e,n,o,a):r(e)),void 0!==i)return i;if(!lt(e))return e;var c=er(e);if(!c){var p=fn(e),d="[object Function]"==p||"[object GeneratorFunction]"==p;if(rr(e))return Ar(e,s);if("[object Object]"!=p&&"[object Arguments]"!=p&&(!d||o)){if(!In[p])return o?e:{};i=An(e,p,s)}else if(i=l||d?{}:Tn(e),!s)return l?Vr(e,Pr(i,e)):Br(e,_r(i,e))}else if(i=jn(e),!s)return Or(e,i);a||(a=new zt);var u=a.get(e);if(u)return u;a.set(e,i),Bn(e)?e.forEach(function(n){i.add(S(n,t,r,n,e,a))}):Un(e)&&e.forEach(function(n,o){i.set(o,S(n,t,r,o,e,a))});var y=4&t?l?$r:qr:l?keysIn:vr,g=c?void 0:y(e);return Ut(g||e,function(n,o){g&&(o=n,n=e[o]),Gt(i,o,S(n,t,r,o,e,a))}),i}function M(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new Nt;++t<r;)this.add(e[t])}function C(e,t,r,n,o,a){var s=1&r,l=qr(e),i=l.length,c=qr(t),p=c.length;if(i!=p&&!s)return!1;for(var d=i,u;d--;)if(u=l[d],s?!(u in t):!lo.call(t,u))return!1;var y=a.get(e);if(y&&a.get(t))return y==t;var g=!0;a.set(e,t),a.set(t,e);for(var h=s;++d<i;){u=l[d];var m=e[u],f=t[u];if(n)var b=s?n(f,m,u,t,e,a):n(m,f,u,e,t,a);if(void 0===b?!(m===f||o(m,f,r,n,a)):!b){g=!1;break}h||(h="constructor"==u)}if(g&&!h){var x=e.constructor,j=t.constructor;x!=j&&"constructor"in e&&"constructor"in t&&!("function"==typeof x&&x instanceof x&&"function"==typeof j&&j instanceof j)&&(g=!1)}return a["delete"](e),a["delete"](t),g}function L(e,t,r,n,o){return!(e!==t)||(null!=e&&null!=t&&(Jt(e)||Jt(t))?po(e,t,r,n,L,o):e!==e&&t!==t)}function E(e,t,r,n){var o=r.length,a=o,s=!n;if(null==e)return!a;for(e=Object(e);o--;){var l=r[o];if(s&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++o<a;){l=r[o];var i=l[0],c=e[i],p=l[1];if(!(s&&l[2])){var d=new zt;if(n)var u=n(c,p,i,e,t,d);if(void 0===u?!uo(p,c,3,n,d):!u)return!1}else if(void 0===c&&!(i in e))return!1}return!0}function P(e){return"symbol"==c(e)||Jt(e)&&st(e)=="[object Symbol]"}function A(e,t){if(er(e))return!1;var r=c(e);return!!("number"==r||"symbol"==r||"boolean"==r||null==e||fo(e))||xo.test(e)||!bo.test(e)||null!=t&&e in Object(t)}function O(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function r(){var n=arguments,o=t?t.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var s=e.apply(this,n);return r.cache=a.set(o,s)||a,s};return r.cache=new(O.Cache||Nt),r}function W(e){if("string"==typeof e)return e;if(er(e))return $n(e,W)+"";if(fo(e))return Mo?Mo.call(e):"";var t=e+"";return"0"==t&&1/e==-_o?"-0":t}function T(e,t){return null!=e&&t in Object(e)}function N(e){return"function"==typeof e?e:null==e?Vn:"object"==c(e)?er(e)?To(e[0],e[1]):mo(e):Uo(e)}function z(e,t,r,n,o){var a=-1,s=e.length;for(r||(r=Fo),o||(o=[]);++a<s;){var l=e[a];0<t&&r(l)?1<t?z(l,t-1,r,n,o):Ir(o,l):!n&&(o[o.length]=l)}return o}function U(){var e=new Promise(function(){t=arguments[0],r=arguments[1]}),t,r;return e.resolve=t,e.reject=r,e}function H(e){var t=Object.prototype.toString.call(e);return"[object String]"===t}function D(e){return!!(H(e)&&""!==e)}function B(e){var t=Object.prototype.toString.call(e);return"[object Number]"===t}function I(e){var t=!1;return D(e)?t=!isNaN(+e):B(e)&&(t=!0),t}function F(e){if(!I(e))return 0;var t=ma(e);return t}function G(e){return!!I(e)&&(e=F(e),ba(e))}function R(e){if(!I(e))return 0;e=F(e);var t=wa(e);return"0"===t+""?0:t}function Y(e){if(!G(e))return!1;var t=0<R(e);return t}function J(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:32,t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],n=[],o=t.length,a;if(Y(e))for(a=0;a<e;a++)n[a]=t[0|Math.random()*o];else if("rfc4122"===e){n[8]=n[13]=n[18]=n[23]="-",n[14]="4";var s;for(a=0;36>a;a++)n[a]||(s=0|16*Math.random(),n[a]=t[19===a?8|3&s:s])}else return"";var l=n.join("");return l}function V(e){var t=Object.prototype.toString.call(e);return"[object Object]"===t}function Z(e){if(V(e)){for(var t in e)return!0;return!1}return!1}function q(e,n,t){if(!D(e))return"";if(!D(n))return"";if(!H(t))return"";var r=new RegExp(n,"g"),o=(e+"").replace(r,t);return o}function $(e,t){if(!D(e))return"";if(!Z(t))return"";var r=!1;return(qn(t,function(e){H(e)||(r=!0)}),r)?"":(qn(t,function(t,r){e=q(e,r,t)}),e)}function X(e,t){return!!V(e)&&!!D(t)&&t in e}function Q(){var e=n(),t=e.format("YYYY-MM-DDTHH:mm:ssZ");return t}function K(e){var t=Object.prototype.toString.call(e);return"[object Array]"===t}function ee(e){var t=Object.prototype.toString.call(e);return"[object Undefined]"===t}function te(e){var t=Object.prototype.toString.call(e);return"[object Null]"===t}function re(e){if(V(e)){for(var t in e)return!1;return!0}return!1}function ne(e){return!!(H(e)&&""===e)}function oe(e){return!!K(e)&&0===e.length}function ae(e){return!!ee(e)||!!te(e)||!!re(e)||!!ne(e)||!!oe(e)}function se(e){return!!K(e)&&0!==e.length&&!(1===e.length&&ae(e[0]))}function le(e,t){function r(e,t){return e.indexOf(t)}var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"anyone";if(!D(e))return!1;if("anyone"!==o&&"all"!==o)return!1;if(H(t))if(D(t))t=[t];else return!1;if(!se(t))return!1;var a=!1;if(qn(t,function(e){D(e)||(a=!0)}),a)return!1;var s=0;return(qn(t,function(t){-1!==r(e,t)&&s++}),"anyone"===o)?0<s:"all"===o&&s===t.length}function ie(e,t){return D(e)?Y(t)?e.substr(0,t):"":""}function ce(e,t){return D(e)?Y(t)?ie(e,e.length-t):"":""}function pe(e,t){if(!D(e))return"";if(!Y(t))return"";var r=e.length-t;return 0>r&&(r=0),e.substr(r,t)}function de(e){if(!D(e))return!1;var r=pe(e,6);if(!/[+|-]\d\d:\d\d/.test(r))return!1;var o=ce(e,6),t="YYYY-MM-DDTHH:mm:ss",a=n(o,t).format(t);return o===a}function ue(e){return!!D(e)&&/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e)}function ye(e){return Ca(e)}function ge(e){var t=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];if(!D(e))return"";if(!ye(t))return"";var r=_a(e),n="";return n=t?r.toString(Sa):r.toString(Ma),n}function he(e){return function(){var t=U();return e.apply(this,arguments).then(function(e){t.resolve({state:"success",msg:e})})["catch"](function(e){t.resolve({state:"error",msg:e})}),t}}function me(e,t){return Z(e)?D(t)?Ao(e,t,""):"":""}function fe(e){if(!D(e)&&!I(e))return"";return e+""}function be(e,t){var n=me(e,t);return n=fe(n),n}function xe(e){var t=Object.prototype.toString.call(e);return"[object Function]"===t||"[object AsyncFunction]"===t}function je(e,t){if(D(e))e=[e];else if(se(e));else return!1;if(D(t))t=[t];else if(se(t));else return!1;for(var r=0;r<e.length;r++)for(var n=0;n<t.length;n++)if(e[r]===t[n])return!0;return!1}function we(e){function t(t){var r=U();return xe(e.authenticate)?e.authenticate(t).then(function(e){r.resolve(e)}):r.resolve(!0),r}function r(){return n.apply(this,arguments)}function n(){return n=d(regeneratorRuntime.mark(function r(n){var o,a,s,l,i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return o=be(n,"token"),r.next=3,t(o);case 3:if(a=r.sent,!a){r.next=25;break}if(s=be(n,"func"),l=me(n,"input"),"getFuncs"!==s){r.next=15;break}if(!xe(e.filterFuncs)){r.next=12;break}return r.next=11,e.filterFuncs(o,p);case 11:p=r.sent;case 12:n={output:{sys:"sys",funcs:p}},r.next=23;break;case 15:if(!je(p,s)){r.next=22;break}return r.next=18,e.funcs[s](l);case 18:i=r.sent,n.output=i,r.next=23;break;case 22:n.output={err:"can not find: ".concat(s)};case 23:r.next=26;break;case 25:n.output={err:"can not authenticate token: ".concat(o)};case 26:return r.abrupt("return",JSON.stringify(n));case 27:case"end":return r.stop();}},r)})),n.apply(this,arguments)}function a(t){if(xe(e.onClientChange)){var r=za(t,"clientId");Ua(c,r)||(c=r,e.onClientChange(c,e))}}function s(){return l.apply(this,arguments)}function l(){return l=d(regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=o.server({port:e.port,routes:{cors:!0}}),r.route(u),qn(e.routes,function(e){r.route(e)}),t.next=5,r.start();case 5:console.log("Server running at: ".concat(r.info.uri));case 6:case"end":return t.stop();}},t)})),l.apply(this,arguments)}var i=[],c=[];e=Gn(e),e.port||(e.port=8080),e.apiName||(e.apiName="api"),e.routes||(e.routes=[]);var p=[];X(e,"funcs")&&(p=vr(e.funcs));var u={path:"/"+e.apiName,method:"POST",handler:function(e){var t=U(),n=J(),o=Ao(e.payload,"clientId"),s={headers:e.headers,info:e.info};i.push({clientId:o,connId:n,data:s}),a(i);var l=e.payload;return r(l).then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)})["finally"](function(){i=i.filter(function(e){return e.connId!==n}),a(i)}),t}};e.serverHapi?e.serverHapi.route(u):s()}function ke(e,r){var n=U();if(!K(e))return n.reject("rs is not array"),n;if(!xe(r))return n.reject("v is not Function"),n;var o=[];return e.reduce(function(e,n){return e.then(function(e){return o.push(e),r(n)})},Promise.resolve()).then(function(e){o.push(e),o=Xa(o),n.resolve(o)})["catch"](function(e){n.reject(e)}),n}function ve(){function e(){return t.apply(this,arguments)}function t(){return t=d(regeneratorRuntime.mark(function e(){var t=arguments,r,n,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=0<t.length&&void 0!==t[0]?t[0]:{},n=U(),e.next=4,M.connect(S.url,{useNewUrlParser:!0});case 4:return o=e.sent,a=o.db(S.db),s=a.collection(S.cl),s.find(r).toArray(function(e,t){e?n.reject(e):(t=Bo(t,function(e){return e=$a(e,"_id"),e}),n.resolve(t)),o.close()}),e.abrupt("return",n);case 9:case"end":return e.stop();}},e)})),t.apply(this,arguments)}function r(){return n.apply(this,arguments)}function n(){return n=d(regeneratorRuntime.mark(function e(t){var r,n,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Gn(t),r=U(),e.next=4,M.connect(S.url,{useNewUrlParser:!0});case 4:return n=e.sent,o=n.db(S.db),a=o.collection(S.cl),K(t)||(t=[t]),t=Bo(t,function(e){return e.id||(e.id=J()),e}),a.insertMany(t,function(e,t){e?r.reject(e):0<t.insertedCount?r.resolve(t.result):r.reject(e),n.close()}),e.abrupt("return",r);case 11:case"end":return e.stop();}},e)})),n.apply(this,arguments)}function o(){return l.apply(this,arguments)}function l(){return l=d(regeneratorRuntime.mark(function e(t){var n=arguments,o,a,s,l,i,c,p,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=1<n.length&&void 0!==n[1]?n[1]:{},t=Gn(t),a=Ao(o,"autoInsert",!0),s=Ao(o,"atomic",!1),l=U(),e.next=7,M.connect(S.url,{useNewUrlParser:!0});case 7:return i=e.sent,c=i.db(S.db),p=c.collection(S.cl),K(t)||(t=[t]),d=null,d=s?"findOneAndUpdate":"updateOne",ke(t,function(e){var t=U();return p[d]({id:e.id},{$set:e},function(n,o){n?t.reject(n):(o.lastErrorObject&&(o.result={n:o.lastErrorObject.n,nModified:o.lastErrorObject.updatedExisting?1:0,ok:1}),a&&0===o.result.n?r(e).then(function(e){e.nInserted=1,t.resolve(e)})["catch"](function(e){t.reject(e)}):t.resolve(o.result))}),t}).then(function(e){l.resolve(e)})["catch"](function(e){l.reject(e)})["finally"](function(){i.close()}),e.abrupt("return",l);case 15:case"end":return e.stop();}},e)})),l.apply(this,arguments)}function i(){return c.apply(this,arguments)}function c(){return c=d(regeneratorRuntime.mark(function e(t){var r,n,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Gn(t),r=U(),e.next=4,M.connect(S.url,{useNewUrlParser:!0});case 4:return n=e.sent,o=n.db(S.db),a=o.collection(S.cl),K(t)||(t=[t]),ke(t,function(e){var t=U();return a.deleteOne({id:e.id},function(e,r){e?t.resolve(e):(r=r.result,r.nDeleted=1,t.resolve(r))}),t}).then(function(e){r.resolve(e)})["catch"](function(e){r.reject(e)})["finally"](function(){n.close()}),e.abrupt("return",r);case 10:case"end":return e.stop();}},e)})),c.apply(this,arguments)}function p(){return u.apply(this,arguments)}function u(){return u=d(regeneratorRuntime.mark(function e(){var t=arguments,r,n,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=0<t.length&&void 0!==t[0]?t[0]:{},n=U(),e.next=4,M.connect(S.url,{useNewUrlParser:!0});case 4:return o=e.sent,a=o.db(S.db),s=a.collection(S.cl),s.deleteMany(r,function(e,t){e?n.resolve(e):(t=t.result,n.resolve(t)),o.close()}),e.abrupt("return",n);case 9:case"end":return e.stop();}},e)})),u.apply(this,arguments)}function y(){return g.apply(this,arguments)}function g(){return g=d(regeneratorRuntime.mark(function e(t){var r,n,o,l,i,c,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=U(),n=J(),o=Buffer.from(t),e.next=5,M.connect(S.url,{useNewUrlParser:!0});case 5:return l=e.sent,i=l.db(S.db),c=new a.GridFSBucket(i,{chunkSizeBytes:10485760,bucketName:S.cl}),p=new s.Readable,p._read=function(){},p.push(o),p.push(null),p.pipe(c.openUploadStream(n)).on("error",function(e){r.reject(e),l.close()}).on("finish",function(){r.resolve({n:1,ok:1,id:n}),l.close()}),e.abrupt("return",r);case 14:case"end":return e.stop();}},e)})),g.apply(this,arguments)}function h(){return m.apply(this,arguments)}function m(){return m=d(regeneratorRuntime.mark(function e(t){var r,n,o,s,l,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=U(),e.next=3,M.connect(S.url,{useNewUrlParser:!0});case 3:return n=e.sent,o=n.db(S.db),s=new a.GridFSBucket(o,{chunkSizeBytes:10485760,bucketName:S.cl}),l=Buffer.from(""),i=s.openDownloadStreamByName(t),i.on("data",function(e){l=Buffer.concat([l,e])}),i.on("error",function(e){r.reject(e),n.close()}),i.on("end",function(){var e=new Uint8Array(l);l=null,r.resolve(e),n.close()}),e.abrupt("return",r);case 12:case"end":return e.stop();}},e)})),m.apply(this,arguments)}function f(){return b.apply(this,arguments)}function b(){return b=d(regeneratorRuntime.mark(function e(){var t=arguments,r,n,o,s,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=0<t.length&&void 0!==t[0]?t[0]:{},n=1<t.length&&void 0!==t[1]?t[1]:null,o=U(),null!==n){e.next=9;break}return e.next=6,M.connect(S.url,{useNewUrlParser:!0});case 6:s=e.sent,l=s.db(S.db),n=new a.GridFSBucket(l,{chunkSizeBytes:10485760,bucketName:S.cl});case 9:return n.find(r).toArray(function(e,t){e?o.reject(e):o.resolve(t)}),e.abrupt("return",o);case 11:case"end":return e.stop();}},e)})),b.apply(this,arguments)}function x(){return j.apply(this,arguments)}function j(){return j=d(regeneratorRuntime.mark(function e(t){var r,n,o,s,l,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=U(),e.next=3,M.connect(S.url,{useNewUrlParser:!0});case 3:return n=e.sent,o=n.db(S.db),s=new a.GridFSBucket(o,{chunkSizeBytes:10485760,bucketName:S.cl}),e.next=8,f({filename:t},s);case 8:return l=e.sent,0===l.length?(r.reject("can not find id"),n.close()):1<l.length?(r.reject("duplicate id"),n.close()):(i=l[0]._id,s["delete"](i,function(e){e?r.reject(e):r.resolve({n:1,nDeleted:1,ok:1}),n.close()})),e.abrupt("return",r);case 11:case"end":return e.stop();}},e)})),j.apply(this,arguments)}function w(){return k.apply(this,arguments)}function k(){return k=d(regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=U(),r["delete"](t,function(e){e?n.reject(e):n.resolve({n:1,nDeleted:1,ok:1})}),e.abrupt("return",n);case 3:case"end":return e.stop();}},e)})),k.apply(this,arguments)}function v(){return _.apply(this,arguments)}function _(){return _=d(regeneratorRuntime.mark(function e(){var t=arguments,r,n,o,s,l,i,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=0<t.length&&void 0!==t[0]?t[0]:{},n=U(),e.next=4,M.connect(S.url,{useNewUrlParser:!0});case 4:return o=e.sent,s=o.db(S.db),l=new a.GridFSBucket(s,{chunkSizeBytes:10485760,bucketName:S.cl}),e.next=9,f(r,l);case 9:return i=e.sent,c=Bo(i,function(e){var t=e._id;return w(t,l)}),Promise.all(c).then(function(){n.resolve({n:i.length,ok:1})})["catch"](function(e){n.reject(e)})["finally"](function(){o.close()}),e.abrupt("return",n);case 13:case"end":return e.stop();}},e)})),_.apply(this,arguments)}var S=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};S.url||(S.url="mongodb://127.0.0.1:27017"),S.db||(S.db="worm"),S.cl||(S.cl="test");var M=a.MongoClient;return{select:e,insert:r,save:o,del:i,delAll:p,selectGfs:h,insertGfs:y,delGfs:x,delAllGfs:v}}function _e(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=U(),r=Ao(e,"srcName","system by w-email"),n=Ao(e,"srcEmail","");if(!ue(n))return t.reject("srcEmail is not email"),t;var o=Ao(e,"srcPW",""),a=Ao(e,"srcHost","smtp.gmail.com"),s=Ao(e,"srcPort",587),i=Ao(e,"emTitle",""),c=Ao(e,"emContent",""),p=Ao(e,"emAttachments",[]);V(p)&&(p=[p]);var d=Ao(e,"toEmails",[]);H(d)&&(d=[d]);var u=Ao(e,"toEmailsCC",[]);H(u)&&(u=[u]);var y=Ao(e,"toEmailsBCC",[]);H(y)&&(y=[y]);var g=l.createTransport({host:a,secureConnecton:!0,port:s,auth:{user:n,pass:o}}),h={from:"".concat(r," <").concat(n,">"),to:d.join(","),cc:u.join(","),bcc:y.join(","),subject:i,html:c,attachments:p};return g.sendMail(h,function(e,r){e?t.reject(e):t.resolve(r.response)}),t}function Se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Me(e){for(var t=1,r;t<arguments.length;t++)r=null==arguments[t]?{}:arguments[t],t%2?Se(r,!0).forEach(function(t){Te(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Se(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))});return e}function Ce(e){return e.format("YYYY-MM-DDTHH:mm:ssZ")}function Le(e){return n(e,"YYYY-MM-DDTHH:mm:ssZ")}function Ee(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;return{state:"success",msg:e}}function Pe(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:null;return{state:"error",msg:e}}function Ae(){function t(e){for(var t=arguments.length,r=Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];setTimeout(function(){G.emit.apply(G,[e].concat(r)),G.emit("all",{eventName:e,data:[].concat(r)})},1)}function r(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return function(){function n(e){r&&t(r,{input:a,output:e})}var o=U(),a=Gn(arguments);return e.apply(this,arguments).then(function(e){n(e),o.resolve(e)})["catch"](function(e){n(e),o.resolve(e)}),o}}function o(r,n){if(X(q,r)){var o=q[r].type,t=q[r].exclude;return"String"===o?H(n)?le(n,t)?Pe("can not contain special characters: \"<\" or \">\""):Ee():Pe("value is not string: "+n):"Object"===o?V(n)?Ee():Pe("value is not object: "+n):Pe("type is not defined: "+o)}return Pe("invalid key: "+r)}function a(e){return qn(e,function(e,t){var n=o(t,e);if("error"===n.state)return n}),Ee()}function s(e){return qn(q,function(t,r){var n="";"Object"===t.type&&(n={}),X(e,r)?(null===e[r]||void 0===e[r])&&(e[r]=n):e[r]=n}),e}function l(){return i.apply(this,arguments)}function i(){return i=He(Ue.mark(function e(t){var n,o,a,s;return Ue.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.token,o=t.find,a=U(),s=null,e.next=5,ce(n);case 5:if(s=e.sent,"error"!==s.state){e.next=9;break}return a.reject(s.msg),e.abrupt("return",a);case 9:return R.select(o).then(function(e){if(1<=e.length){var t=e,r=[];qn(q,function(e,t){e["public"]&&r.push(t)}),t=Bo(t,function(e){return la(e,r)}),a.resolve(t)}else a.reject("can not find user")})["catch"](function(e){console.log("selectPublic catch:",e,"find:",o),a.reject("error")}),e.abrupt("return",a);case 11:case"end":return e.stop();}},e)})),i.apply(this,arguments)}function c(){return p.apply(this,arguments)}function p(){return p=He(Ue.mark(function e(t){var n,o,l;return Ue.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=U(),o=null,D(t.pwEnc)){e.next=5;break}return n.reject("invalid password"),e.abrupt("return",n);case 5:if(ue(t.email)){e.next=8;break}return n.reject("invalid email"),e.abrupt("return",n);case 8:return e.next=10,u({email:t.email});case 10:if(l=e.sent,!l){e.next=14;break}return n.reject("email has been used"),e.abrupt("return",n);case 14:if(o=a(t),"error"!==o.state){e.next=18;break}return n.reject(o.msg),e.abrupt("return",n);case 18:return t=s(t),t.id=J(),""!==F.salt&&(t.pwEnc=ge(t.pwEnc+F.salt)),t.checkCode=J(),t.timeCreate=Q(),t.role=Qa.roleGeneral,t.active=Ka.activeYes,R.insert(t).then(function(){n.resolve({id:t.id,checkCode:t.checkCode})})["catch"](function(e){console.log("insert catch:",e,"user:",t),n.reject("error")}),e.abrupt("return",n);case 27:case"end":return e.stop();}},e)})),p.apply(this,arguments)}function d(e){var t=U();return R.select(e).then(function(e){1===e.length?t.resolve(e[0]):1<e.length?t.reject("find ".concat(e.length," users")):t.reject("can not find user")})["catch"](function(r){console.log("selectOne catch:",r,"find:",e),t.reject("error")}),t}function u(e){var t=U();return Z(e)?(R.select(e).then(function(e){1<=e.length?t.resolve(!0):t.resolve(!1)})["catch"](function(r){console.log("select catch:",r,"find:",e),t.reject("error")}),t):(t.reject("invalid find"),t)}function y(){return g.apply(this,arguments)}function g(){return g=He(Ue.mark(function e(t){var n,o,a,s,l;return Ue.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=U(),o=null,e.next=4,re(t);case 4:if(o=e.sent,"error"!==o.state){e.next=8;break}return n.reject(o.msg),e.abrupt("return",n);case 8:return a=o.msg.id,t.id=a,s=o.msg.checkCode,t.checkCode=s,l="".concat(F.authUrl,"?checkCode=").concat(s),e.next=15,be(t.name,l,t.email);case 15:if(o=e.sent,"error"!==o.state){e.next=20;break}return console.log("signUp catch:",o.msg,"emailObj:",{name:t.name,urlCheckCode:l,email:t.email}),n.reject("can not send email"),e.abrupt("return",n);case 20:return n.resolve(t.id),e.abrupt("return",n);case 22:case"end":return e.stop();}},e)})),g.apply(this,arguments)}function h(){return m.apply(this,arguments)}function m(){return m=He(Ue.mark(function e(t){var o,a,s,l,i,c,p,d;return Ue.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.email,a=t.pwEnc,s=U(),l=null,D(o)){e.next=6;break}return s.reject("invalid email"),e.abrupt("return",s);case 6:if(D(a)){e.next=9;break}return s.reject("invalid password"),e.abrupt("return",s);case 9:return i={email:o},e.next=12,ne(i);case 12:if(l=e.sent,"error"!==l.state){e.next=17;break}return console.log("logIn catch:",l.msg,"find:",i),s.reject("email or password is incorrect"),e.abrupt("return",s);case 17:if(c=l.msg,""===c.checkCode){e.next=21;break}return s.reject("account is not verified"),e.abrupt("return",s);case 21:if(""!==F.salt&&(a=ge(a+F.salt)),c.pwEnc===a){e.next=25;break}return s.reject("email or password is incorrect"),e.abrupt("return",s);case 25:if(c.active===Ka.activeYes){e.next=28;break}return s.reject("account is suspended"),e.abrupt("return",s);case 28:return e.next=30,ce(c.token);case 30:if(l=e.sent,"success"!==l.state){e.next=34;break}return s.resolve(c.token),e.abrupt("return",s);case 34:return p=J(),d={id:c.id,token:p,tokenExp:Ce(n().add(F.timeTokenExp,"minute")),timeLogin:Q()},e.next=38,ee(d);case 38:if(l=e.sent,"error"!==l.state){e.next=43;break}return console.log("logIn catch:",l.msg,"userModify:",d),s.reject("can not save token"),e.abrupt("return",s);case 43:return s.resolve(p),e.abrupt("return",s);case 45:case"end":return e.stop();}},e)})),m.apply(this,arguments)}function f(){return b.apply(this,arguments)}function b(){return b=He(Ue.mark(function e(t){var n,o,a,s,l;return Ue.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=U(),o=null,D(t)){e.next=5;break}return n.reject("invalid token"),e.abrupt("return",n);case 5:return a={token:t},e.next=8,ne(a);case 8:if(o=e.sent,"error"!==o.state){e.next=13;break}return console.log("logOut catch:",o.msg,"find:",a),n.reject("invalid token"),e.abrupt("return",n);case 13:return s=o.msg,l={id:s.id,token:"",tokenExp:""},e.next=17,ee(l);case 17:if(o=e.sent,"error"!==o.state){e.next=22;break}return console.log("logOut catch:",o.msg,"userModify:",l),n.reject("can not update token"),e.abrupt("return",n);case 22:return n.resolve("success"),e.abrupt("return",n);case 24:case"end":return e.stop();}},e)})),b.apply(this,arguments)}function x(e){var t=U();if(!D(e))return t.reject(F.verifyWebMsgExpired),t;var r={checkCode:e};return d(r).then(function(e){var t={id:e.id,checkCode:""};return R.save(t)}).then(function(){t.resolve(F.verifyWebMsgSuccess)})["catch"](function(e){console.log("verifyCheckCode catch:",e,"find:",r),t.reject(F.verifyWebMsgExpired)}),t}function j(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"false",r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",n=F.verifyWebHtml;return n=$("<table style=\"width:100%;\">\n<tbody>\n\n<tr style=\"display:none;\">\n    <td>\n        {emMessage}\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:30px; font-family:'Microsoft JhengHei'; background-color:#666; text-align:center;\">\n        <a style=\"color:#aaffff; font-size:24pt; text-decoration:none;\" href=\"{emWebUrl}\" target=\"_blank\">{emWebName}</a>\n        <p style=\"margin:10px 0px 0px 0px; color:#eee; font-size:12pt;\">\n            {emWebDescription}\n        </p>\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:20px; font-family:'Microsoft JhengHei';\">\n        <p style=\"\">{emMessage}</p>\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:20px; font-family:'Microsoft JhengHei'; background-color:#f5f5f5; text-align:center;\">\n        <p style=\"color:#f26; font-size:11pt;\">\u3010{emLetterDoNotReplayMessage}\u3011</p>\n        <p style=\"\">{emLetterTeamMessage}</p>\n        <p style=\"padding:1em 0px 0px 0px; color:#aaa;\">{emLetterLinks}</p>\n    </td>\n</tr>\n\n</tbody>\n</table>",{"{rdWebName}":F.webName,"{rdWebDescription}":F.webDescription,"{rdWebUrl}":F.webUrl,"{rdLogo}":F.verifyWebLogo,"{rdMessage}":e,"{rdCountdown}":t,"{rdCountdownMessage}":r}),"<table style=\"width:100%;\">\n<tbody>\n\n<tr style=\"display:none;\">\n    <td>\n        {emMessage}\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:30px; font-family:'Microsoft JhengHei'; background-color:#666; text-align:center;\">\n        <a style=\"color:#aaffff; font-size:24pt; text-decoration:none;\" href=\"{emWebUrl}\" target=\"_blank\">{emWebName}</a>\n        <p style=\"margin:10px 0px 0px 0px; color:#eee; font-size:12pt;\">\n            {emWebDescription}\n        </p>\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:20px; font-family:'Microsoft JhengHei';\">\n        <p style=\"\">{emMessage}</p>\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:20px; font-family:'Microsoft JhengHei'; background-color:#f5f5f5; text-align:center;\">\n        <p style=\"color:#f26; font-size:11pt;\">\u3010{emLetterDoNotReplayMessage}\u3011</p>\n        <p style=\"\">{emLetterTeamMessage}</p>\n        <p style=\"padding:1em 0px 0px 0px; color:#aaa;\">{emLetterLinks}</p>\n    </td>\n</tr>\n\n</tbody>\n</table>"}function w(e){var r=U(),n=F.verifyWebMsgCount;return x(e).then(function(o){t("verifyCheckCodeAndGetHtml",{state:"success",msg:o,checkCode:e}),r.resolve(j(o,"true",n))})["catch"](function(n){t("verifyCheckCodeAndGetHtml",{state:"error",msg:n,checkCode:e}),r.resolve(j(n,"false",""))}),r}function k(e){var t=U();if(!de(e))t.reject("no expire time for token");else{var r=n(),o=Le(e),a=o.diff(r,"minute");0<a?t.resolve("success"):a>F.timeTokenExp?(console.log("verifyTokenExp error:","iMinutes="+a,">","timeTokenExp="+F.timeTokenExp),t.reject("invalid tokenExp")):t.reject("token expired")}return t}function v(){return _.apply(this,arguments)}function _(){return _=He(Ue.mark(function e(t){var n,o,a,s;return Ue.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=U(),o=null,D(t)){e.next=5;break}return n.reject("invalid token"),e.abrupt("return",n);case 5:return a={token:t},e.next=8,ne(a);case 8:if(o=e.sent,"error"!==o.state){e.next=13;break}return console.log("isValidToken catch:",o.msg,"find:",a),n.reject("invalid token"),e.abrupt("return",n);case 13:if(s=o.msg,o=ie(s.tokenExp),"error"!==o.state){e.next=18;break}return n.reject(o.msg),e.abrupt("return",n);case 18:return n.resolve("success"),e.abrupt("return",n);case 20:case"end":return e.stop();}},e)})),_.apply(this,arguments)}function S(){return M.apply(this,arguments)}function M(){return M=He(Ue.mark(function e(t){var o,a,s,l,i;return Ue.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=U(),a=null,D(t)){e.next=5;break}return o.reject("invalid token"),e.abrupt("return",o);case 5:return s={token:t},e.next=8,ne(s);case 8:if(a=e.sent,"error"!==a.state){e.next=13;break}return console.log("refreshTokenExp catch:",a.msg,"find:",s),o.reject("invalid token"),e.abrupt("return",o);case 13:if(l=a.msg,a=k(l.tokenExp),"error"!==a.state){e.next=18;break}return o.reject(a.err),e.abrupt("return",o);case 18:return i={id:l.id,tokenExp:Ce(n().add(F.timeTokenExp,"minute"))},e.next=21,ee(i);case 21:if(a=e.sent,"error"!==a.state){e.next=26;break}return console.log("refreshTokenExp catch:",a.msg,"userModify:",i),o.reject("can not update token"),e.abrupt("return",o);case 26:return o.resolve("success"),e.abrupt("return",o);case 28:case"end":return e.stop();}},e)})),M.apply(this,arguments)}function C(){return L.apply(this,arguments)}function L(){return L=He(Ue.mark(function e(t){var n,o,a,s;return Ue.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=U(),o=null,a={token:t},e.next=5,ne(a);case 5:if(o=e.sent,"error"!==o.state){e.next=10;break}return console.log("getUserFromToken catch:",o.msg,"find:",a),n.reject("invalid token"),e.abrupt("return",n);case 10:return s=o.msg,n.resolve(s),e.abrupt("return",n);case 13:case"end":return e.stop();}},e)})),L.apply(this,arguments)}function E(){return P.apply(this,arguments)}function P(){return P=He(Ue.mark(function e(t){var n,o,a,s,l,i,c,p;return Ue.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.email,o=t.pwEnc,a=t.pwEncNew,s=U(),l=null,D(n)){e.next=6;break}return s.reject("invalid email"),e.abrupt("return",s);case 6:if(D(o)){e.next=9;break}return s.reject("invalid old password"),e.abrupt("return",s);case 9:if(D(a)){e.next=12;break}return s.reject("invalid new password"),e.abrupt("return",s);case 12:return i={email:n},e.next=15,ne(i);case 15:if(l=e.sent,"error"!==l.state){e.next=20;break}return console.log("changePW catch:",l.msg,"find:",i),s.reject("email or password is incorrect"),e.abrupt("return",s);case 20:if(c=l.msg,""===c.checkCode){e.next=24;break}return s.reject("account is not verified"),e.abrupt("return",s);case 24:if(c.active===Ka.activeYes){e.next=27;break}return s.reject("account is suspended"),e.abrupt("return",s);case 27:if(""!==F.salt&&(o=ge(o+F.salt),a=ge(a+F.salt)),c.pwEnc===o){e.next=31;break}return s.reject("email or password is incorrect"),e.abrupt("return",s);case 31:return p={id:c.id,pwEnc:a},e.next=34,ee(p);case 34:if(l=e.sent,"error"!==l.state){e.next=39;break}return console.log("changePW catch:",l.msg,"userModify:",p),s.reject("can not update password"),e.abrupt("return",s);case 39:return s.resolve("success"),e.abrupt("return",s);case 41:case"end":return e.stop();}},e)})),P.apply(this,arguments)}function A(){return O.apply(this,arguments)}function O(){return O=He(Ue.mark(function e(t){var n,o,a,s,l,i,c,p,d;return Ue.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.email,o=t.pwEncNew,a=U(),s=null,D(n)){e.next=6;break}return a.reject("invalid email"),e.abrupt("return",a);case 6:if(D(o)){e.next=9;break}return a.reject("invalid new password"),e.abrupt("return",a);case 9:return l={email:n},e.next=12,ne(l);case 12:if(s=e.sent,"error"!==s.state){e.next=17;break}return console.log("resetPW catch:",s.msg,"find:",l),a.reject("email is incorrect"),e.abrupt("return",a);case 17:if(i=s.msg,i.active===Ka.activeYes){e.next=21;break}return a.reject("account is suspended"),e.abrupt("return",a);case 21:return""!==F.salt&&(o=ge(o+F.salt)),c=J(),p={id:i.id,pwEnc:o,checkCode:c},e.next=26,ee(p);case 26:if(s=e.sent,"error"!==s.state){e.next=31;break}return console.log("resetPW catch:",s.msg,"userModify:",p),a.reject("can not update password"),e.abrupt("return",a);case 31:return d="".concat(F.authUrl,"?checkCode=").concat(c),e.next=34,xe(i.name,d,i.email);case 34:if(s=e.sent,"error"!==s.state){e.next=39;break}return console.log("resetPW catch:",s.msg,"emailObj:",{name:i.name,urlCheckCode:d,email:i.email}),a.reject("can not send email"),e.abrupt("return",a);case 39:return a.resolve("success"),e.abrupt("return",a);case 41:case"end":return e.stop();}},e)})),O.apply(this,arguments)}function W(){return T.apply(this,arguments)}function T(){return T=He(Ue.mark(function e(t){var n,o,s,l,i,c,p;return Ue.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.token,o=t.user,s=U(),l=null,e.next=5,ce(n);case 5:if(l=e.sent,"error"!==l.state){e.next=9;break}return s.reject(l.msg),e.abrupt("return",s);case 9:if(l=a(o),"error"!==l.state){e.next=13;break}return s.reject(l.msg),e.abrupt("return",s);case 13:return e.next=15,C(n);case 15:if(i=e.sent,c={id:i.id},p=!1,qn(q,function(e,t){e.canModify&&o[t]&&i[t]!==o[t]&&(p=!0,c[t]=o[t])}),p){e.next=22;break}return s.resolve("no change"),e.abrupt("return",s);case 22:return e.next=24,ee(c);case 24:if(l=e.sent,"error"!==l.state){e.next=29;break}return console.log("modifyInfor catch:",l.msg,"userModify:",c),s.reject("can not modify"),e.abrupt("return",s);case 29:return s.resolve("success"),e.abrupt("return",s);case 31:case"end":return e.stop();}},e)})),T.apply(this,arguments)}function N(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:[],a={srcName:F.emSenderName,srcEmail:F.emSenderEmail,srcPW:F.emSenderPW,emTitle:e,emContent:t,toEmails:r,toEmailsCC:n,toEmailsBCC:o};return new _e(a)}function z(e,t,r,n,o){var a=F.emLetterHtml,s=F.webName,l=F.webUrl,i=F.emLetterLinks;return""!==s&&""!==l&&(i=Ro({name:s,url:l},i)),i=Bo(i,function(e){var t=Ao(e,"name",""),r=Ao(e,"url","");return"<a style=\"text-decoration:none\" href=\"".concat(r,"\" target=\"_blank\" >").concat(t,"</a>")}),i="| ".concat(Vo(i," | ")," |"),a=$(a,{"{emMessage}":t,"{emWebName}":s,"{emWebUrl}":l,"{emWebDescription}":F.webDescription,"{emLetterDoNotReplayMessage}":F.emLetterDoNotReplayMessage,"{emLetterTeamMessage}":F.emLetterTeamMessage,"{emLetterLinks}":i}),N(e,a,r,n,o)}function B(e,t,r){var n=F.emSignUpTitle,o=F.emSignUpHtml;return o=$("<table style=\"width:100%;\">\n<tbody>\n\n<tr style=\"display:none;\">\n    <td>\n        {emMessage}\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:30px; font-family:'Microsoft JhengHei'; background-color:#666; text-align:center;\">\n        <a style=\"color:#aaffff; font-size:24pt; text-decoration:none;\" href=\"{emWebUrl}\" target=\"_blank\">{emWebName}</a>\n        <p style=\"margin:10px 0px 0px 0px; color:#eee; font-size:12pt;\">\n            {emWebDescription}\n        </p>\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:20px; font-family:'Microsoft JhengHei';\">\n        <p style=\"\">{emMessage}</p>\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:20px; font-family:'Microsoft JhengHei'; background-color:#f5f5f5; text-align:center;\">\n        <p style=\"color:#f26; font-size:11pt;\">\u3010{emLetterDoNotReplayMessage}\u3011</p>\n        <p style=\"\">{emLetterTeamMessage}</p>\n        <p style=\"padding:1em 0px 0px 0px; color:#aaa;\">{emLetterLinks}</p>\n    </td>\n</tr>\n\n</tbody>\n</table>",{"{name}":e,"{urlCheckCode}":t}),z(n,"<table style=\"width:100%;\">\n<tbody>\n\n<tr style=\"display:none;\">\n    <td>\n        {emMessage}\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:30px; font-family:'Microsoft JhengHei'; background-color:#666; text-align:center;\">\n        <a style=\"color:#aaffff; font-size:24pt; text-decoration:none;\" href=\"{emWebUrl}\" target=\"_blank\">{emWebName}</a>\n        <p style=\"margin:10px 0px 0px 0px; color:#eee; font-size:12pt;\">\n            {emWebDescription}\n        </p>\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:20px; font-family:'Microsoft JhengHei';\">\n        <p style=\"\">{emMessage}</p>\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:20px; font-family:'Microsoft JhengHei'; background-color:#f5f5f5; text-align:center;\">\n        <p style=\"color:#f26; font-size:11pt;\">\u3010{emLetterDoNotReplayMessage}\u3011</p>\n        <p style=\"\">{emLetterTeamMessage}</p>\n        <p style=\"padding:1em 0px 0px 0px; color:#aaa;\">{emLetterLinks}</p>\n    </td>\n</tr>\n\n</tbody>\n</table>",r,[],F.emBCC)}function I(e,t,r){var n=F.emResetPWTitle,o=F.emResetPWHtml;return o=$("<table style=\"width:100%;\">\n<tbody>\n\n<tr style=\"display:none;\">\n    <td>\n        {emMessage}\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:30px; font-family:'Microsoft JhengHei'; background-color:#666; text-align:center;\">\n        <a style=\"color:#aaffff; font-size:24pt; text-decoration:none;\" href=\"{emWebUrl}\" target=\"_blank\">{emWebName}</a>\n        <p style=\"margin:10px 0px 0px 0px; color:#eee; font-size:12pt;\">\n            {emWebDescription}\n        </p>\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:20px; font-family:'Microsoft JhengHei';\">\n        <p style=\"\">{emMessage}</p>\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:20px; font-family:'Microsoft JhengHei'; background-color:#f5f5f5; text-align:center;\">\n        <p style=\"color:#f26; font-size:11pt;\">\u3010{emLetterDoNotReplayMessage}\u3011</p>\n        <p style=\"\">{emLetterTeamMessage}</p>\n        <p style=\"padding:1em 0px 0px 0px; color:#aaa;\">{emLetterLinks}</p>\n    </td>\n</tr>\n\n</tbody>\n</table>",{"{name}":e,"{urlCheckCode}":t}),z(n,"<table style=\"width:100%;\">\n<tbody>\n\n<tr style=\"display:none;\">\n    <td>\n        {emMessage}\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:30px; font-family:'Microsoft JhengHei'; background-color:#666; text-align:center;\">\n        <a style=\"color:#aaffff; font-size:24pt; text-decoration:none;\" href=\"{emWebUrl}\" target=\"_blank\">{emWebName}</a>\n        <p style=\"margin:10px 0px 0px 0px; color:#eee; font-size:12pt;\">\n            {emWebDescription}\n        </p>\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:20px; font-family:'Microsoft JhengHei';\">\n        <p style=\"\">{emMessage}</p>\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:20px; font-family:'Microsoft JhengHei'; background-color:#f5f5f5; text-align:center;\">\n        <p style=\"color:#f26; font-size:11pt;\">\u3010{emLetterDoNotReplayMessage}\u3011</p>\n        <p style=\"\">{emLetterTeamMessage}</p>\n        <p style=\"padding:1em 0px 0px 0px; color:#aaa;\">{emLetterLinks}</p>\n    </td>\n</tr>\n\n</tbody>\n</table>",r,[],F.emBCC)}var F=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},G=new e.EventEmitter;if(F=Gn(F),D(F.mongoUrl)||(F.mongoUrl="mongodb://127.0.0.1:27017"),D(F.mongoDb)||(F.mongoDb="wuser"),D(F.mongoCl)||(F.mongoCl="users"),Y(F.port)||(F.port=8080),D(F.apiName)||(F.apiName="api"),D(F.authUrl)||(F.authUrl="http://localhost:8080/auth"),D(F.salt)||(F.salt=""),Y(F.timeTokenExp)||(F.timeTokenExp=30),D(F.webName)||(F.webName=""),D(F.webUrl)||(F.webUrl=""),D(F.webDescription)||(F.webDescription=""),D(F.emSenderName)||(F.emSenderName="WUserServer"),!D(F.emSenderEmail))return console.log("invalid emSenderEmail"),G;D(F.emSenderPW)||(F.emSenderPW=""),D(F.emBCC)||(F.emBCC=""),D(F.emLetterHtml)||(F.emLetterHtml="<table style=\"width:100%;\">\n<tbody>\n\n<tr style=\"display:none;\">\n    <td>\n        {emMessage}\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:30px; font-family:'Microsoft JhengHei'; background-color:#666; text-align:center;\">\n        <a style=\"color:#aaffff; font-size:24pt; text-decoration:none;\" href=\"{emWebUrl}\" target=\"_blank\">{emWebName}</a>\n        <p style=\"margin:10px 0px 0px 0px; color:#eee; font-size:12pt;\">\n            {emWebDescription}\n        </p>\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:20px; font-family:'Microsoft JhengHei';\">\n        <p style=\"\">{emMessage}</p>\n    </td>\n</tr>\n\n<tr>\n    <td style=\"padding:20px; font-family:'Microsoft JhengHei'; background-color:#f5f5f5; text-align:center;\">\n        <p style=\"color:#f26; font-size:11pt;\">\u3010{emLetterDoNotReplayMessage}\u3011</p>\n        <p style=\"\">{emLetterTeamMessage}</p>\n        <p style=\"padding:1em 0px 0px 0px; color:#aaa;\">{emLetterLinks}</p>\n    </td>\n</tr>\n\n</tbody>\n</table>"),D(F.emLetterTeamMessage)||(F.emLetterTeamMessage="Global-User International Company"),D(F.emLetterDoNotReplayMessage)||(F.emLetterDoNotReplayMessage="This letter is automatically sent by the system, please do not reply to this email."),K(F.emLetterLinks)||(F.emLetterLinks=[]),D(F.emSignUpTitle)||(F.emSignUpTitle="Verification letter"),D(F.emSignUpHtml)||(F.emSignUpHtml="<p>Dear {name} :</p>\n\n<p>Your registration request has been received. Please click the link below to verify your account.</p>\n\n<p><a href=\"{urlCheckCode}\" target=\"_blank\">Confirm Account</a></p>"),D(F.emResetPWTitle)||(F.emResetPWTitle="Password reset letter"),D(F.emResetPWHtml)||(F.emResetPWHtml="<p>Dear {name} :</p>\n\n<p>You have received your change password request. Please click the link below to verify your account.</p>\n\n<p><a href=\"{urlCheckCode}\" target=\"_blank\">Confirm Account</a></p>"),D(F.verifyWebHtml)||(F.verifyWebHtml="<!DOCTYPE html>\n<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"zh-tw\">\n\n    <head>\n        <meta http-equiv=\"content-type\" content=\"text/html charset=UTF-8\" />\n        <title>{rdWebName}</title>\n\n        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.slim.js\"></script>\n\n    </head>\n\n    <body style=\"padding:0; margin:0;\">\n    \n        <div style=\"display:flex; align-items:center; justify-content:center;\">\n            \n            <div style=\"padding:30px; font-family:'Microsoft JhengHei';\">\n            \n                <div style=\"margin:10px 0px 20px 0px; display:flex; align-items:center;\">\n\n                    <div style=\"margin-right:10px;\">\n                        {rdLogo}\n                    </div>\n\n                    <div style=\"margin:-5px 0px 0px 0px;\">\n                        <div style=\"margin:0px 0px 0px 0px; font-size:12pt; color:#999;\">Single Sign-On</div>\n                        <div style=\"margin:-3px 0px 0px 0px; font-size:24pt;\">{rdWebName}</div>\n                    </div>\n\n                </div>\n    \n                <div style=\"padding:20px; text-align:center; background-color:#fee; border-radius:10px;\">\n\n                    <div style=\"\">{rdMessage}</div>\n    \n                    <div id=\"cd\" style=\"margin:10px 0px 0px 0px; font-size:10pt; color:#999; display:none;\"></div>\n\n                </div>\n                \n            </div>\n            \n        </div>\n        \n        <script>\n\n            function countdown() {\n                $('#cd').show()\n                let n = 5\n                let tmp = '{rdCountdownMessage}'\n                $('#cd').text(tmp.replace('{s}', n))\n                setInterval(function() {\n                    n -= 1\n                    if (n<=0) {\n                        window.location.href = '{rdWebUrl}'\n                    }\n                    $('#cd').text(tmp.replace('{s}', n))\n                }, 1000)\n            }\n            if ({rdCountdown}) {\n                countdown()\n            }\n\n        </script>\n\n    </body>\n\n</html>"),D(F.verifyWebLogo)||(F.verifyWebLogo="<svg width=\"64\" height=\"64\" viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"><defs><style>.cls-1{fill:#c8da52;}.cls-2{fill:#995f5b;}</style></defs><title/><path class=\"cls-1\" d=\"M23.85,38.78c9.63-2,15,2.07,16.22,8.17S38,58.88,28.4,60.86,5.33,54.71,5.21,54.13,14.23,40.76,23.85,38.78Z\"/><path class=\"cls-1\" d=\"M45.72,18.87C51.31,27,49.66,33.45,44.54,37s-11.78,2.78-17.36-5.3S23.83,8,24.31,7.7,40.14,10.78,45.72,18.87Z\"/><path class=\"cls-1\" d=\"M72.6,31.21c-5.26,8.3-11.88,9.33-17.14,6s-7.16-9.75-1.9-18.05,20.45-12.32,21-12S77.86,22.91,72.6,31.21Z\"/><path class=\"cls-1\" d=\"M71.73,60.78c-9.69-1.6-13.22-7.3-12.21-13.44s6.19-10.4,15.88-8.8,19.33,14,19.24,14.59S81.43,62.38,71.73,60.78Z\"/><path class=\"cls-2\" d=\"M57.46,43.08a1,1,0,0,0-1.41-1.41l-6.22,6.21-6.21-6.21a1,1,0,0,0-1.41,1.41l6.62,6.63v5.08l-5.21-5.21A1,1,0,1,0,42.21,51l6.62,6.63V93.78a1,1,0,0,0,2,0V57.62L57.46,51a1,1,0,0,0-1.41-1.41l-5.22,5.21V49.71Z\"/><path class=\"cls-2\" d=\"M75.86,78.39a1,1,0,0,0-1,1V93.78a1,1,0,0,0,2,0V79.39A1,1,0,0,0,75.86,78.39Z\"/><path class=\"cls-1\" d=\"M65.37,77.4c3.88-.8,6,.83,6.53,3.28s-.83,4.8-4.7,5.6-9.28-2.48-9.32-2.71S61.5,78.2,65.37,77.4Z\"/><path class=\"cls-1\" d=\"M74.17,69.39c2.25,3.25,1.58,5.86-.48,7.29s-4.73,1.11-7-2.14S65.36,65,65.56,64.9,71.92,66.14,74.17,69.39Z\"/><path class=\"cls-1\" d=\"M85,74.35c-2.11,3.34-4.78,3.75-6.89,2.41s-2.88-3.92-.77-7.26,8.23-5,8.43-4.83S87.1,71,85,74.35Z\"/><path class=\"cls-1\" d=\"M84.63,86.25c-3.9-.65-5.32-2.94-4.91-5.41s2.49-4.18,6.39-3.54,7.78,5.64,7.74,5.87S88.53,86.89,84.63,86.25Z\"/></svg>"),D(F.verifyWebMsgSuccess)||(F.verifyWebMsgSuccess="Verify successfully"),D(F.verifyWebMsgExpired)||(F.verifyWebMsgExpired="Code has expired"),D(F.verifyWebMsgCount)||(F.verifyWebMsgCount="Go to the website automatically after {s} seconds..."),V(F.funcs)||(F.funcs={}),K(F.routes)||(F.routes=[]);var R=ve({url:F.mongoUrl,db:F.mongoDb,cl:F.mongoCl}),q={id:{type:"String",public:!0,necessary:!0,exclude:[],canModify:!1},name:{type:"String",public:!0,necessary:!1,exclude:es,canModify:!0},pwEnc:{type:"String",public:!1,necessary:!0,exclude:[],canModify:!1},email:{type:"String",public:!0,necessary:!0,exclude:es,canModify:!0},address:{type:"String",public:!0,necessary:!1,exclude:es,canModify:!0},phone:{type:"String",public:!0,necessary:!1,exclude:es,canModify:!0},organization:{type:"String",public:!0,necessary:!1,exclude:es,canModify:!0},position:{type:"String",public:!0,necessary:!1,exclude:es,canModify:!0},role:{type:"String",public:!0,necessary:!0,exclude:es,canModify:!1},checkCode:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},token:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},tokenExp:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},timeCreate:{type:"String",public:!1,necessary:!0,exclude:[],canModify:!1},timeLogin:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},data:{type:"Object",public:!1,necessary:!1,exclude:[],canModify:!1},active:{type:"String",public:!1,necessary:!0,exclude:[],canModify:!1}},ee=he(R.save),te=he(l),re=he(c),ne=he(d),oe=he(y),ae=he(h),se=he(f),ie=he(k),ce=he(v),pe=he(S),ye=he(E),me=he(A),fe=he(W),be=he(B),xe=he(I),je={select:function(e){return r(te,"selectPublic")(e)},signUp:function(e){return r(oe,"signUp")(e)},logIn:function(e){return r(ae,"logIn")(e)},refreshTokenExp:function(e){return r(pe,"refreshTokenExp")(e)},isValidToken:function(e){return r(ce,"isValidToken")(e)},logOut:function(e){return r(se,"logOut")(e)},changePW:function(e){return r(ye,"changePW")(e)},resetPW:function(e){return r(me,"resetPW")(e)},modifyInfor:function(e){return r(fe,"modifyInfor")(e)}};qn(F.funcs,function(e,t){X(je,t)?console.log("invalid func: "+t):je[t]=F.funcs[t]});var ke=[{method:"GET",path:"/auth",handler:function(){var e=He(Ue.mark(function e(t){var r;return Ue.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.query.checkCode,e.abrupt("return",w(r));case 2:case"end":return e.stop();}},e)}));return function(){return e.apply(this,arguments)}}()}];return qn(F.routes,function(e){ke.push(e)}),F=Me({},F,{onClientChange:function(e){t("clientChange",e.length,e)},funcs:je,routes:ke}),new we(F),G}e=e&&e.hasOwnProperty("default")?e["default"]:e,n=n&&n.hasOwnProperty("default")?n["default"]:n,o=o&&o.hasOwnProperty("default")?o["default"]:o,a=a&&a.hasOwnProperty("default")?a["default"]:a,s=s&&s.hasOwnProperty("default")?s["default"]:s,l=l&&l.hasOwnProperty("default")?l["default"]:l;var Te=i,Ne="undefined"==typeof globalThis?"undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window:globalThis,ze=u(function(e){var t=function(e){function t(e,t,r,o){var a=t&&t.prototype instanceof n?t:n,s=Object.create(a.prototype),l=new y(o||[]);return s._invoke=i(e,r,l),s}function r(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function n(){}function o(){}function a(){}function s(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function l(e){function t(n,o,a,s){var l=r(e[n],e,o);if("throw"===l.type)s(l.arg);else{var i=l.arg,p=i.value;return p&&"object"===c(p)&&f.call(p,"__await")?Promise.resolve(p.__await).then(function(e){t("next",e,a,s)},function(e){t("throw",e,a,s)}):Promise.resolve(p).then(function(e){i.value=e,a(i)},function(e){return t("throw",e,a,s)})}}function n(e,r){function n(){return new Promise(function(n,o){t(e,r,n,o)})}return o=o?o.then(n,n):n()}var o;this._invoke=n}function i(e,t,n){var o="suspendedStart";return function(a,s){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===a)throw s;return h()}for(n.method=a,n.arg=s;;){var l=n.delegate;if(l){var i=p(l,n);if(i){if(i===v)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===o)throw o="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o="executing";var c=r(e,t,n);if("normal"===c.type){if(o=n.done?"completed":"suspendedYield",c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o="completed",n.method="throw",n.arg=c.arg)}}}function p(e,t){var n=e.iterator[t.method];if(n===k){if(t.delegate=null,"throw"===t.method){if(e.iterator["return"]&&(t.method="return",t.arg=k,p(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=r(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,v;var a=o.arg;if(!a)return t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v;if(a.done)t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=k);else return a;return t.delegate=null,v}function d(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function u(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function y(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(d,this),this.reset(!0)}function g(e){if(e){var t=e[x];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(f.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=k,t.done=!0,t};return n.next=n}}return{next:h}}function h(){return{value:k,done:!0}}var m=Object.prototype,f=m.hasOwnProperty,b="function"==typeof Symbol?Symbol:{},x=b.iterator||"@@iterator",j=b.asyncIterator||"@@asyncIterator",w=b.toStringTag||"@@toStringTag",k;e.wrap=t;var v={},_={};_[x]=function(){return this};var S=Object.getPrototypeOf,M=S&&S(S(g([])));M&&M!==m&&f.call(M,x)&&(_=M);var C=a.prototype=n.prototype=Object.create(_);return o.prototype=C.constructor=a,a.constructor=o,a[w]=o.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,!(w in e)&&(e[w]="GeneratorFunction")),e.prototype=Object.create(C),e},e.awrap=function(e){return{__await:e}},s(l.prototype),l.prototype[j]=function(){return this},e.AsyncIterator=l,e.async=function(r,n,o,a){var s=new l(t(r,n,o,a));return e.isGeneratorFunction(n)?s:s.next().then(function(e){return e.done?e.value:s.next()})},s(C),C[w]="Generator",C[x]=function(){return this},C.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=g,y.prototype={constructor:y,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=k,this.done=!1,this.delegate=null,this.method="next",this.arg=k,this.tryEntries.forEach(u),!e)for(var t in this)"t"===t.charAt(0)&&f.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=k)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,n){return a.type="throw",a.arg=e,r.next=t,n&&(r.method="next",r.arg=k),!!n}if(this.done)throw e;for(var r=this,n=this.tryEntries.length-1;0<=n;--n){var o=this.tryEntries[n],a=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var s=f.call(o,"catchLoc"),l=f.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);}else if(!l)throw new Error("try statement without catch or finally");else if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1,n;0<=r;--r)if(n=this.tryEntries[r],n.tryLoc<=this.prev&&f.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1,r;0<=t;--t)if(r=this.tryEntries[t],r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),u(r),v},catch:function(e){for(var t=this.tryEntries.length-1,r;0<=t;--t)if(r=this.tryEntries[t],r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;u(r)}return o}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:g(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=k),v}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}),Ue=ze,He=function(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){function a(e){y(l,n,o,a,s,"next",e)}function s(e){y(l,n,o,a,s,"throw",e)}var l=e.apply(t,r);a(void 0)})}},De=function(e,t){return e===t||e!==e&&t!==t},Be=function(e,t){for(var r=e.length;r--;)if(De(e[r][0],t))return r;return-1},Ie=Array.prototype,Fe=Ie.splice;g.prototype.clear=function(){this.__data__=[],this.size=0},g.prototype["delete"]=function(e){var t=this.__data__,r=Be(t,e);if(0>r)return!1;var n=t.length-1;return r==n?t.pop():Fe.call(t,r,1),--this.size,!0},g.prototype.get=function(e){var t=this.__data__,r=Be(t,e);return 0>r?void 0:t[r][1]},g.prototype.has=function(e){return-1<Be(this.__data__,e)},g.prototype.set=function(e,t){var r=this.__data__,n=Be(r,e);return 0>n?(++this.size,r.push([e,t])):r[n][1]=t,this};var Ge=g,Re="object"==c(Ne)&&Ne&&Ne.Object===Object&&Ne,Ye=Re,Je="object"==("undefined"==typeof self?"undefined":c(self))&&self&&self.Object===Object&&self,Ve=Ye||Je||Function("return this")(),Ze=Ve,qe=Ze.Symbol,$e=qe,Xe=Object.prototype,Qe=Xe.hasOwnProperty,Ke=Xe.toString,et=$e?$e.toStringTag:void 0,tt=function(e){var t=Qe.call(e,et),r=e[et];try{e[et]=void 0;var n=!0}catch(t){}var o=Ke.call(e);return n&&(t?e[et]=r:delete e[et]),o},rt=Object.prototype,nt=rt.toString,ot=function(e){return nt.call(e)},at=$e?$e.toStringTag:void 0,st=h,lt=m,it=function(e){if(!lt(e))return!1;var t=st(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},ct=Ze["__core-js_shared__"],pt=ct,dt=function(){var e=/[^.]+$/.exec(pt&&pt.keys&&pt.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),ut=Function.prototype,yt=ut.toString,gt=function(e){if(null!=e){try{return yt.call(e)}catch(t){}try{return e+""}catch(t){}}return""},ht=/[\\^$.*+?()[\]{}|]/g,mt=/^\[object .+?Constructor\]$/,ft=Function.prototype,bt=Object.prototype,xt=ft.toString,jt=bt.hasOwnProperty,wt=RegExp("^"+xt.call(jt).replace(ht,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),kt=function(e){if(!lt(e)||f(e))return!1;var t=it(e)?wt:mt;return t.test(gt(e))},vt=function(e,t){return null==e?void 0:e[t]},_t=function(e,t){var r=vt(e,t);return kt(r)?r:void 0},St=_t(Ze,"Map"),Mt=St,Ct=_t(Object,"create"),Lt=Ct,Et=Object.prototype,Pt=Et.hasOwnProperty,At=Object.prototype,Ot=At.hasOwnProperty;b.prototype.clear=function(){this.__data__=Lt?Lt(null):{},this.size=0},b.prototype["delete"]=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},b.prototype.get=function(e){var t=this.__data__;if(Lt){var r=t[e];return r==="__lodash_hash_undefined__"?void 0:r}return Pt.call(t,e)?t[e]:void 0},b.prototype.has=function(e){var t=this.__data__;return Lt?t[e]!==void 0:Ot.call(t,e)},b.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Lt&&void 0===t?"__lodash_hash_undefined__":t,this};var Wt=b,Tt=function(e,t){var r=e.__data__;return x(t)?r["string"==typeof t?"string":"hash"]:r.map};j.prototype.clear=function(){this.size=0,this.__data__={hash:new Wt,map:new(Mt||Ge),string:new Wt}},j.prototype["delete"]=function(e){var t=Tt(this,e)["delete"](e);return this.size-=t?1:0,t},j.prototype.get=function(e){return Tt(this,e).get(e)},j.prototype.has=function(e){return Tt(this,e).has(e)},j.prototype.set=function(e,t){var r=Tt(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};var Nt=j;w.prototype.clear=function(){this.__data__=new Ge,this.size=0},w.prototype["delete"]=function(e){var t=this.__data__,r=t["delete"](e);return this.size=t.size,r},w.prototype.get=function(e){return this.__data__.get(e)},w.prototype.has=function(e){return this.__data__.has(e)},w.prototype.set=function(e,t){var r=this.__data__;if(r instanceof Ge){var n=r.__data__;if(!Mt||199>n.length)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Nt(n)}return r.set(e,t),this.size=r.size,this};var zt=w,Ut=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!(!1===t(e[r],r,e)););return e},Ht=function(){try{var e=_t(Object,"defineProperty");return e({},"",{}),e}catch(t){}}(),Dt=Ht,Bt=function(e,t,r){"__proto__"==t&&Dt?Dt(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r},It=Object.prototype,Ft=It.hasOwnProperty,Gt=k,Rt=function(e,t,r,n){var o=!r;r||(r={});for(var a=-1,s=t.length;++a<s;){var l=t[a],i=n?n(r[l],e[l],l,r,e):void 0;i===void 0&&(i=e[l]),o?Bt(r,l,i):Gt(r,l,i)}return r},Yt=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n},Jt=v,Vt=function(e){return Jt(e)&&st(e)=="[object Arguments]"},Zt=Object.prototype,qt=Zt.hasOwnProperty,$t=Zt.propertyIsEnumerable,Xt=Vt(function(){return arguments}())?Vt:function(e){return Jt(e)&&qt.call(e,"callee")&&!$t.call(e,"callee")},Qt=Xt,Kt=Array.isArray,er=Kt,tr=function(){return!1},rr=u(function(e,t){var r=t&&!t.nodeType&&t,n=r&&!0&&e&&!e.nodeType&&e,o=n&&n.exports===r,a=o?Ze.Buffer:void 0,s=a?a.isBuffer:void 0;e.exports=s||tr}),nr=/^(?:0|[1-9]\d*)$/,or=_,ar=function(e){return"number"==typeof e&&-1<e&&0==e%1&&e<=9007199254740991},sr={};sr["[object Float32Array]"]=sr["[object Float64Array]"]=sr["[object Int8Array]"]=sr["[object Int16Array]"]=sr["[object Int32Array]"]=sr["[object Uint8Array]"]=sr["[object Uint8ClampedArray]"]=sr["[object Uint16Array]"]=sr["[object Uint32Array]"]=!0,sr["[object Arguments]"]=sr["[object Array]"]=sr["[object ArrayBuffer]"]=sr["[object Boolean]"]=sr["[object DataView]"]=sr["[object Date]"]=sr["[object Error]"]=sr["[object Function]"]=sr["[object Map]"]=sr["[object Number]"]=sr["[object Object]"]=sr["[object RegExp]"]=sr["[object Set]"]=sr["[object String]"]=sr["[object WeakMap]"]=!1;var lr=function(e){return function(t){return e(t)}},ir=u(function(e,t){var r=t&&!t.nodeType&&t,n=r&&!0&&e&&!e.nodeType&&e,o=n&&n.exports===r,a=o&&Ye.process,s=function(){try{var e=n&&n.require&&n.require("util").types;return e?e:a&&a.binding&&a.binding("util")}catch(t){}}();e.exports=s}),cr=ir&&ir.isTypedArray,pr=cr?lr(cr):function(e){return Jt(e)&&ar(e.length)&&!!sr[st(e)]},dr=pr,ur=Object.prototype,yr=ur.hasOwnProperty,gr=function(e,t){var r=er(e),n=!r&&Qt(e),o=!r&&!n&&rr(e),a=!r&&!n&&!o&&dr(e),s=r||n||o||a,l=s?Yt(e.length,String):[],i=l.length;for(var c in e)(t||yr.call(e,c))&&!(s&&("length"==c||o&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||or(c,i)))&&l.push(c);return l},hr=Object.prototype,mr=function(e){var t=e&&e.constructor,r="function"==typeof t&&t.prototype||hr;return e===r},fr=function(e,t){return function(r){return e(t(r))}},br=fr(Object.keys,Object),xr=Object.prototype,jr=xr.hasOwnProperty,wr=function(e){if(!mr(e))return br(e);var t=[];for(var r in Object(e))jr.call(e,r)&&"constructor"!=r&&t.push(r);return t},kr=function(e){return null!=e&&ar(e.length)&&!it(e)},vr=function(e){return kr(e)?gr(e):wr(e)},_r=function(e,t){return e&&Rt(t,vr(t),e)},Sr=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t},Mr=Object.prototype,Cr=Mr.hasOwnProperty,Lr=function(e){if(!lt(e))return Sr(e);var t=mr(e),r=[];for(var n in e)("constructor"!=n||!t&&Cr.call(e,n))&&r.push(n);return r},Er=function(e){return kr(e)?gr(e,!0):Lr(e)},Pr=function(e,t){return e&&Rt(t,Er(t),e)},Ar=u(function(e,t){var r=t&&!t.nodeType&&t,n=r&&!0&&e&&!e.nodeType&&e,o=n&&n.exports===r,a=o?Ze.Buffer:void 0,s=a?a.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=s?s(r):new e.constructor(r);return e.copy(n),n}}),Or=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t},Wr=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,a=[];++r<n;){var s=e[r];t(s,r,e)&&(a[o++]=s)}return a},Tr=function(){return[]},Nr=Object.prototype,zr=Nr.propertyIsEnumerable,Ur=Object.getOwnPropertySymbols,Hr=Ur?function(e){return null==e?[]:(e=Object(e),Wr(Ur(e),function(t){return zr.call(e,t)}))}:Tr,Dr=Hr,Br=function(e,t){return Rt(e,Dr(e),t)},Ir=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e},Fr=fr(Object.getPrototypeOf,Object),Gr=Fr,Rr=Object.getOwnPropertySymbols,Yr=Rr?function(e){for(var t=[];e;)Ir(t,Dr(e)),e=Gr(e);return t}:Tr,Jr=Yr,Vr=function(e,t){return Rt(e,Jr(e),t)},Zr=function(e,t,r){var n=t(e);return er(e)?n:Ir(n,r(e))},qr=function(e){return Zr(e,vr,Dr)},$r=function(e){return Zr(e,Er,Jr)},Xr=_t(Ze,"DataView"),Qr=Xr,Kr=_t(Ze,"Promise"),en=Kr,tn=_t(Ze,"Set"),rn=tn,nn=_t(Ze,"WeakMap"),on=nn,an="[object Map]",sn="[object Promise]",ln="[object Set]",cn="[object WeakMap]",pn="[object DataView]",dn=gt(Qr),un=gt(Mt),yn=gt(en),gn=gt(rn),hn=gt(on),mn=st;(Qr&&mn(new Qr(new ArrayBuffer(1)))!=pn||Mt&&mn(new Mt)!=an||en&&mn(en.resolve())!=sn||rn&&mn(new rn)!=ln||on&&mn(new on)!=cn)&&(mn=function(e){var t=st(e),r=t=="[object Object]"?e.constructor:void 0,n=r?gt(r):"";if(n)switch(n){case dn:return pn;case un:return an;case yn:return sn;case gn:return ln;case hn:return cn;}return t});var fn=mn,bn=Object.prototype,xn=bn.hasOwnProperty,jn=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&xn.call(e,"index")&&(r.index=e.index,r.input=e.input),r},wn=Ze.Uint8Array,kn=wn,vn=function(e){var t=new e.constructor(e.byteLength);return new kn(t).set(new kn(e)),t},_n=function(e,t){var r=t?vn(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)},Sn=/\w*$/,Mn=function(e){var t=new e.constructor(e.source,Sn.exec(e));return t.lastIndex=e.lastIndex,t},Cn=$e?$e.prototype:void 0,Ln=Cn?Cn.valueOf:void 0,En=function(e){return Ln?Object(Ln.call(e)):{}},Pn=function(e,t){var r=t?vn(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)},An=function(e,t,r){var n=e.constructor;return"[object ArrayBuffer]"===t?vn(e):"[object Boolean]"===t||"[object Date]"===t?new n(+e):"[object DataView]"===t?_n(e,r):"[object Float32Array]"===t||"[object Float64Array]"===t||"[object Int8Array]"===t||"[object Int16Array]"===t||"[object Int32Array]"===t||"[object Uint8Array]"===t||"[object Uint8ClampedArray]"===t||"[object Uint16Array]"===t||"[object Uint32Array]"===t?Pn(e,r):"[object Map]"===t?new n:"[object Number]"===t||"[object String]"===t?new n(e):"[object RegExp]"===t?Mn(e):"[object Set]"===t?new n:"[object Symbol]"===t?En(e):void 0},On=Object.create,Wn=function(){function e(){}return function(t){if(!lt(t))return{};if(On)return On(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),Tn=function(e){return"function"!=typeof e.constructor||mr(e)?{}:Wn(Gr(e))},Nn=ir&&ir.isMap,zn=Nn?lr(Nn):function(e){return Jt(e)&&fn(e)=="[object Map]"},Un=zn,Hn=ir&&ir.isSet,Dn=Hn?lr(Hn):function(e){return Jt(e)&&fn(e)=="[object Set]"},Bn=Dn,In={};In["[object Arguments]"]=In["[object Array]"]=In["[object ArrayBuffer]"]=In["[object DataView]"]=In["[object Boolean]"]=In["[object Date]"]=In["[object Float32Array]"]=In["[object Float64Array]"]=In["[object Int8Array]"]=In["[object Int16Array]"]=In["[object Int32Array]"]=In["[object Map]"]=In["[object Number]"]=In["[object Object]"]=In["[object RegExp]"]=In["[object Set]"]=In["[object String]"]=In["[object Symbol]"]=In["[object Uint8Array]"]=In["[object Uint8ClampedArray]"]=In["[object Uint16Array]"]=In["[object Uint32Array]"]=!0,In["[object Error]"]=In["[object Function]"]=In["[object WeakMap]"]=!1;var Fn=S,Gn=function(e){return Fn(e,5)},Rn=function(e){return function(t,r,n){for(var o=-1,a=Object(t),s=n(t),l=s.length;l--;){var i=s[e?l:++o];if(!1===r(a[i],i,a))break}return t}}(),Yn=function(e,t){return function(r,n){if(null==r)return r;if(!kr(r))return e(r,n);for(var o=r.length,a=t?o:-1,s=Object(r);(t?a--:++a<o)&&!(!1===n(s[a],a,s)););return r}}(function(e,t){return e&&Rn(e,t,vr)}),Jn=Yn,Vn=function(e){return e},Zn=function(e){return"function"==typeof e?e:Vn},qn=function(e,t){var r=er(e)?Ut:Jn;return r(e,Zn(t))},$n=function(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o};M.prototype.add=M.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},M.prototype.has=function(e){return this.__data__.has(e)};var Xn=M,Qn=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1},Kn=function(e,t){return e.has(t)},eo=function(e,t,r,n,o,a){var s=1&r,l=e.length,i=t.length;if(l!=i&&!(s&&i>l))return!1;var c=a.get(e);if(c&&a.get(t))return c==t;var p=-1,d=!0,u=2&r?new Xn:void 0;for(a.set(e,t),a.set(t,e);++p<l;){var y=e[p],g=t[p];if(n)var h=s?n(g,y,p,t,e,a):n(y,g,p,e,t,a);if(void 0!==h){if(h)continue;d=!1;break}if(u){if(!Qn(t,function(e,t){if(!Kn(u,t)&&(y===e||o(y,e,r,n,a)))return u.push(t)})){d=!1;break}}else if(!(y===g||o(y,g,r,n,a))){d=!1;break}}return a["delete"](e),a["delete"](t),d},to=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r},ro=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r},no=$e?$e.prototype:void 0,oo=no?no.valueOf:void 0,ao=function(e,t,r,n,o,a,s){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!!(e.byteLength==t.byteLength&&a(new kn(e),new kn(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return De(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var l=to;case"[object Set]":var i=1&n;if(l||(l=ro),e.size!=t.size&&!i)return!1;var c=s.get(e);if(c)return c==t;n|=2,s.set(e,t);var p=eo(l(e),l(t),n,o,a,s);return s["delete"](e),p;case"[object Symbol]":if(oo)return oo.call(e)==oo.call(t);}return!1},so=Object.prototype,lo=so.hasOwnProperty,io=Object.prototype,co=io.hasOwnProperty,po=function(e,t,r,n,o,a){var s=er(e),l=er(t),i=s?"[object Array]":fn(e),c=l?"[object Array]":fn(t);i="[object Arguments]"==i?"[object Object]":i,c="[object Arguments]"==c?"[object Object]":c;var p="[object Object]"==i,d="[object Object]"==c,u=i==c;if(u&&rr(e)){if(!rr(t))return!1;s=!0,p=!1}if(u&&!p)return a||(a=new zt),s||dr(e)?eo(e,t,r,n,o,a):ao(e,t,i,r,n,o,a);if(!(1&r)){var y=p&&co.call(e,"__wrapped__"),g=d&&co.call(t,"__wrapped__");if(y||g){var h=y?e.value():e,m=g?t.value():t;return a||(a=new zt),o(h,m,r,n,a)}}return!!u&&(a||(a=new zt),C(e,t,r,n,o,a))},uo=L,yo=function(e){return e===e&&!lt(e)},go=function(e){for(var t=vr(e),r=t.length;r--;){var n=t[r],o=e[n];t[r]=[n,o,yo(o)]}return t},ho=function(e,t){return function(r){return null!=r&&r[e]===t&&(t!==void 0||e in Object(r))}},mo=function(e){var t=go(e);return 1==t.length&&t[0][2]?ho(t[0][0],t[0][1]):function(r){return r===e||E(r,e,t)}},fo=P,bo=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,xo=/^\w*$/,jo=A;O.Cache=Nt;var wo=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ko=/\\(\\)?/g,vo=function(e){var t=O(e,function(e){return 500===r.size&&r.clear(),e}),r=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(wo,function(e,r,n,o){t.push(n?o.replace(ko,"$1"):r||e)}),t}),_o=1/0,So=$e?$e.prototype:void 0,Mo=So?So.toString:void 0,Co=function(e){return null==e?"":W(e)},Lo=function(e,t){return er(e)?e:jo(e,t)?[e]:vo(Co(e))},Eo=function(e){if("string"==typeof e||fo(e))return e;var t=e+"";return"0"==t&&1/e==-(1/0)?"-0":t},Po=function(e,t){t=Lo(t,e);for(var r=0,n=t.length;null!=e&&r<n;)e=e[Eo(t[r++])];return r&&r==n?e:void 0},Ao=function(e,t,r){var n=null==e?void 0:Po(e,t);return n===void 0?r:n},Oo=function(e,t,r){t=Lo(t,e);for(var n=-1,o=t.length,a=!1,s;++n<o&&(s=Eo(t[n]),!!(a=null!=e&&r(e,s)));)e=e[s];return a||++n!=o?a:(o=null==e?0:e.length,!!o&&ar(o)&&or(s,o)&&(er(e)||Qt(e)))},Wo=function(e,t){return null!=e&&Oo(e,t,T)},To=function(e,t){return jo(e)&&yo(t)?ho(Eo(e),t):function(r){var n=Ao(r,e);return n===void 0&&n===t?Wo(r,e):uo(t,n,3)}},No=function(e){return function(t){return null==t?void 0:t[e]}},zo=function(e){return function(t){return Po(t,e)}},Uo=function(e){return jo(e)?No(Eo(e)):zo(e)},Ho=N,Do=function(e,t){var r=-1,n=kr(e)?Array(e.length):[];return Jn(e,function(e,o,a){n[++r]=t(e,o,a)}),n},Bo=function(e,t){var r=er(e)?$n:Do;return r(e,Ho(t))},Io=$e?$e.isConcatSpreadable:void 0,Fo=function(e){return er(e)||Qt(e)||!!(Io&&e&&e[Io])},Go=z,Ro=function(){var e=arguments.length;if(!e)return[];for(var t=Array(e-1),r=arguments[0],n=e;n--;)t[n-1]=arguments[n];return Ir(er(r)?Or(r):[r],Go(t,1))},Yo=Array.prototype,Jo=Yo.join,Vo=function(e,t){return null==e?"":Jo.call(e,t)},Zo=function(e,t,r,n){if(!lt(e))return e;t=Lo(t,e);for(var o=-1,a=t.length,s=e;null!=s&&++o<a;){var l=Eo(t[o]),i=r;if(o!=a-1){var c=s[l];i=n?n(c,l,s):void 0,i===void 0&&(i=lt(c)?c:or(t[o+1])?[]:{})}Gt(s,l,i),s=s[l]}return e},qo=function(e,t,r){for(var n=-1,o=t.length,a={};++n<o;){var s=t[n],l=Po(e,s);r(l,s)&&Zo(a,Lo(s,e),l)}return a},$o=function(e,t){return qo(e,t,function(t,r){return Wo(e,r)})},Xo=function(e){var t=null==e?0:e.length;return t?Go(e,1):[]},Qo=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2]);}return e.apply(t,r)},Ko=We,ea=function(e,t,r){return t=Ko(void 0===t?e.length-1:t,0),function(){for(var n=arguments,o=-1,a=Ko(n.length-t,0),s=Array(a);++o<a;)s[o]=n[t+o];o=-1;for(var l=Array(t+1);++o<t;)l[o]=n[o];return l[t]=r(s),Qo(e,this,l)}},ta=function(e){return function(){return e}},ra=Dt?function(e,t){return Dt(e,"toString",{configurable:!0,enumerable:!1,value:ta(t),writable:!0})}:Vn,na=Date.now,oa=function(e){var t=0,r=0;return function(){var n=na(),o=16-(n-r);if(r=n,!(0<o))t=0;else if(800<=++t)return arguments[0];return e.apply(void 0,arguments)}}(ra),aa=function(e){return oa(ea(e,void 0,Xo),e+"")},sa=aa(function(e,t){return null==e?{}:$o(e,t)}),la=sa,ia=0/0,ca=/^\s+|\s+$/g,pa=/^[-+]0x[0-9a-f]+$/i,da=/^0b[01]+$/i,ua=/^0o[0-7]+$/i,ya=parseInt,ga=function(e){if("number"==typeof e)return e;if(fo(e))return ia;if(lt(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=lt(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(ca,"");var r=da.test(e);return r||ua.test(e)?ya(e.slice(2),r?2:8):pa.test(e)?ia:+e},ha=1/0,ma=function(e){if(!e)return 0===e?e:0;if(e=ga(e),e===ha||e===-ha){var t=0>e?-1:1;return 1.7976931348623157e+308*t}return e===e?e:0},fa=function(e){var t=ma(e),r=t%1;return t===t?r?t-r:t:0},ba=function(e){return"number"==typeof e&&e==fa(e)},xa=Ze.isFinite,ja=function(e){var t=Math[e];return function(e,r){if(e=ga(e),r=null==r?0:Oe(fa(r),292),r&&xa(e)){var n=(Co(e)+"e").split("e"),o=t(n[0]+"e"+(+n[1]+r));return n=(Co(o)+"e").split("e"),+(n[0]+"e"+(+n[1]-r))}return t(e)}}("round"),wa=ja,ka=u(function(e,t){(function(r,n){e.exports=t=n()})(Ne,function(){var e=e||function(e,t){var r=(0,eval)("this").Math.ceil,n=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),o={},a=o.lib={},s=a.Base=function(){return{extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),l=a.WordArray=s.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r==t?4*e.length:r},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,o=e.sigBytes;if(this.clamp(),n%4)for(var a=0,s;a<o;a++)s=255&r[a>>>2]>>>24-8*(a%4),t[n+a>>>2]|=s<<24-8*((n+a)%4);else for(var a=0;a<o;a+=4)t[n+a>>>2]=r[a>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-8*(t%4),e.length=r(t/4)},clone:function e(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],o=function(t){var t=t,r=987654321,n=4294967295;return function(){r=36969*(65535&r)+(r>>16)&4294967295,t=18e3*(65535&t)+(t>>16)&4294967295;var o=(r<<16)+t&4294967295;return o/=4294967296,o+=.5,o*(.5<e.random()?1:-1)}},r=0,a,s;r<t;r+=4)s=o(4294967296*(a||e.random())),a=987654071*s(),n.push(0|4294967296*s());return new l.init(n,t)}}),i=o.enc={},c=i.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0,a;o<r;o++)a=255&t[o>>>2]>>>24-8*(o%4),n.push((a>>>4).toString(16)),n.push((15&a).toString(16));return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-4*(n%8);return new l.init(r,t/2)}},p=i.Latin1={stringify:function(e){for(var t=(0,eval)("this").String.fromCharCode,r=e.words,n=e.sigBytes,o=[],a=0,s;a<n;a++)s=255&r[a>>>2]>>>24-8*(a%4),o.push(t(s));return o.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-8*(n%4);return new l.init(r,t)}},d=i.Utf8={stringify:function(e){try{return decodeURIComponent(escape(p.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return p.parse(unescape(encodeURIComponent(e)))}},u=a.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,o=t.sigBytes,a=this.blockSize,s=o/(4*a);s=e?r(s):We((0|s)-this._minBufferSize,0);var i=s*a,c=Oe(4*i,o);if(i){for(var p=0;p<i;p+=a)this._doProcessBlock(n,p);var d=n.splice(0,i);t.sigBytes-=c}return new l.init(d,c)},clone:function e(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),y=a.Hasher=u.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new g.HMAC.init(e,r).finalize(t)}}}),g=o.algo={};return o}(Math);return e})}),va=u(function(e,t){(function(r,n){e.exports=t=n(ka)})(Ne,function(e){return function(t){var r=e,n=r.lib,o=n.Base,a=n.WordArray,s=r.x64={},l=s.Word=o.extend({init:function(e,t){this.high=e,this.low=t}}),i=s.WordArray=o.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r==t?8*e.length:r},toX32:function(){for(var e=this.words,t=e.length,r=[],n=0,o;n<t;n++)o=e[n],r.push(o.high),r.push(o.low);return a.create(r,this.sigBytes)},clone:function e(){for(var e=o.clone.call(this),t=e.words=this.words.slice(0),r=t.length,n=0;n<r;n++)t[n]=t[n].clone();return e}})}(),e})}),_a=u(function(e,t){(function(r,n){e.exports=t=n(ka,va)})(Ne,function(e){return function(){function t(){return s.create.apply(s,arguments)}var r=e,n=r.lib,o=n.Hasher,a=r.x64,s=a.Word,l=a.WordArray,i=r.algo,c=[t(1116352408,3609767458),t(1899447441,602891725),t(3049323471,3964484399),t(3921009573,2173295548),t(961987163,4081628472),t(1508970993,3053834265),t(2453635748,2937671579),t(2870763221,3664609560),t(3624381080,2734883394),t(310598401,1164996542),t(607225278,1323610764),t(1426881987,3590304994),t(1925078388,4068182383),t(2162078206,991336113),t(2614888103,633803317),t(3248222580,3479774868),t(3835390401,2666613458),t(4022224774,944711139),t(264347078,2341262773),t(604807628,2007800933),t(770255983,1495990901),t(1249150122,1856431235),t(1555081692,3175218132),t(1996064986,2198950837),t(2554220882,3999719339),t(2821834349,766784016),t(2952996808,2566594879),t(3210313671,3203337956),t(3336571891,1034457026),t(3584528711,2466948901),t(113926993,3758326383),t(338241895,168717936),t(666307205,1188179964),t(773529912,1546045734),t(1294757372,1522805485),t(1396182291,2643833823),t(1695183700,2343527390),t(1986661051,1014477480),t(2177026350,1206759142),t(2456956037,344077627),t(2730485921,1290863460),t(2820302411,3158454273),t(3259730800,3505952657),t(3345764771,106217008),t(3516065817,3606008344),t(3600352804,1432725776),t(4094571909,1467031594),t(275423344,851169720),t(430227734,3100823752),t(506948616,1363258195),t(659060556,3750685593),t(883997877,3785050280),t(958139571,3318307427),t(1322822218,3812723403),t(1537002063,2003034995),t(1747873779,3602036899),t(1955562222,1575990012),t(2024104815,1125592928),t(2227730452,2716904306),t(2361852424,442776044),t(2428436474,593698344),t(2756734187,3733110249),t(3204031479,2999351573),t(3329325298,3815920427),t(3391569614,3928383900),t(3515267271,566280711),t(3940187606,3454069534),t(4118630271,4000239992),t(116418474,1914138554),t(174292421,2731055270),t(289380356,3203993006),t(460393269,320620315),t(685471733,587496836),t(852142971,1086792851),t(1017036298,365543100),t(1126000580,2618297676),t(1288033470,3409855158),t(1501505948,4234509866),t(1607167915,987167468),t(1816402316,1246189591)],p=[];(function(){for(var e=0;80>e;e++)p[e]=t()})();var d=i.SHA512=o.extend({_doReset:function(){this._hash=new l.init([new s.init(1779033703,4089235720),new s.init(3144134277,2227873595),new s.init(1013904242,4271175723),new s.init(2773480762,1595750129),new s.init(1359893119,2917565137),new s.init(2600822924,725511199),new s.init(528734635,4215389547),new s.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],a=r[2],s=r[3],l=r[4],d=r[5],u=r[6],y=r[7],g=n.high,h=n.low,m=o.high,f=o.low,b=a.high,x=a.low,j=s.high,w=s.low,k=l.high,v=l.low,_=d.high,S=d.low,M=u.high,C=u.low,L=y.high,E=y.low,P=g,A=h,O=m,W=f,T=b,N=x,z=j,U=w,H=k,D=v,B=_,I=S,F=M,G=C,R=L,Y=E,J=0,V;80>J;J++){if(V=p[J],16>J)var Z=V.high=0|e[t+2*J],q=V.low=0|e[t+2*J+1];else{var $=p[J-15],X=$.high,Q=$.low,K=(Q>>>1|X<<31)^(Q>>>8|X<<24)^(Q>>>7|X<<25),ee=p[J-2],te=ee.high,re=ee.low,ne=(re>>>19|te<<13)^(re<<3|te>>>29)^(re>>>6|te<<26),oe=p[J-7],ae=oe.high,se=oe.low,le=p[J-16],ie=le.high,ce=le.low,q=K+se,Z=((X>>>1|Q<<31)^(X>>>8|Q<<24)^X>>>7)+ae+(q>>>0<K>>>0?1:0),q=q+ne,Z=Z+((te>>>19|re<<13)^(te<<3|re>>>29)^te>>>6)+(q>>>0<ne>>>0?1:0),q=q+ce,Z=Z+ie+(q>>>0<ce>>>0?1:0);V.high=Z,V.low=q}var pe=H&B^~H&F,de=D&I^~D&G,ue=P&O^P&T^O&T,ye=A&W^A&N^W&N,ge=(P>>>28|A<<4)^(P<<30|A>>>2)^(P<<25|A>>>7),he=(A>>>28|P<<4)^(A<<30|P>>>2)^(A<<25|P>>>7),me=(H>>>14|D<<18)^(H>>>18|D<<14)^(H<<23|D>>>9),fe=(D>>>14|H<<18)^(D>>>18|H<<14)^(D<<23|H>>>9),be=c[J],xe=be.high,je=be.low,we=Y+fe,ke=R+me+(we>>>0<Y>>>0?1:0),we=we+de,ke=ke+pe+(we>>>0<de>>>0?1:0),we=we+je,ke=ke+xe+(we>>>0<je>>>0?1:0),we=we+q,ke=ke+Z+(we>>>0<q>>>0?1:0),ve=he+ye,_e=ge+ue+(ve>>>0<he>>>0?1:0);R=F,Y=G,F=B,G=I,B=H,I=D,D=0|U+we,H=0|z+ke+(D>>>0<U>>>0?1:0),z=T,U=N,T=O,N=W,O=P,W=A,A=0|we+ve,P=0|ke+_e+(A>>>0<we>>>0?1:0)}h=n.low=h+A,n.high=g+P+(h>>>0<A>>>0?1:0),f=o.low=f+W,o.high=m+O+(f>>>0<W>>>0?1:0),x=a.low=x+N,a.high=b+T+(x>>>0<N>>>0?1:0),w=s.low=w+U,s.high=j+z+(w>>>0<U>>>0?1:0),v=l.low=v+D,l.high=k+H+(v>>>0<D>>>0?1:0),S=d.low=S+I,d.high=_+B+(S>>>0<I>>>0?1:0),C=u.low=C+G,u.high=M+F+(C>>>0<G>>>0?1:0),E=y.low=E+Y,y.high=L+R+(E>>>0<Y>>>0?1:0)},_doFinalize:function(){var e=Math.floor,t=this._data,r=t.words,n=8*this._nDataBytes,o=8*t.sigBytes;r[o>>>5]|=128<<24-o%32,r[(o+128>>>10<<5)+30]=e(n/4294967296),r[(o+128>>>10<<5)+31]=n,t.sigBytes=4*r.length,this._process();var a=this._hash.toX32();return a},clone:function e(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});r.SHA512=o._createHelper(d),r.HmacSHA512=o._createHmacHelper(d)}(),e.SHA512})}),Sa=u(function(e,t){(function(r,n){e.exports=t=n(ka)})(Ne,function(e){return function(){function t(e,t,r){for(var n=[],a=0,s=0;s<t;s++)if(s%4){var l=r[e.charCodeAt(s-1)]<<2*(s%4),c=r[e.charCodeAt(s)]>>>6-2*(s%4);n[a>>>2]|=(l|c)<<24-8*(a%4),a++}return o.create(n,a)}var r=e,n=r.lib,o=n.WordArray,a=r.enc,s=a.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var o=[],a=0;a<r;a+=3)for(var s=255&t[a>>>2]>>>24-8*(a%4),l=255&t[a+1>>>2]>>>24-8*((a+1)%4),c=255&t[a+2>>>2]>>>24-8*((a+2)%4),p=0;4>p&&a+.75*p<r;p++)o.push(n.charAt(63&(s<<16|l<<8|c)>>>6*(3-p)));var d=n.charAt(64);if(d)for(;o.length%4;)o.push(d);return o.join("")},parse:function(e){var r=e.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var a=0;a<n.length;a++)o[n.charCodeAt(a)]=a}var s=n.charAt(64);if(s){var l=e.indexOf(s);-1!==l&&(r=l)}return t(e,r,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64})}),Ma=u(function(e,t){(function(r,n){e.exports=t=n(ka)})(Ne,function(e){return e.enc.Hex})}),Ca=function(e){return!0===e||!1===e||Jt(e)&&st(e)=="[object Boolean]"},La=function(e,t,r,n){for(var o=e.length,a=r+(n?1:-1);n?a--:++a<o;)if(t(e[a],a,e))return a;return-1},Ea=function(e){return e!==e},Pa=function(e,t,r){for(var n=r-1,o=e.length;++n<o;)if(e[n]===t)return n;return-1},Aa=function(e,t,r){return t===t?Pa(e,t,r):La(e,Ea,r)},Oa=function(e,t){var r=null==e?0:e.length;return!!r&&-1<Aa(e,t,0)},Wa=function(e,t,r){for(var n=-1,o=null==e?0:e.length;++n<o;)if(r(t,e[n]))return!0;return!1},Ta=rn&&1/ro(new rn([,-0]))[1]==1/0?function(e){return new rn(e)}:function(){},Na=function(e,t,r){var n=-1,o=Oa,a=e.length,s=!0,l=[],i=l;if(r)s=!1,o=Wa;else if(a>=200){var c=t?null:Ta(e);if(c)return ro(c);s=!1,o=Kn,i=new Xn}else i=t?[]:l;outer:for(;++n<a;){var p=e[n],d=t?t(p):p;if(p=r||0!==p?p:0,s&&d===d){for(var u=i.length;u--;)if(i[u]===d)continue outer;t&&i.push(d),l.push(p)}else o(i,d,r)||(i!==l&&i.push(d),l.push(p))}return l},za=function(e,t){return e&&e.length?Na(e,Ho(t)):[]},Ua=function(e,t){return uo(e,t)},Ha=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0},Da=function(e,t,r){var n=-1,o=e.length;0>t&&(t=-t>o?0:o+t),r=r>o?o:r,0>r&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;for(var a=Array(o);++n<o;)a[n]=e[n+t];return a},Ba=function(e,t){return 2>t.length?e:Po(e,Da(t,0,-1))},Ia=function(e,t){return t=Lo(t,e),e=Ba(e,t),null==e||delete e[Eo(Ha(t))]},Fa=Function.prototype,Ga=Object.prototype,Ra=Fa.toString,Ya=Ga.hasOwnProperty,Ja=Ra.call(Object),Va=function(e){if(!Jt(e)||st(e)!="[object Object]")return!1;var t=Gr(e);if(null===t)return!0;var r=Ya.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Ra.call(r)==Ja},Za=function(e){return Va(e)?void 0:e},qa=aa(function(e,t){var r={};if(null==e)return r;var n=!1;t=$n(t,function(t){return t=Lo(t,e),n||(n=1<t.length),t}),Rt(e,$r(e),r),n&&(r=Fn(r,1|2|4,Za));for(var o=t.length;o--;)Ia(r,t[o]);return r}),$a=qa,Xa=function(e,t,r){var o=null==e?0:e.length;return o?(t=r||void 0===t?1:fa(t),Da(e,0>t?0:t,o)):[]},Qa={roleSystem:"system",roleGeneral:"general"},Ka={activeYes:"yes",activeNo:"no"},es=["<",">"];return Ae});
//# sourceMappingURL=w-user-server.umd.js.map
