/*!
 * w-user-server v1.0.25
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("events"),require("dayjs"),require("@hapi/hapi"),require("nodemailer")):"function"==typeof define&&define.amd?define(["events","dayjs","@hapi/hapi","nodemailer"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["w-user-server"]=t(e.events,e.dayjs,e["@hapi/hapi"],e.nodemailer)}(this,(function(e,t,n,r){"use strict";function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e){var t=function(e,t){if("object"!==o(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===o(t)?t:String(t)}function c(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){return e===t||e!=e&&t!=t}function u(e,t){for(var n=e.length;n--;)if(a(e[n][0],t))return n;return-1}var s=Array.prototype.splice;function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}l.prototype.clear=function(){this.__data__=[],this.size=0},l.prototype.delete=function(e){var t=this.__data__,n=u(t,e);return!(n<0)&&(n==t.length-1?t.pop():s.call(t,n,1),--this.size,!0)},l.prototype.get=function(e){var t=this.__data__,n=u(t,e);return n<0?void 0:t[n][1]},l.prototype.has=function(e){return u(this.__data__,e)>-1},l.prototype.set=function(e,t){var n=this.__data__,r=u(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};var f="object"==typeof global&&global&&global.Object===Object&&global,p="object"==typeof self&&self&&self.Object===Object&&self,d=f||p||Function("return this")(),h=d.Symbol,y=Object.prototype,v=y.hasOwnProperty,g=y.toString,m=h?h.toStringTag:void 0;var b=Object.prototype.toString;var j="[object Null]",w="[object Undefined]",_=h?h.toStringTag:void 0;function x(e){return null==e?void 0===e?w:j:_&&_ in Object(e)?function(e){var t=v.call(e,m),n=e[m];try{e[m]=void 0;var r=!0}catch(e){}var o=g.call(e);return r&&(t?e[m]=n:delete e[m]),o}(e):function(e){return b.call(e)}(e)}function k(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var O="[object AsyncFunction]",S="[object Function]",M="[object GeneratorFunction]",C="[object Proxy]";function A(e){if(!k(e))return!1;var t=x(e);return t==S||t==M||t==O||t==C}var E,P=d["__core-js_shared__"],T=(E=/[^.]+$/.exec(P&&P.keys&&P.keys.IE_PROTO||""))?"Symbol(src)_1."+E:"";var W=Function.prototype.toString;function B(e){if(null!=e){try{return W.call(e)}catch(e){}try{return e+""}catch(e){}}return""}var U=/^\[object .+?Constructor\]$/,z=Function.prototype,H=Object.prototype,D=z.toString,N=H.hasOwnProperty,L=RegExp("^"+D.call(N).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function I(e){return!(!k(e)||(t=e,T&&T in t))&&(A(e)?L:U).test(B(e));var t}function $(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return I(n)?n:void 0}var F=$(d,"Map"),R=$(Object,"create");var Z=Object.prototype.hasOwnProperty;var Y=Object.prototype.hasOwnProperty;function V(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function q(e,t){var n,r,o=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof t?"string":"hash"]:o.map}function G(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}V.prototype.clear=function(){this.__data__=R?R(null):{},this.size=0},V.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},V.prototype.get=function(e){var t=this.__data__;if(R){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Z.call(t,e)?t[e]:void 0},V.prototype.has=function(e){var t=this.__data__;return R?void 0!==t[e]:Y.call(t,e)},V.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=R&&void 0===t?"__lodash_hash_undefined__":t,this},G.prototype.clear=function(){this.size=0,this.__data__={hash:new V,map:new(F||l),string:new V}},G.prototype.delete=function(e){var t=q(this,e).delete(e);return this.size-=t?1:0,t},G.prototype.get=function(e){return q(this,e).get(e)},G.prototype.has=function(e){return q(this,e).has(e)},G.prototype.set=function(e,t){var n=q(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function J(e){var t=this.__data__=new l(e);this.size=t.size}function X(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}J.prototype.clear=function(){this.__data__=new l,this.size=0},J.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},J.prototype.get=function(e){return this.__data__.get(e)},J.prototype.has=function(e){return this.__data__.has(e)},J.prototype.set=function(e,t){var n=this.__data__;if(n instanceof l){var r=n.__data__;if(!F||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new G(r)}return n.set(e,t),this.size=n.size,this};var K=function(){try{var e=$(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),Q=K;function ee(e,t,n){"__proto__"==t&&Q?Q(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}var te=Object.prototype.hasOwnProperty;function ne(e,t,n){var r=e[t];te.call(e,t)&&a(r,n)&&(void 0!==n||t in e)||ee(e,t,n)}function re(e,t,n,r){var o=!n;n||(n={});for(var i=-1,c=t.length;++i<c;){var a=t[i],u=r?r(n[a],e[a],a,n,e):void 0;void 0===u&&(u=e[a]),o?ee(n,a,u):ne(n,a,u)}return n}function oe(e){return null!=e&&"object"==typeof e}function ie(e){return oe(e)&&"[object Arguments]"==x(e)}var ce=Object.prototype,ae=ce.hasOwnProperty,ue=ce.propertyIsEnumerable,se=ie(function(){return arguments}())?ie:function(e){return oe(e)&&ae.call(e,"callee")&&!ue.call(e,"callee")},le=se,fe=Array.isArray;var pe="object"==typeof exports&&exports&&!exports.nodeType&&exports,de=pe&&"object"==typeof module&&module&&!module.nodeType&&module,he=de&&de.exports===pe?d.Buffer:void 0,ye=(he?he.isBuffer:void 0)||function(){return!1},ve=9007199254740991,ge=/^(?:0|[1-9]\d*)$/;function me(e,t){var n=typeof e;return!!(t=null==t?ve:t)&&("number"==n||"symbol"!=n&&ge.test(e))&&e>-1&&e%1==0&&e<t}var be=9007199254740991;function je(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=be}var we={};function _e(e){return function(t){return e(t)}}we["[object Float32Array]"]=we["[object Float64Array]"]=we["[object Int8Array]"]=we["[object Int16Array]"]=we["[object Int32Array]"]=we["[object Uint8Array]"]=we["[object Uint8ClampedArray]"]=we["[object Uint16Array]"]=we["[object Uint32Array]"]=!0,we["[object Arguments]"]=we["[object Array]"]=we["[object ArrayBuffer]"]=we["[object Boolean]"]=we["[object DataView]"]=we["[object Date]"]=we["[object Error]"]=we["[object Function]"]=we["[object Map]"]=we["[object Number]"]=we["[object Object]"]=we["[object RegExp]"]=we["[object Set]"]=we["[object String]"]=we["[object WeakMap]"]=!1;var xe="object"==typeof exports&&exports&&!exports.nodeType&&exports,ke=xe&&"object"==typeof module&&module&&!module.nodeType&&module,Oe=ke&&ke.exports===xe&&f.process,Se=function(){try{var e=ke&&ke.require&&ke.require("util").types;return e||Oe&&Oe.binding&&Oe.binding("util")}catch(e){}}(),Me=Se&&Se.isTypedArray,Ce=Me?_e(Me):function(e){return oe(e)&&je(e.length)&&!!we[x(e)]},Ae=Object.prototype.hasOwnProperty;function Ee(e,t){var n=fe(e),r=!n&&le(e),o=!n&&!r&&ye(e),i=!n&&!r&&!o&&Ce(e),c=n||r||o||i,a=c?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],u=a.length;for(var s in e)!t&&!Ae.call(e,s)||c&&("length"==s||o&&("offset"==s||"parent"==s)||i&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||me(s,u))||a.push(s);return a}var Pe=Object.prototype;function Te(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Pe)}function We(e,t){return function(n){return e(t(n))}}var Be=We(Object.keys,Object),Ue=Object.prototype.hasOwnProperty;function ze(e){return null!=e&&je(e.length)&&!A(e)}function He(e){return ze(e)?Ee(e):function(e){if(!Te(e))return Be(e);var t=[];for(var n in Object(e))Ue.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}var De=Object.prototype.hasOwnProperty;function Ne(e){if(!k(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=Te(e),n=[];for(var r in e)("constructor"!=r||!t&&De.call(e,r))&&n.push(r);return n}function Le(e){return ze(e)?Ee(e,!0):Ne(e)}var Ie="object"==typeof exports&&exports&&!exports.nodeType&&exports,$e=Ie&&"object"==typeof module&&module&&!module.nodeType&&module,Fe=$e&&$e.exports===Ie?d.Buffer:void 0,Re=Fe?Fe.allocUnsafe:void 0;function Ze(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}function Ye(){return[]}var Ve=Object.prototype.propertyIsEnumerable,qe=Object.getOwnPropertySymbols,Ge=qe?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,r=null==e?0:e.length,o=0,i=[];++n<r;){var c=e[n];t(c,n,e)&&(i[o++]=c)}return i}(qe(e),(function(t){return Ve.call(e,t)})))}:Ye,Je=Ge;function Xe(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}var Ke=We(Object.getPrototypeOf,Object),Qe=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Xe(t,Je(e)),e=Ke(e);return t}:Ye,et=Qe;function tt(e,t,n){var r=t(e);return fe(e)?r:Xe(r,n(e))}function nt(e){return tt(e,He,Je)}function rt(e){return tt(e,Le,et)}var ot=$(d,"DataView"),it=$(d,"Promise"),ct=$(d,"Set"),at=$(d,"WeakMap"),ut="[object Map]",st="[object Promise]",lt="[object Set]",ft="[object WeakMap]",pt="[object DataView]",dt=B(ot),ht=B(F),yt=B(it),vt=B(ct),gt=B(at),mt=x;(ot&&mt(new ot(new ArrayBuffer(1)))!=pt||F&&mt(new F)!=ut||it&&mt(it.resolve())!=st||ct&&mt(new ct)!=lt||at&&mt(new at)!=ft)&&(mt=function(e){var t=x(e),n="[object Object]"==t?e.constructor:void 0,r=n?B(n):"";if(r)switch(r){case dt:return pt;case ht:return ut;case yt:return st;case vt:return lt;case gt:return ft}return t});var bt=mt,jt=Object.prototype.hasOwnProperty;var wt=d.Uint8Array;function _t(e){var t=new e.constructor(e.byteLength);return new wt(t).set(new wt(e)),t}var xt=/\w*$/;var kt=h?h.prototype:void 0,Ot=kt?kt.valueOf:void 0;var St="[object Boolean]",Mt="[object Date]",Ct="[object Map]",At="[object Number]",Et="[object RegExp]",Pt="[object Set]",Tt="[object String]",Wt="[object Symbol]",Bt="[object ArrayBuffer]",Ut="[object DataView]",zt="[object Float32Array]",Ht="[object Float64Array]",Dt="[object Int8Array]",Nt="[object Int16Array]",Lt="[object Int32Array]",It="[object Uint8Array]",$t="[object Uint8ClampedArray]",Ft="[object Uint16Array]",Rt="[object Uint32Array]";function Zt(e,t,n){var r,o,i,c=e.constructor;switch(t){case Bt:return _t(e);case St:case Mt:return new c(+e);case Ut:return function(e,t){var n=t?_t(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case zt:case Ht:case Dt:case Nt:case Lt:case It:case $t:case Ft:case Rt:return function(e,t){var n=t?_t(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}(e,n);case Ct:return new c;case At:case Tt:return new c(e);case Et:return(i=new(o=e).constructor(o.source,xt.exec(o))).lastIndex=o.lastIndex,i;case Pt:return new c;case Wt:return r=e,Ot?Object(Ot.call(r)):{}}}var Yt=Object.create,Vt=function(){function e(){}return function(t){if(!k(t))return{};if(Yt)return Yt(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}(),qt=Vt;var Gt=Se&&Se.isMap,Jt=Gt?_e(Gt):function(e){return oe(e)&&"[object Map]"==bt(e)};var Xt=Se&&Se.isSet,Kt=Xt?_e(Xt):function(e){return oe(e)&&"[object Set]"==bt(e)},Qt=1,en=2,tn=4,nn="[object Arguments]",rn="[object Function]",on="[object GeneratorFunction]",cn="[object Object]",an={};function un(e,t,n,r,o,i){var c,a=t&Qt,u=t&en,s=t&tn;if(n&&(c=o?n(e,r,o,i):n(e)),void 0!==c)return c;if(!k(e))return e;var l=fe(e);if(l){if(c=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&jt.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!a)return Ze(e,c)}else{var f=bt(e),p=f==rn||f==on;if(ye(e))return function(e,t){if(t)return e.slice();var n=e.length,r=Re?Re(n):new e.constructor(n);return e.copy(r),r}(e,a);if(f==cn||f==nn||p&&!o){if(c=u||p?{}:function(e){return"function"!=typeof e.constructor||Te(e)?{}:qt(Ke(e))}(e),!a)return u?function(e,t){return re(e,et(e),t)}(e,function(e,t){return e&&re(t,Le(t),e)}(c,e)):function(e,t){return re(e,Je(e),t)}(e,function(e,t){return e&&re(t,He(t),e)}(c,e))}else{if(!an[f])return o?e:{};c=Zt(e,f,a)}}i||(i=new J);var d=i.get(e);if(d)return d;i.set(e,c),Kt(e)?e.forEach((function(r){c.add(un(r,t,n,r,e,i))})):Jt(e)&&e.forEach((function(r,o){c.set(o,un(r,t,n,o,e,i))}));var h=l?void 0:(s?u?rt:nt:u?Le:He)(e);return X(h||e,(function(r,o){h&&(r=e[o=r]),ne(c,o,un(r,t,n,o,e,i))})),c}an[nn]=an["[object Array]"]=an["[object ArrayBuffer]"]=an["[object DataView]"]=an["[object Boolean]"]=an["[object Date]"]=an["[object Float32Array]"]=an["[object Float64Array]"]=an["[object Int8Array]"]=an["[object Int16Array]"]=an["[object Int32Array]"]=an["[object Map]"]=an["[object Number]"]=an[cn]=an["[object RegExp]"]=an["[object Set]"]=an["[object String]"]=an["[object Symbol]"]=an["[object Uint8Array]"]=an["[object Uint8ClampedArray]"]=an["[object Uint16Array]"]=an["[object Uint32Array]"]=!0,an["[object Error]"]=an[rn]=an["[object WeakMap]"]=!1;var sn=1,ln=4;function fn(e){return un(e,sn|ln)}var pn,dn=function(e,t,n){for(var r=-1,o=Object(e),i=n(e),c=i.length;c--;){var a=i[pn?c:++r];if(!1===t(o[a],a,o))break}return e};var hn=function(e,t){return function(n,r){if(null==n)return n;if(!ze(n))return e(n,r);for(var o=n.length,i=t?o:-1,c=Object(n);(t?i--:++i<o)&&!1!==r(c[i],i,c););return n}}((function(e,t){return e&&dn(e,t,He)})),yn=hn;function vn(e){return e}function gn(e,t){var n;return(fe(e)?X:yn)(e,"function"==typeof(n=t)?n:vn)}function mn(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o}function bn(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new G;++t<n;)this.add(e[t])}function jn(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function wn(e,t){return e.has(t)}bn.prototype.add=bn.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},bn.prototype.has=function(e){return this.__data__.has(e)};var _n=1,xn=2;function kn(e,t,n,r,o,i){var c=n&_n,a=e.length,u=t.length;if(a!=u&&!(c&&u>a))return!1;var s=i.get(e),l=i.get(t);if(s&&l)return s==t&&l==e;var f=-1,p=!0,d=n&xn?new bn:void 0;for(i.set(e,t),i.set(t,e);++f<a;){var h=e[f],y=t[f];if(r)var v=c?r(y,h,f,t,e,i):r(h,y,f,e,t,i);if(void 0!==v){if(v)continue;p=!1;break}if(d){if(!jn(t,(function(e,t){if(!wn(d,t)&&(h===e||o(h,e,n,r,i)))return d.push(t)}))){p=!1;break}}else if(h!==y&&!o(h,y,n,r,i)){p=!1;break}}return i.delete(e),i.delete(t),p}function On(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function Sn(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var Mn=1,Cn=2,An="[object Boolean]",En="[object Date]",Pn="[object Error]",Tn="[object Map]",Wn="[object Number]",Bn="[object RegExp]",Un="[object Set]",zn="[object String]",Hn="[object Symbol]",Dn="[object ArrayBuffer]",Nn="[object DataView]",Ln=h?h.prototype:void 0,In=Ln?Ln.valueOf:void 0;var $n=1,Fn=Object.prototype.hasOwnProperty;var Rn=1,Zn="[object Arguments]",Yn="[object Array]",Vn="[object Object]",qn=Object.prototype.hasOwnProperty;function Gn(e,t,n,r,o,i){var c=fe(e),u=fe(t),s=c?Yn:bt(e),l=u?Yn:bt(t),f=(s=s==Zn?Vn:s)==Vn,p=(l=l==Zn?Vn:l)==Vn,d=s==l;if(d&&ye(e)){if(!ye(t))return!1;c=!0,f=!1}if(d&&!f)return i||(i=new J),c||Ce(e)?kn(e,t,n,r,o,i):function(e,t,n,r,o,i,c){switch(n){case Nn:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Dn:return!(e.byteLength!=t.byteLength||!i(new wt(e),new wt(t)));case An:case En:case Wn:return a(+e,+t);case Pn:return e.name==t.name&&e.message==t.message;case Bn:case zn:return e==t+"";case Tn:var u=On;case Un:var s=r&Mn;if(u||(u=Sn),e.size!=t.size&&!s)return!1;var l=c.get(e);if(l)return l==t;r|=Cn,c.set(e,t);var f=kn(u(e),u(t),r,o,i,c);return c.delete(e),f;case Hn:if(In)return In.call(e)==In.call(t)}return!1}(e,t,s,n,r,o,i);if(!(n&Rn)){var h=f&&qn.call(e,"__wrapped__"),y=p&&qn.call(t,"__wrapped__");if(h||y){var v=h?e.value():e,g=y?t.value():t;return i||(i=new J),o(v,g,n,r,i)}}return!!d&&(i||(i=new J),function(e,t,n,r,o,i){var c=n&$n,a=nt(e),u=a.length;if(u!=nt(t).length&&!c)return!1;for(var s=u;s--;){var l=a[s];if(!(c?l in t:Fn.call(t,l)))return!1}var f=i.get(e),p=i.get(t);if(f&&p)return f==t&&p==e;var d=!0;i.set(e,t),i.set(t,e);for(var h=c;++s<u;){var y=e[l=a[s]],v=t[l];if(r)var g=c?r(v,y,l,t,e,i):r(y,v,l,e,t,i);if(!(void 0===g?y===v||o(y,v,n,r,i):g)){d=!1;break}h||(h="constructor"==l)}if(d&&!h){var m=e.constructor,b=t.constructor;m==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof m&&m instanceof m&&"function"==typeof b&&b instanceof b||(d=!1)}return i.delete(e),i.delete(t),d}(e,t,n,r,o,i))}function Jn(e,t,n,r,o){return e===t||(null==e||null==t||!oe(e)&&!oe(t)?e!=e&&t!=t:Gn(e,t,n,r,Jn,o))}var Xn=1,Kn=2;function Qn(e){return e==e&&!k(e)}function er(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}}function tr(e){var t=function(e){for(var t=He(e),n=t.length;n--;){var r=t[n],o=e[r];t[n]=[r,o,Qn(o)]}return t}(e);return 1==t.length&&t[0][2]?er(t[0][0],t[0][1]):function(n){return n===e||function(e,t,n,r){var o=n.length,i=o,c=!r;if(null==e)return!i;for(e=Object(e);o--;){var a=n[o];if(c&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++o<i;){var u=(a=n[o])[0],s=e[u],l=a[1];if(c&&a[2]){if(void 0===s&&!(u in e))return!1}else{var f=new J;if(r)var p=r(s,l,u,e,t,f);if(!(void 0===p?Jn(l,s,Xn|Kn,r,f):p))return!1}}return!0}(n,e,t)}}var nr="[object Symbol]";function rr(e){return"symbol"==typeof e||oe(e)&&x(e)==nr}var or=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ir=/^\w*$/;function cr(e,t){if(fe(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!rr(e))||(ir.test(e)||!or.test(e)||null!=t&&e in Object(t))}var ar="Expected a function";function ur(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(ar);var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var c=e.apply(this,r);return n.cache=i.set(o,c)||i,c};return n.cache=new(ur.Cache||G),n}ur.Cache=G;var sr,lr,fr,pr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dr=/\\(\\)?/g,hr=(sr=function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(pr,(function(e,n,r,o){t.push(r?o.replace(dr,"$1"):n||e)})),t},lr=ur(sr,(function(e){return 500===fr.size&&fr.clear(),e})),fr=lr.cache,lr),yr=hr,vr=1/0,gr=h?h.prototype:void 0,mr=gr?gr.toString:void 0;function br(e){if("string"==typeof e)return e;if(fe(e))return mn(e,br)+"";if(rr(e))return mr?mr.call(e):"";var t=e+"";return"0"==t&&1/e==-vr?"-0":t}function jr(e){return null==e?"":br(e)}function wr(e,t){return fe(e)?e:cr(e,t)?[e]:yr(jr(e))}var _r=1/0;function xr(e){if("string"==typeof e||rr(e))return e;var t=e+"";return"0"==t&&1/e==-_r?"-0":t}function kr(e,t){for(var n=0,r=(t=wr(t,e)).length;null!=e&&n<r;)e=e[xr(t[n++])];return n&&n==r?e:void 0}function Or(e,t,n){var r=null==e?void 0:kr(e,t);return void 0===r?n:r}function Sr(e,t){return null!=e&&t in Object(e)}function Mr(e,t){return null!=e&&function(e,t,n){for(var r=-1,o=(t=wr(t,e)).length,i=!1;++r<o;){var c=xr(t[r]);if(!(i=null!=e&&n(e,c)))break;e=e[c]}return i||++r!=o?i:!!(o=null==e?0:e.length)&&je(o)&&me(c,o)&&(fe(e)||le(e))}(e,t,Sr)}var Cr=1,Ar=2;function Er(e){return cr(e)?(t=xr(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return kr(t,e)}}(e);var t}function Pr(e){return"function"==typeof e?e:null==e?vn:"object"==typeof e?fe(e)?(t=e[0],n=e[1],cr(t)&&Qn(n)?er(xr(t),n):function(e){var r=Or(e,t);return void 0===r&&r===n?Mr(e,t):Jn(n,r,Cr|Ar)}):tr(e):Er(e);var t,n}function Tr(e,t){var n=-1,r=ze(e)?Array(e.length):[];return yn(e,(function(e,o,i){r[++n]=t(e,o,i)})),r}function Wr(e,t){return(fe(e)?mn:Tr)(e,Pr(t))}var Br=h?h.isConcatSpreadable:void 0;function Ur(e){return fe(e)||le(e)||!!(Br&&e&&e[Br])}function zr(e,t,n,r,o){var i=-1,c=e.length;for(n||(n=Ur),o||(o=[]);++i<c;){var a=e[i];t>0&&n(a)?t>1?zr(a,t-1,n,r,o):Xe(o,a):r||(o[o.length]=a)}return o}var Hr=Array.prototype.join;function Dr(e,t,n,r){if(!k(e))return e;for(var o=-1,i=(t=wr(t,e)).length,c=i-1,a=e;null!=a&&++o<i;){var u=xr(t[o]),s=n;if("__proto__"===u||"constructor"===u||"prototype"===u)return e;if(o!=c){var l=a[u];void 0===(s=r?r(l,u,a):void 0)&&(s=k(l)?l:me(t[o+1])?[]:{})}ne(a,u,s),a=a[u]}return e}function Nr(e,t){return function(e,t,n){for(var r=-1,o=t.length,i={};++r<o;){var c=t[r],a=kr(e,c);n(a,c)&&Dr(i,wr(c,e),a)}return i}(e,t,(function(t,n){return Mr(e,n)}))}function Lr(e){return(null==e?0:e.length)?zr(e,1):[]}var Ir=Math.max;var $r=Q?function(e,t){return Q(e,"toString",{configurable:!0,enumerable:!1,value:(n=t,function(){return n}),writable:!0});var n}:vn,Fr=$r,Rr=Date.now;var Zr=function(e){var t=0,n=0;return function(){var r=Rr(),o=16-(r-n);if(n=r,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(Fr),Yr=Zr;var Vr=function(e){return Yr(function(e,t,n){return t=Ir(void 0===t?e.length-1:t,0),function(){for(var r=arguments,o=-1,i=Ir(r.length-t,0),c=Array(i);++o<i;)c[o]=r[t+o];o=-1;for(var a=Array(t+1);++o<t;)a[o]=r[o];return a[t]=n(c),function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}(e,this,a)}}(e,void 0,Lr),e+"")}((function(e,t){return null==e?{}:Nr(e,t)})),qr=Vr;function Gr(){let e,t,n=new Promise((function(){e=arguments[0],t=arguments[1]}));return n.resolve=e,n.reject=t,n}var Jr=/\s/;var Xr=/^\s+/;function Kr(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&Jr.test(e.charAt(t)););return t}(e)+1).replace(Xr,""):e}var Qr=NaN,eo=/^[-+]0x[0-9a-f]+$/i,to=/^0b[01]+$/i,no=/^0o[0-7]+$/i,ro=parseInt;function oo(e){if("number"==typeof e)return e;if(rr(e))return Qr;if(k(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=k(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Kr(e);var n=to.test(e);return n||no.test(e)?ro(e.slice(2),n?2:8):eo.test(e)?Qr:+e}var io=1/0,co=17976931348623157e292;function ao(e){return e?(e=oo(e))===io||e===-io?(e<0?-1:1)*co:e==e?e:0:0===e?e:0}function uo(e){var t=ao(e),n=t%1;return t==t?n?t-n:t:0}function so(e){return"[object String]"===Object.prototype.toString.call(e)}function lo(e){return!(!so(e)||""===e)}function fo(e){return e!=e}function po(e){let t=!1;if(lo(e))t=!isNaN(Number(e));else if(function(e){return"[object Number]"===Object.prototype.toString.call(e)}(e)){if(fo(e))return!1;t=!0}return t}function ho(e){if(!po(e))return 0;return ao(e)}function yo(e){return!!po(e)&&(e=ho(e),"number"==typeof(t=e)&&t==uo(t));var t}var vo=d.isFinite,go=Math.min;var mo=function(e){var t=Math[e];return function(e,n){if(e=oo(e),(n=null==n?0:go(uo(n),292))&&vo(e)){var r=(jr(e)+"e").split("e");return+((r=(jr(t(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}("round"),bo=mo;function jo(e){if(!po(e))return 0;e=ho(e);let t=bo(e);return"0"===String(t)?0:t}function wo(e){if(!yo(e))return!1;return jo(e)>0}let _o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),xo=_o.length;function ko(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,t=[];e=wo(e)?jo(e):32;for(let n=0;n<e;n++)t[n]=_o[0|Math.random()*xo];return t.join("")}function Oo(e){return"[object Object]"===Object.prototype.toString.call(e)}function So(e){if(Oo(e)){for(let t in e)return!0;return!1}return!1}function Mo(e,t){if(!lo(e))return"";if(!So(t))return"";let n=!1;return gn(t,(function(e,t){so(e)||(n=!0)})),n?"":(gn(t,(function(t,n){e=function(e,t,n){return lo(e)&&lo(t)&&so(n)?String(e).replaceAll(t,n):""}(e,n,t)})),e)}function Co(e,t){return!!Oo(e)&&(!(!lo(t)&&!po(t))&&t in e)}function Ao(e){let t=Object.prototype.toString.call(e);return"[object Function]"===t||"[object AsyncFunction]"===t}function Eo(){if(!Ao(t))throw new Error("invalid dayjs");return t().format("YYYY-MM-DDTHH:mm:ssZ")}function Po(e){return"[object Array]"===Object.prototype.toString.call(e)}function To(e){return!!function(e){return"[object Undefined]"===Object.prototype.toString.call(e)}(e)||(!!function(e){return"[object Null]"===Object.prototype.toString.call(e)}(e)||(!!function(e){if(Oo(e)){for(let t in e)return!1;return!0}return!1}(e)||(!!function(e){return!(!so(e)||""!==e)}(e)||(!!function(e){return!!Po(e)&&0===e.length}(e)||!!fo(e)))))}function Wo(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"anyone";if(!lo(e))return!1;if("anyone"!==n&&"all"!==n)return!1;if(so(t)){if(!lo(t))return!1;t=[t]}if(!Po(r=t)||0===r.length||1===r.length&&To(r[0]))return!1;var r;let o=!1;if(gn(t,(function(e){lo(e)||(o=!0)})),o)return!1;let i=0;return gn(t,(function(t){-1!==function(e,t){return e.indexOf(t)}(e,t)&&i++})),"anyone"===n?i>0:"all"===n&&i===t.length}function Bo(e){if(!yo(e))return!1;return jo(e)>=0}function Uo(e,t){return lo(e)&&Bo(t)?0===(t=jo(t))?e:function(e,t){return lo(e)&&Bo(t)?0===(t=jo(t))?"":e.substring(0,t):""}(e,e.length-t):""}function zo(e,t){if(!lo(e))return"";if(!Bo(t))return"";if(0===(t=jo(t)))return"";let n=e.length-t;return n<0&&(n=0),e.substr(n,t)}function Ho(e){let t;return t=zo(e,1),"Z"===t?`${e=Uo(e,1)}+00:00`:e}let Do={checkTZ:function(e){let t;return t=zo(e,1),"Z"===t||(t=zo(e,6),!!/[+|-]\d\d:\d\d/.test(t))},delTZ:function(e){let t;return t=zo(e,1),Uo(e,"Z"===t?1:6)},normTZ:Ho,sepTZ:function(e){let t=Ho(e);return{t:Uo(t,6),tz:zo(t,6)}}};function No(e){return!!lo(e)&&/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e)}var Lo="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Io(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){if(this instanceof e){var n=[null];return n.push.apply(n,arguments),new(Function.bind.apply(t,n))}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}var $o={},Fo={get exports(){return $o},set exports(e){$o=e}};var Ro,Zo={},Yo={get exports(){return Zo},set exports(e){Zo=e}},Vo=Io(Object.freeze({__proto__:null,default:{}}));function qo(){return Ro||(Ro=1,function(e,t){var n;e.exports=(n=n||function(e,t){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==Lo&&Lo.crypto&&(n=Lo.crypto),!n)try{n=Vo}catch(e){}var r=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},c=i.lib={},a=c.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},u=c.WordArray=a.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,o=e.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var c=n[i>>>2]>>>24-i%4*8&255;t[r+i>>>2]|=c<<24-(r+i)%4*8}else for(var a=0;a<o;a+=4)t[r+a>>>2]=n[a>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(r());return new u.init(t,e)}}),s=i.enc={},l=s.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new u.init(n,t/2)}},f=s.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new u.init(n,t)}},p=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(f.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return f.parse(unescape(encodeURIComponent(e)))}},d=c.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,o=r.words,i=r.sigBytes,c=this.blockSize,a=i/(4*c),s=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*c,l=e.min(4*s,i);if(s){for(var f=0;f<s;f+=c)this._doProcessBlock(o,f);n=o.splice(0,s),r.sigBytes-=l}return new u.init(n,l)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});c.Hasher=d.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=i.algo={};return i}(Math),n)}(Yo)),Zo}var Go,Jo={},Xo={get exports(){return Jo},set exports(e){Jo=e}};!function(e,t){var n;e.exports=(n=qo(),Go||(Go=1,function(e,t){var n,r,o,i,c,a,u;e.exports=(o=(r=u=qo()).lib,i=o.Base,c=o.WordArray,(a=r.x64={}).Word=i.extend({init:function(e,t){this.high=e,this.low=t}}),a.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=t!=n?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var o=e[r];n.push(o.high),n.push(o.low)}return c.create(n,this.sigBytes)},clone:function(){for(var e=i.clone.call(this),t=e.words=this.words.slice(0),n=t.length,r=0;r<n;r++)t[r]=t[r].clone();return e}}),u)}(Xo)),function(){var e=n,t=e.lib.Hasher,r=e.x64,o=r.Word,i=r.WordArray,c=e.algo;function a(){return o.create.apply(o,arguments)}var u=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],s=[];!function(){for(var e=0;e<80;e++)s[e]=a()}();var l=c.SHA512=t.extend({_doReset:function(){this._hash=new i.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],c=n[3],a=n[4],l=n[5],f=n[6],p=n[7],d=r.high,h=r.low,y=o.high,v=o.low,g=i.high,m=i.low,b=c.high,j=c.low,w=a.high,_=a.low,x=l.high,k=l.low,O=f.high,S=f.low,M=p.high,C=p.low,A=d,E=h,P=y,T=v,W=g,B=m,U=b,z=j,H=w,D=_,N=x,L=k,I=O,$=S,F=M,R=C,Z=0;Z<80;Z++){var Y,V,q=s[Z];if(Z<16)V=q.high=0|e[t+2*Z],Y=q.low=0|e[t+2*Z+1];else{var G=s[Z-15],J=G.high,X=G.low,K=(J>>>1|X<<31)^(J>>>8|X<<24)^J>>>7,Q=(X>>>1|J<<31)^(X>>>8|J<<24)^(X>>>7|J<<25),ee=s[Z-2],te=ee.high,ne=ee.low,re=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,oe=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),ie=s[Z-7],ce=ie.high,ae=ie.low,ue=s[Z-16],se=ue.high,le=ue.low;V=(V=(V=K+ce+((Y=Q+ae)>>>0<Q>>>0?1:0))+re+((Y+=oe)>>>0<oe>>>0?1:0))+se+((Y+=le)>>>0<le>>>0?1:0),q.high=V,q.low=Y}var fe,pe=H&N^~H&I,de=D&L^~D&$,he=A&P^A&W^P&W,ye=E&T^E&B^T&B,ve=(A>>>28|E<<4)^(A<<30|E>>>2)^(A<<25|E>>>7),ge=(E>>>28|A<<4)^(E<<30|A>>>2)^(E<<25|A>>>7),me=(H>>>14|D<<18)^(H>>>18|D<<14)^(H<<23|D>>>9),be=(D>>>14|H<<18)^(D>>>18|H<<14)^(D<<23|H>>>9),je=u[Z],we=je.high,_e=je.low,xe=F+me+((fe=R+be)>>>0<R>>>0?1:0),ke=ge+ye;F=I,R=$,I=N,$=L,N=H,L=D,H=U+(xe=(xe=(xe=xe+pe+((fe+=de)>>>0<de>>>0?1:0))+we+((fe+=_e)>>>0<_e>>>0?1:0))+V+((fe+=Y)>>>0<Y>>>0?1:0))+((D=z+fe|0)>>>0<z>>>0?1:0)|0,U=W,z=B,W=P,B=T,P=A,T=E,A=xe+(ve+he+(ke>>>0<ge>>>0?1:0))+((E=fe+ke|0)>>>0<fe>>>0?1:0)|0}h=r.low=h+E,r.high=d+A+(h>>>0<E>>>0?1:0),v=o.low=v+T,o.high=y+P+(v>>>0<T>>>0?1:0),m=i.low=m+B,i.high=g+W+(m>>>0<B>>>0?1:0),j=c.low=j+z,c.high=b+U+(j>>>0<z>>>0?1:0),_=a.low=_+D,a.high=w+H+(_>>>0<D>>>0?1:0),k=l.low=k+L,l.high=x+N+(k>>>0<L>>>0?1:0),S=f.low=S+$,f.high=O+I+(S>>>0<$>>>0?1:0),C=p.low=C+R,p.high=M+F+(C>>>0<R>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(r+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(l),e.HmacSHA512=t._createHmacHelper(l)}(),n.SHA512)}(Fo);var Ko=$o,Qo={};!function(e,t){var n;e.exports=(n=qo(),function(){var e=n,t=e.lib.WordArray;function r(e,n,r){for(var o=[],i=0,c=0;c<n;c++)if(c%4){var a=r[e.charCodeAt(c-1)]<<c%4*2|r[e.charCodeAt(c)]>>>6-c%4*2;o[i>>>2]|=a<<24-i%4*8,i++}return t.create(o,i)}e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var o=[],i=0;i<n;i+=3)for(var c=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;a<4&&i+.75*a<n;a++)o.push(r.charAt(c>>>6*(3-a)&63));var u=r.charAt(64);if(u)for(;o.length%4;)o.push(u);return o.join("")},parse:function(e){var t=e.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<n.length;i++)o[n.charCodeAt(i)]=i}var c=n.charAt(64);if(c){var a=e.indexOf(c);-1!==a&&(t=a)}return r(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),n.enc.Base64)}({get exports(){return Qo},set exports(e){Qo=e}});var ei=Qo,ti={};!function(e,t){e.exports=qo().enc.Hex}({get exports(){return ti},set exports(e){ti=e}});var ni=ti,ri="[object Boolean]";function oi(e){return!0===(t=e)||!1===t||oe(t)&&x(t)==ri;var t}function ii(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!lo(e))return"";if(!oi(t))return"";let n=Ko(e),r="";return r=t?n.toString(ei):n.toString(ni),r}let ci=function(e){if(!Ao(e))throw new Error("fn is not a function");return function(){let t=Gr(),n=null,r=null;try{n=e.apply(this,arguments)}catch(e){r=e}return null!==r?t.resolve({state:"error",msg:r}):!function(e){let t,n=Object.prototype.toString.call(e);if(t="[object Promise]"===n,t)return!0;if("[object Function]"!==n)return!1;try{t="function"!=typeof e.subscribe&&"function"==typeof e.then}catch(e){}return t}(n)?t.resolve({state:"success",msg:n}):n.then((e=>{t.resolve({state:"success",msg:e})})).catch((e=>{"cancelled"===Or(e,"reason")?t.resolve({state:"cancelled",msg:""}):t.resolve({state:"error",msg:e})})),t}};function ai(e){return e!=e}function ui(e,t){return!!(null==e?0:e.length)&&function(e,t,n){return t==t?function(e,t,n){for(var r=n-1,o=e.length;++r<o;)if(e[r]===t)return r;return-1}(e,t,n):function(e,t,n,r){for(var o=e.length,i=n+(r?1:-1);r?i--:++i<o;)if(t(e[i],i,e))return i;return-1}(e,ai,n)}(e,t,0)>-1}function si(e,t,n){for(var r=-1,o=null==e?0:e.length;++r<o;)if(n(t,e[r]))return!0;return!1}var li=ct&&1/Sn(new ct([,-0]))[1]==1/0?function(e){return new ct(e)}:function(){},fi=200;function pi(e,t){return e&&e.length?function(e,t,n){var r=-1,o=ui,i=e.length,c=!0,a=[],u=a;if(n)c=!1,o=si;else if(i>=fi){var s=t?null:li(e);if(s)return Sn(s);c=!1,o=wn,u=new bn}else u=t?[]:a;e:for(;++r<i;){var l=e[r],f=t?t(l):l;if(l=n||0!==l?l:0,c&&f==f){for(var p=u.length;p--;)if(u[p]===f)continue e;t&&u.push(f),a.push(l)}else o(u,f,n)||(u!==a&&u.push(f),a.push(l))}return a}(e,Pr(t)):[]}function di(e,t){return Jn(e,t)}function hi(e){let t=[],r=[];(e=fn(e)).port||(e.port=8080),e.apiName||(e.apiName="api"),e.routes||(e.routes=[]);let o=[];async function i(t){let n=Or(t,"token",""),r=await function(t){let n=Gr();return Ao(e.authenticate)?e.authenticate(t).then((function(e){n.resolve(e)})):n.resolve(!0),n}(n);if(r){let r=Or(t,"func",""),i=Or(t,"input");if("getFuncs"===r)Ao(e.filterFuncs)&&(o=await e.filterFuncs(n,o)),t.output={sys:"sys",funcs:o};else if(function(e,t){function n(e){return Po(e)?e:[e]}if(To(e))return!1;if(0===(e=n(e)).length)return!1;if(To(e))return!1;if(0===(t=n(t)).length)return!1;for(let n=0;n<e.length;n++)for(let r=0;r<t.length;r++)if(di(e[n],t[r]))return!0;return!1}(o,r)){let n=await e.funcs[r](i);t.output=n}else t.output={err:`can not find: ${r}`}}else t.output={err:`can not authenticate token: ${n}`};return delete t.input,JSON.stringify(t)}function c(t){if(Ao(e.onClientChange)){let n=pi(t,"clientId");di(r,n)||(r=n,e.onClientChange(r,e))}}Co(e,"funcs")&&(o=He(e.funcs));let a={path:"/"+e.apiName,method:"POST",options:{payload:{maxBytes:1048576e3,timeout:18e4,multipart:!0},timeout:{socket:3e5}},handler:function(e,n){let r=Gr(),o=ko(),a=Or(e.payload,"clientId"),u={headers:e.headers,info:e.info};return t.push({clientId:a,connId:o,data:u}),c(t),i(e.payload).then((function(e){r.resolve(e)})).catch((function(e){r.reject(e)})).finally((function(){t=t.filter((function(e){return e.connId!==o})),c(t)})),r}};e.serverHapi?e.serverHapi.route(a):async function(){let t=n.server({port:e.port,routes:{cors:!0}});t.route(a),gn(e.routes,(function(e){t.route(e)})),await t.start(),console.log(`Server running at: ${t.info.uri}`)}()}function yi(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Gr(),n=Or(e,"srcName","system by w-email"),o=Or(e,"srcEmail","");if(!No(o))return t.reject("srcEmail is not email"),t;let i=Or(e,"srcPW",""),c=Or(e,"srcHost","smtp.gmail.com"),a=Or(e,"srcPort",465),u=Or(e,"emTitle",""),s=Or(e,"emContent",""),l=Or(e,"emAttachments",[]);Oo(l)&&(l=[l]);let f=Or(e,"toEmails",[]);so(f)&&(f=[f]);let p=Or(e,"toEmailsCC",[]);so(p)&&(p=[p]);let d=Or(e,"toEmailsBCC",[]);so(d)&&(d=[d]);let h=r.createTransport({host:c,port:a,auth:{user:o,pass:i},secure:465===a}),y={from:`${n} <${o}>`,to:f.join(","),cc:p.join(","),bcc:d.join(","),subject:u,html:s,attachments:l};return h.sendMail(y,(function(e,n){e?t.reject(e):t.resolve(n.response)})),t}function vi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vi(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function mi(e){return e.format("YYYY-MM-DDTHH:mm:ssZ")}function bi(){return{state:"success",msg:arguments.length>0&&void 0!==arguments[0]?arguments[0]:null}}function ji(){return{state:"error",msg:arguments.length>0&&void 0!==arguments[0]?arguments[0]:null}}let wi="general",_i="yes",xi=["<",">"];return function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new e.EventEmitter;function o(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];setTimeout((()=>{r.emit(e,...n),r.emit("all",{eventName:e,data:[...n]})}),1)}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(){let n=Gr(),r=fn(arguments);function i(e){t&&o(t,{input:r,output:e})}return e.apply(this,arguments).then((function(e){i(e),n.resolve(e)})).catch((function(e){i(e),n.resolve(e)})),n}}if(n=fn(n),wo(n.port)||(n.port=8080),lo(n.apiName)||(n.apiName="api"),lo(n.authUrl)||(n.authUrl="http://localhost:8080/auth"),lo(n.salt)||(n.salt=""),wo(n.timeTokenExp)||(n.timeTokenExp=30),lo(n.webName)||(n.webName=""),lo(n.webUrl)||(n.webUrl=""),lo(n.webDescription)||(n.webDescription=""),lo(n.emSenderName)||(n.emSenderName="WUserServer"),!lo(n.emSenderEmail))return console.log("invalid emSenderEmail"),r;lo(n.emSenderPW)||(n.emSenderPW=""),lo(n.emBCC)||(n.emBCC=""),lo(n.emLetterHtml)||(n.emLetterHtml='<table style="width:100%;">\n<tbody>\n\n<tr style="display:none;">\n    <td>\n        {emMessage}\n    </td>\n</tr>\n\n<tr>\n    <td style="padding:30px; font-family:\'Microsoft JhengHei\'; background-color:#666; text-align:center;">\n        <a style="color:#aaffff; font-size:24pt; text-decoration:none;" href="{emWebUrl}" target="_blank">{emWebName}</a>\n        <p style="margin:10px 0px 0px 0px; color:#eee; font-size:12pt;">\n            {emWebDescription}\n        </p>\n    </td>\n</tr>\n\n<tr>\n    <td style="padding:20px; font-family:\'Microsoft JhengHei\';">\n        <p style="">{emMessage}</p>\n    </td>\n</tr>\n\n<tr>\n    <td style="padding:20px; font-family:\'Microsoft JhengHei\'; background-color:#f5f5f5; text-align:center;">\n        <p style="color:#f26; font-size:11pt;">【{emLetterDoNotReplayMessage}】</p>\n        <p style="">{emLetterTeamMessage}</p>\n        <p style="padding:1em 0px 0px 0px; color:#aaa;">{emLetterLinks}</p>\n    </td>\n</tr>\n\n</tbody>\n</table>'),lo(n.emLetterTeamMessage)||(n.emLetterTeamMessage="Global-User International Company"),lo(n.emLetterDoNotReplayMessage)||(n.emLetterDoNotReplayMessage="This letter is automatically sent by the system, please do not reply to this email."),Po(n.emLetterLinks)||(n.emLetterLinks=[]),lo(n.emSignUpTitle)||(n.emSignUpTitle="Verification letter"),lo(n.emSignUpHtml)||(n.emSignUpHtml='<p>Dear {name} :</p>\n\n<p>Your registration request has been received. Please click the link below to verify your account.</p>\n\n<p><a href="{urlCheckCode}" target="_blank">Confirm Account</a></p>'),lo(n.emResetPWTitle)||(n.emResetPWTitle="Password reset letter"),lo(n.emResetPWHtml)||(n.emResetPWHtml='<p>Dear {name} :</p>\n\n<p>You have received your change password request. Please click the link below to verify your account.</p>\n\n<p><a href="{urlCheckCode}" target="_blank">Confirm Account</a></p>'),lo(n.verifyWebHtml)||(n.verifyWebHtml='<!DOCTYPE html>\n<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-tw">\n\n    <head>\n        <meta http-equiv="content-type" content="text/html charset=UTF-8" />\n        <title>{rdWebName}</title>\n\n        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.slim.js"><\/script>\n\n    </head>\n\n    <body style="padding:0; margin:0;">\n    \n        <div style="display:flex; align-items:center; justify-content:center;">\n            \n            <div style="padding:30px; font-family:\'Microsoft JhengHei\';">\n            \n                <div style="margin:10px 0px 20px 0px; display:flex; align-items:center;">\n\n                    <div style="margin-right:10px;">\n                        {rdLogo}\n                    </div>\n\n                    <div style="margin:-5px 0px 0px 0px;">\n                        <div style="margin:0px 0px 0px 0px; font-size:12pt; color:#999;">Single Sign-On</div>\n                        <div style="margin:-3px 0px 0px 0px; font-size:24pt;">{rdWebName}</div>\n                    </div>\n\n                </div>\n    \n                <div style="padding:20px; text-align:center; background-color:#fee; border-radius:10px;">\n\n                    <div style="">{rdMessage}</div>\n    \n                    <div id="cd" style="margin:10px 0px 0px 0px; font-size:10pt; color:#999; display:none;"></div>\n\n                </div>\n                \n            </div>\n            \n        </div>\n        \n        <script>\n\n            function countdown() {\n                $(\'#cd\').show()\n                let n = 5\n                let tmp = \'{rdCountdownMessage}\'\n                $(\'#cd\').text(tmp.replace(\'{s}\', n))\n                setInterval(function() {\n                    n -= 1\n                    if (n<=0) {\n                        window.location.href = \'{rdWebUrl}\'\n                    }\n                    $(\'#cd\').text(tmp.replace(\'{s}\', n))\n                }, 1000)\n            }\n            if ({rdCountdown}) {\n                countdown()\n            }\n\n        <\/script>\n\n    </body>\n\n</html>'),lo(n.verifyWebLogo)||(n.verifyWebLogo='<svg width="64" height="64" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><defs><style>.cls-1{fill:#c8da52;}.cls-2{fill:#995f5b;}</style></defs><title/><path class="cls-1" d="M23.85,38.78c9.63-2,15,2.07,16.22,8.17S38,58.88,28.4,60.86,5.33,54.71,5.21,54.13,14.23,40.76,23.85,38.78Z"/><path class="cls-1" d="M45.72,18.87C51.31,27,49.66,33.45,44.54,37s-11.78,2.78-17.36-5.3S23.83,8,24.31,7.7,40.14,10.78,45.72,18.87Z"/><path class="cls-1" d="M72.6,31.21c-5.26,8.3-11.88,9.33-17.14,6s-7.16-9.75-1.9-18.05,20.45-12.32,21-12S77.86,22.91,72.6,31.21Z"/><path class="cls-1" d="M71.73,60.78c-9.69-1.6-13.22-7.3-12.21-13.44s6.19-10.4,15.88-8.8,19.33,14,19.24,14.59S81.43,62.38,71.73,60.78Z"/><path class="cls-2" d="M57.46,43.08a1,1,0,0,0-1.41-1.41l-6.22,6.21-6.21-6.21a1,1,0,0,0-1.41,1.41l6.62,6.63v5.08l-5.21-5.21A1,1,0,1,0,42.21,51l6.62,6.63V93.78a1,1,0,0,0,2,0V57.62L57.46,51a1,1,0,0,0-1.41-1.41l-5.22,5.21V49.71Z"/><path class="cls-2" d="M75.86,78.39a1,1,0,0,0-1,1V93.78a1,1,0,0,0,2,0V79.39A1,1,0,0,0,75.86,78.39Z"/><path class="cls-1" d="M65.37,77.4c3.88-.8,6,.83,6.53,3.28s-.83,4.8-4.7,5.6-9.28-2.48-9.32-2.71S61.5,78.2,65.37,77.4Z"/><path class="cls-1" d="M74.17,69.39c2.25,3.25,1.58,5.86-.48,7.29s-4.73,1.11-7-2.14S65.36,65,65.56,64.9,71.92,66.14,74.17,69.39Z"/><path class="cls-1" d="M85,74.35c-2.11,3.34-4.78,3.75-6.89,2.41s-2.88-3.92-.77-7.26,8.23-5,8.43-4.83S87.1,71,85,74.35Z"/><path class="cls-1" d="M84.63,86.25c-3.9-.65-5.32-2.94-4.91-5.41s2.49-4.18,6.39-3.54,7.78,5.64,7.74,5.87S88.53,86.89,84.63,86.25Z"/></svg>'),lo(n.verifyWebMsgSuccess)||(n.verifyWebMsgSuccess="Verify successfully"),lo(n.verifyWebMsgExpired)||(n.verifyWebMsgExpired="Code has expired"),lo(n.verifyWebMsgCount)||(n.verifyWebMsgCount="Go to the website automatically after {s} seconds..."),Oo(n.funcs)||(n.funcs={}),Po(n.routes)||(n.routes=[]);let c=Ao(Or(n,"orm.select",null)),a=Ao(Or(n,"orm.insert",null)),u=Ao(Or(n,"orm.save",null));if(!c||!a||!u)return console.log("invalid orm"),r;let s=n.orm,l={id:{type:"String",public:!0,necessary:!0,exclude:[],canModify:!1},name:{type:"String",public:!0,necessary:!1,exclude:xi,canModify:!0},pwEnc:{type:"String",public:!1,necessary:!0,exclude:[],canModify:!1},email:{type:"String",public:!0,necessary:!0,exclude:xi,canModify:!0},address:{type:"String",public:!0,necessary:!1,exclude:xi,canModify:!0},phone:{type:"String",public:!0,necessary:!1,exclude:xi,canModify:!0},organization:{type:"String",public:!0,necessary:!1,exclude:xi,canModify:!0},position:{type:"String",public:!0,necessary:!1,exclude:xi,canModify:!0},role:{type:"String",public:!0,necessary:!0,exclude:xi,canModify:!1},checkCode:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},token:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},tokenExp:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},timeCreate:{type:"String",public:!1,necessary:!0,exclude:[],canModify:!1},timeLogin:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},remark:{type:"String",public:!0,necessary:!1,exclude:[],canModify:!0},active:{type:"String",public:!1,necessary:!0,exclude:[],canModify:!1}},f=ci(s.save);function p(e){return gn(e,(function(e,t){let n=function(e,t){if(Co(l,e)){let n=l[e].type,r=l[e].exclude;return"String"===n?so(t)?Wo(t,r)?ji('can not contain special characters: "<" or ">"'):bi():ji("value is not string: "+t):"Object"===n?Oo(t)?bi():ji("value is not object: "+t):ji("type is not defined: "+n)}return ji("invalid key: "+e)}(t,e);if("error"===n.state)return n})),bi()}let d=ci((async function(e){let{token:t,find:n}=e,r=Gr(),o=null;return o=await k(t),"error"===o.state?(r.reject(o.msg),r):(s.select(n).then((function(e){if(e.length>=1){let t=e,n=[];gn(l,(function(e,t){e.public&&n.push(t)})),t=Wr(t,(function(e){return qr(e,n)})),r.resolve(t)}else r.reject("can not find user")})).catch((function(e){console.log("selectPublic catch:",e,"find:",n),r.reject("error")})),r)})),h=ci((async function(e){let t=Gr(),r=null;return lo(e.pwEnc)?No(e.email)?await function(e){let t=Gr();if(!So(e))return t.reject("invalid find"),t;return s.select(e).then((function(e){e.length>=1?t.resolve(!0):t.resolve(!1)})).catch((function(n){console.log("select catch:",n,"find:",e),t.reject("error")})),t}({email:e.email})?(t.reject("email has been used"),t):(r=p(e),"error"===r.state?(t.reject(r.msg),t):(o=e,gn(l,(function(e,t){let n="";"Object"===e.type&&(n={}),Co(o,t)&&null!==o[t]&&void 0!==o[t]||(o[t]=n)})),(e=o).id=ko(),""!==n.salt&&(e.pwEnc=ii(e.pwEnc+n.salt)),e.checkCode=ko(),e.timeCreate=Eo(),e.role=wi,e.active=_i,s.insert(e).then((function(n){t.resolve({id:e.id,checkCode:e.checkCode})})).catch((function(n){console.log("insert catch:",n,"user:",e),t.reject("error")})),t)):(t.reject("invalid email"),t):(t.reject("invalid password"),t);var o}));function y(e){let t=Gr();return s.select(e).then((function(e){1===e.length?t.resolve(e[0]):e.length>1?t.reject(`find ${e.length} users`):t.reject("can not find user")})).catch((function(n){console.log("selectOne catch:",n,"find:",e),t.reject("error")})),t}let v=ci(y),g=ci((async function(e){let t=Gr(),r=null;if(r=await h(e),"error"===r.state)return t.reject(r.msg),t;let o=r.msg.id;e.id=o;let i=r.msg.checkCode;e.checkCode=i;let c=`${n.authUrl}?checkCode=${i}`;return r=await E(e.name,c,e.email),"error"===r.state?(console.log("signUp catch:",r.msg,"emailObj:",{name:e.name,urlCheckCode:c,email:e.email}),t.reject("can not send email"),t):(t.resolve(e.id),t)})),m=ci((async function(e){let{email:r,pwEnc:o}=e,i=Gr(),c=null;if(!lo(r))return i.reject("invalid email"),i;if(!lo(o))return i.reject("invalid password"),i;let a={email:r};if(c=await v(a),"error"===c.state)return console.log("logIn catch:",c.msg,"find:",a),i.reject("email or password is incorrect"),i;let u=c.msg;if(""!==u.checkCode)return i.reject("account is not verified"),i;if(""!==n.salt&&(o=ii(o+n.salt)),u.pwEnc!==o)return i.reject("email or password is incorrect"),i;if(u.active!==_i)return i.reject("account is suspended"),i;if(c=await k(u.token),"success"===c.state)return i.resolve(u.token),i;let s=ko(),l={id:u.id,token:s,tokenExp:mi(t().add(n.timeTokenExp,"minute")),timeLogin:Eo()};return c=await f(l),"error"===c.state?(console.log("logIn catch:",c.msg,"userModify:",l),i.reject("can not save token"),i):(i.resolve(s),i)})),b=ci((async function(e){let t=Gr(),n=null;if(!lo(e))return t.reject("invalid token"),t;let r={token:e};if(n=await v(r),"error"===n.state)return console.log("logOut catch:",n.msg,"find:",r),t.reject("invalid token"),t;let o={id:n.msg.id,token:"",tokenExp:""};return n=await f(o),"error"===n.state?(console.log("logOut catch:",n.msg,"userModify:",o),t.reject("can not update token"),t):(t.resolve("ok"),t)}));function j(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"false",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=n.verifyWebHtml;return o=Mo(o,{"{rdWebName}":n.webName,"{rdWebDescription}":n.webDescription,"{rdWebUrl}":n.webUrl,"{rdLogo}":n.verifyWebLogo,"{rdMessage}":e,"{rdCountdown}":t,"{rdCountdownMessage}":r}),o}function w(e){let t=Gr(),r=n.verifyWebMsgCount;return function(e){let t=Gr();if(!lo(e))return t.reject(n.verifyWebMsgExpired),t;let r={checkCode:e};return y(r).then((function(e){let t={id:e.id,checkCode:""};return s.save(t)})).then((function(e){t.resolve(n.verifyWebMsgSuccess)})).catch((function(e){console.log("verifyCheckCode catch:",e,"find:",r),t.reject(n.verifyWebMsgExpired)})),t}(e).then((function(n){o("verifyCheckCodeAndGetHtml",{state:"success",msg:n,checkCode:e}),t.resolve(j(n,"true",r))})).catch((function(n){o("verifyCheckCodeAndGetHtml",{state:"error",msg:n,checkCode:e}),t.resolve(j(n,"false",""))})),t}function _(e){let r=Gr();if(function(e){if(!lo(e))return!1;if(!Do.checkTZ(e))return!1;let n=Do.delTZ(e),r="YYYY-MM-DDTHH:mm:ss";return n===t(n,r).format(r)}(e)){let o=t(),i=t(e,"YYYY-MM-DDTHH:mm:ssZ").diff(o,"minute");i>0?r.resolve("ok"):i>n.timeTokenExp?(console.log("verifyTokenExp error:","iMinutes="+i,">","timeTokenExp="+n.timeTokenExp),r.reject("invalid tokenExp")):r.reject("token expired")}else r.reject("no expire time for token");return r}let x=ci(_),k=ci((async function(e){let t=Gr(),n=null;if(!lo(e))return t.reject("invalid token"),t;let r={token:e};if(n=await v(r),"error"===n.state)return console.log("isValidToken catch:",n.msg,"find:",r),t.reject("invalid token"),t;let o=n.msg;return n=x(o.tokenExp),"error"===n.state?(t.reject(n.msg),t):(t.resolve("ok"),t)})),O=ci((async function(e){let r=Gr(),o=null;if(!lo(e))return r.reject("invalid token"),r;let i={token:e};if(o=await v(i),"error"===o.state)return console.log("refreshTokenExp catch:",o.msg,"find:",i),r.reject("invalid token"),r;let c=o.msg;if(o=_(c.tokenExp),"error"===o.state)return r.reject(o.err),r;let a={id:c.id,tokenExp:mi(t().add(n.timeTokenExp,"minute"))};return o=await f(a),"error"===o.state?(console.log("refreshTokenExp catch:",o.msg,"userModify:",a),r.reject("can not update token"),r):(r.resolve("ok"),r)})),S=ci((async function(e){let{email:t,pwEnc:r,pwEncNew:o}=e,i=Gr(),c=null;if(!lo(t))return i.reject("invalid email"),i;if(!lo(r))return i.reject("invalid old password"),i;if(!lo(o))return i.reject("invalid new password"),i;let a={email:t};if(c=await v(a),"error"===c.state)return console.log("changePW catch:",c.msg,"find:",a),i.reject("email or password is incorrect"),i;let u=c.msg;if(""!==u.checkCode)return i.reject("account is not verified"),i;if(u.active!==_i)return i.reject("account is suspended"),i;if(""!==n.salt&&(r=ii(r+n.salt),o=ii(o+n.salt)),u.pwEnc!==r)return i.reject("email or password is incorrect"),i;let s={id:u.id,pwEnc:o};return c=await f(s),"error"===c.state?(console.log("changePW catch:",c.msg,"userModify:",s),i.reject("can not update password"),i):(i.resolve("ok"),i)})),M=ci((async function(e){let{email:t,pwEncNew:r}=e,o=Gr(),i=null;if(!lo(t))return o.reject("invalid email"),o;if(!lo(r))return o.reject("invalid new password"),o;let c={email:t};if(i=await v(c),"error"===i.state)return console.log("resetPW catch:",i.msg,"find:",c),o.reject("email is incorrect"),o;let a=i.msg;if(a.active!==_i)return o.reject("account is suspended"),o;""!==n.salt&&(r=ii(r+n.salt));let u=ko(),s={id:a.id,pwEnc:r,checkCode:u};if(i=await f(s),"error"===i.state)return console.log("resetPW catch:",i.msg,"userModify:",s),o.reject("can not update password"),o;let l=`${n.authUrl}?checkCode=${u}`;return i=await P(a.name,l,a.email),"error"===i.state?(console.log("resetPW catch:",i.msg,"emailObj:",{name:a.name,urlCheckCode:l,email:a.email}),o.reject("can not send email"),o):(o.resolve("ok"),o)})),C=ci((async function(e){let{token:t,user:n}=e,r=Gr(),o=null;if(o=await k(t),"error"===o.state)return r.reject(o.msg),r;if(o=p(n),"error"===o.state)return r.reject(o.msg),r;let i=await async function(e){let t=Gr(),n=null,r={token:e};if(n=await v(r),"error"===n.state)return console.log("getUserFromToken catch:",n.msg,"find:",r),t.reject("invalid token"),t;let o=n.msg;return t.resolve(o),t}(t),c={id:i.id},a=!1;return gn(l,(function(e,t){e.canModify&&n[t]&&i[t]!==n[t]&&(a=!0,c[t]=n[t])})),a?(o=await f(c),"error"===o.state?(console.log("modifyInfor catch:",o.msg,"userModify:",c),r.reject("can not modify"),r):(r.resolve("ok"),r)):(r.resolve("no change"),r)}));function A(e,t,r,o,i){let c=n.emLetterHtml,a=n.webName,u=n.webUrl,s=n.emLetterLinks;var l,f;return""!==a&&""!==u&&(s=function(){var e=arguments.length;if(!e)return[];for(var t=Array(e-1),n=arguments[0],r=e;r--;)t[r-1]=arguments[r];return Xe(fe(n)?Ze(n):[n],zr(t,1))}({name:a,url:u},s)),s=Wr(s,(function(e){let t=Or(e,"name","");return`<a style="text-decoration:none" href="${Or(e,"url","")}" target="_blank" >${t}</a>`})),s=`| ${l=s,f=" | ",null==l?"":Hr.call(l,f)} |`,c=Mo(c,{"{emMessage}":t,"{emWebName}":a,"{emWebUrl}":u,"{emWebDescription}":n.webDescription,"{emLetterDoNotReplayMessage}":n.emLetterDoNotReplayMessage,"{emLetterTeamMessage}":n.emLetterTeamMessage,"{emLetterLinks}":s}),function(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return new yi({srcName:n.emSenderName,srcEmail:n.emSenderEmail,srcPW:n.emSenderPW,emTitle:e,emContent:t,toEmails:r,toEmailsCC:o,toEmailsBCC:i})}(e,c,r,o,i)}let E=ci((function(e,t,r){let o=n.emSignUpTitle,i=n.emSignUpHtml;return i=Mo(i,{"{name}":e,"{urlCheckCode}":t}),A(o,i,r,[],n.emBCC)})),P=ci((function(e,t,r){let o=n.emResetPWTitle,i=n.emResetPWHtml;return i=Mo(i,{"{name}":e,"{urlCheckCode}":t}),A(o,i,r,[],n.emBCC)})),T={select:function(e){return i(d,"selectPublic")(e)},signUp:function(e){return i(g,"signUp")(e)},logIn:function(e){return i(m,"logIn")(e)},refreshTokenExp:function(e){return i(O,"refreshTokenExp")(e)},isValidToken:function(e){return i(k,"isValidToken")(e)},logOut:function(e){return i(b,"logOut")(e)},changePW:function(e){return i(S,"changePW")(e)},resetPW:function(e){return i(M,"resetPW")(e)},modifyInfor:function(e){return i(C,"modifyInfor")(e)}};gn(n.funcs,(function(e,t){Co(T,t)?console.log("invalid func: "+t):T[t]=n.funcs[t]}));let W=[{method:"GET",path:"/auth",handler:async function(e,t){return w(e.query.checkCode)}}];return gn(n.routes,(function(e){W.push(e)})),n=gi(gi({},n),{},{onClientChange:function(e,t){o("clientChange",e.length,e)},funcs:T,routes:W}),new hi(n),r}}));
//# sourceMappingURL=w-user-server.umd.js.map
