/*!
 * w-user-server v1.0.23
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("events"),require("dayjs"),require("@hapi/hapi"),require("nodemailer")):"function"==typeof define&&define.amd?define(["events","dayjs","@hapi/hapi","nodemailer"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["w-user-server"]=t(e.events,e.dayjs,e["@hapi/hapi"],e.nodemailer)}(this,(function(e,t,r,n){"use strict";function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e){var t=function(e,t){if("object"!==o(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===o(t)?t:String(t)}function a(e,t,r){return(t=i(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function s(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){if(this instanceof e){var r=[null];return r.push.apply(r,arguments),new(Function.bind.apply(t,r))}return t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),r}var l=function(){this.__data__=[],this.size=0};var f=function(e,t){return e===t||e!=e&&t!=t},p=f;var d=function(e,t){for(var r=e.length;r--;)if(p(e[r][0],t))return r;return-1},v=d,h=Array.prototype.splice;var y=d;var g=d;var m=d;var b=l,j=function(e){var t=this.__data__,r=v(t,e);return!(r<0)&&(r==t.length-1?t.pop():h.call(t,r,1),--this.size,!0)},w=function(e){var t=this.__data__,r=y(t,e);return r<0?void 0:t[r][1]},_=function(e){return g(this.__data__,e)>-1},x=function(e,t){var r=this.__data__,n=m(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};function O(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}O.prototype.clear=b,O.prototype.delete=j,O.prototype.get=w,O.prototype.has=_,O.prototype.set=x;var k=O,S=k;var M=function(){this.__data__=new S,this.size=0};var C=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r};var A=function(e){return this.__data__.get(e)};var E=function(e){return this.__data__.has(e)},P="object"==typeof c&&c&&c.Object===Object&&c,T=P,W="object"==typeof self&&self&&self.Object===Object&&self,B=T||W||Function("return this")(),U=B.Symbol,z=U,H=Object.prototype,N=H.hasOwnProperty,D=H.toString,L=z?z.toStringTag:void 0;var I=function(e){var t=N.call(e,L),r=e[L];try{e[L]=void 0;var n=!0}catch(e){}var o=D.call(e);return n&&(t?e[L]=r:delete e[L]),o},$=Object.prototype.toString;var F=I,R=function(e){return $.call(e)},Z=U?U.toStringTag:void 0;var Y=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Z&&Z in Object(e)?F(e):R(e)};var V=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},q=Y,G=V;var J,X=function(e){if(!G(e))return!1;var t=q(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},K=B["__core-js_shared__"],Q=(J=/[^.]+$/.exec(K&&K.keys&&K.keys.IE_PROTO||""))?"Symbol(src)_1."+J:"";var ee=function(e){return!!Q&&Q in e},te=Function.prototype.toString;var re=function(e){if(null!=e){try{return te.call(e)}catch(e){}try{return e+""}catch(e){}}return""},ne=X,oe=ee,ie=V,ae=re,ce=/^\[object .+?Constructor\]$/,ue=Function.prototype,se=Object.prototype,le=ue.toString,fe=se.hasOwnProperty,pe=RegExp("^"+le.call(fe).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var de=function(e){return!(!ie(e)||oe(e))&&(ne(e)?pe:ce).test(ae(e))},ve=function(e,t){return null==e?void 0:e[t]};var he=function(e,t){var r=ve(e,t);return de(r)?r:void 0},ye=he(B,"Map"),ge=he(Object,"create"),me=ge;var be=function(){this.__data__=me?me(null):{},this.size=0};var je=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},we=ge,_e=Object.prototype.hasOwnProperty;var xe=function(e){var t=this.__data__;if(we){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return _e.call(t,e)?t[e]:void 0},Oe=ge,ke=Object.prototype.hasOwnProperty;var Se=ge;var Me=be,Ce=je,Ae=xe,Ee=function(e){var t=this.__data__;return Oe?void 0!==t[e]:ke.call(t,e)},Pe=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Se&&void 0===t?"__lodash_hash_undefined__":t,this};function Te(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Te.prototype.clear=Me,Te.prototype.delete=Ce,Te.prototype.get=Ae,Te.prototype.has=Ee,Te.prototype.set=Pe;var We=Te,Be=k,Ue=ye;var ze=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var He=function(e,t){var r=e.__data__;return ze(t)?r["string"==typeof t?"string":"hash"]:r.map},Ne=He;var De=He;var Le=He;var Ie=He;var $e=function(){this.size=0,this.__data__={hash:new We,map:new(Ue||Be),string:new We}},Fe=function(e){var t=Ne(this,e).delete(e);return this.size-=t?1:0,t},Re=function(e){return De(this,e).get(e)},Ze=function(e){return Le(this,e).has(e)},Ye=function(e,t){var r=Ie(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this};function Ve(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ve.prototype.clear=$e,Ve.prototype.delete=Fe,Ve.prototype.get=Re,Ve.prototype.has=Ze,Ve.prototype.set=Ye;var qe=Ve,Ge=k,Je=ye,Xe=qe;var Ke=k,Qe=M,et=C,tt=A,rt=E,nt=function(e,t){var r=this.__data__;if(r instanceof Ge){var n=r.__data__;if(!Je||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Xe(n)}return r.set(e,t),this.size=r.size,this};function ot(e){var t=this.__data__=new Ke(e);this.size=t.size}ot.prototype.clear=Qe,ot.prototype.delete=et,ot.prototype.get=tt,ot.prototype.has=rt,ot.prototype.set=nt;var it=ot;var at=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e},ct=he,ut=function(){try{var e=ct(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),st=ut;var lt=function(e,t,r){"__proto__"==t&&st?st(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r},ft=lt,pt=f,dt=Object.prototype.hasOwnProperty;var vt=function(e,t,r){var n=e[t];dt.call(e,t)&&pt(n,r)&&(void 0!==r||t in e)||ft(e,t,r)},ht=vt,yt=lt;var gt=function(e,t,r,n){var o=!r;r||(r={});for(var i=-1,a=t.length;++i<a;){var c=t[i],u=n?n(r[c],e[c],c,r,e):void 0;void 0===u&&(u=e[c]),o?yt(r,c,u):ht(r,c,u)}return r};var mt=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n};var bt=function(e){return null!=e&&"object"==typeof e},jt=Y,wt=bt;var _t=function(e){return wt(e)&&"[object Arguments]"==jt(e)},xt=bt,Ot=Object.prototype,kt=Ot.hasOwnProperty,St=Ot.propertyIsEnumerable,Mt=_t(function(){return arguments}())?_t:function(e){return xt(e)&&kt.call(e,"callee")&&!St.call(e,"callee")},Ct=Mt,At=Array.isArray,Et={};var Pt=function(){return!1};!function(e,t){var r=B,n=Pt,o=t&&!t.nodeType&&t,i=o&&e&&!e.nodeType&&e,a=i&&i.exports===o?r.Buffer:void 0,c=(a?a.isBuffer:void 0)||n;e.exports=c}({get exports(){return Et},set exports(e){Et=e}},Et);var Tt=/^(?:0|[1-9]\d*)$/;var Wt=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&Tt.test(e))&&e>-1&&e%1==0&&e<t};var Bt=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Ut=Y,zt=Bt,Ht=bt,Nt={};Nt["[object Float32Array]"]=Nt["[object Float64Array]"]=Nt["[object Int8Array]"]=Nt["[object Int16Array]"]=Nt["[object Int32Array]"]=Nt["[object Uint8Array]"]=Nt["[object Uint8ClampedArray]"]=Nt["[object Uint16Array]"]=Nt["[object Uint32Array]"]=!0,Nt["[object Arguments]"]=Nt["[object Array]"]=Nt["[object ArrayBuffer]"]=Nt["[object Boolean]"]=Nt["[object DataView]"]=Nt["[object Date]"]=Nt["[object Error]"]=Nt["[object Function]"]=Nt["[object Map]"]=Nt["[object Number]"]=Nt["[object Object]"]=Nt["[object RegExp]"]=Nt["[object Set]"]=Nt["[object String]"]=Nt["[object WeakMap]"]=!1;var Dt=function(e){return Ht(e)&&zt(e.length)&&!!Nt[Ut(e)]};var Lt=function(e){return function(t){return e(t)}},It={};!function(e,t){var r=P,n=t&&!t.nodeType&&t,o=n&&e&&!e.nodeType&&e,i=o&&o.exports===n&&r.process,a=function(){try{var e=o&&o.require&&o.require("util").types;return e||i&&i.binding&&i.binding("util")}catch(e){}}();e.exports=a}({get exports(){return It},set exports(e){It=e}},It);var $t=Dt,Ft=Lt,Rt=It&&It.isTypedArray,Zt=Rt?Ft(Rt):$t,Yt=mt,Vt=Ct,qt=At,Gt=Et,Jt=Wt,Xt=Zt,Kt=Object.prototype.hasOwnProperty;var Qt=function(e,t){var r=qt(e),n=!r&&Vt(e),o=!r&&!n&&Gt(e),i=!r&&!n&&!o&&Xt(e),a=r||n||o||i,c=a?Yt(e.length,String):[],u=c.length;for(var s in e)!t&&!Kt.call(e,s)||a&&("length"==s||o&&("offset"==s||"parent"==s)||i&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||Jt(s,u))||c.push(s);return c},er=Object.prototype;var tr=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||er)};var rr=function(e,t){return function(r){return e(t(r))}},nr=rr(Object.keys,Object),or=tr,ir=nr,ar=Object.prototype.hasOwnProperty;var cr=X,ur=Bt;var sr=function(e){return null!=e&&ur(e.length)&&!cr(e)},lr=Qt,fr=function(e){if(!or(e))return ir(e);var t=[];for(var r in Object(e))ar.call(e,r)&&"constructor"!=r&&t.push(r);return t},pr=sr;var dr=function(e){return pr(e)?lr(e):fr(e)},vr=gt,hr=dr;var yr=function(e,t){return e&&vr(t,hr(t),e)};var gr=V,mr=tr,br=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t},jr=Object.prototype.hasOwnProperty;var wr=Qt,_r=function(e){if(!gr(e))return br(e);var t=mr(e),r=[];for(var n in e)("constructor"!=n||!t&&jr.call(e,n))&&r.push(n);return r},xr=sr;var Or=function(e){return xr(e)?wr(e,!0):_r(e)},kr=gt,Sr=Or;var Mr=function(e,t){return e&&kr(t,Sr(t),e)},Cr={};!function(e,t){var r=B,n=t&&!t.nodeType&&t,o=n&&e&&!e.nodeType&&e,i=o&&o.exports===n?r.Buffer:void 0,a=i?i.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=a?a(r):new e.constructor(r);return e.copy(n),n}}({get exports(){return Cr},set exports(e){Cr=e}},Cr);var Ar=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t};var Er=function(){return[]},Pr=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,i=[];++r<n;){var a=e[r];t(a,r,e)&&(i[o++]=a)}return i},Tr=Er,Wr=Object.prototype.propertyIsEnumerable,Br=Object.getOwnPropertySymbols,Ur=Br?function(e){return null==e?[]:(e=Object(e),Pr(Br(e),(function(t){return Wr.call(e,t)})))}:Tr,zr=gt,Hr=Ur;var Nr=function(e,t){return zr(e,Hr(e),t)};var Dr=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e},Lr=rr(Object.getPrototypeOf,Object),Ir=Dr,$r=Lr,Fr=Ur,Rr=Er,Zr=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Ir(t,Fr(e)),e=$r(e);return t}:Rr,Yr=gt,Vr=Zr;var qr=function(e,t){return Yr(e,Vr(e),t)},Gr=Dr,Jr=At;var Xr=function(e,t,r){var n=t(e);return Jr(e)?n:Gr(n,r(e))},Kr=Xr,Qr=Ur,en=dr;var tn=function(e){return Kr(e,en,Qr)},rn=Xr,nn=Zr,on=Or;var an=function(e){return rn(e,on,nn)},cn=he(B,"DataView"),un=he(B,"Promise"),sn=he(B,"Set"),ln=cn,fn=ye,pn=un,dn=sn,vn=he(B,"WeakMap"),hn=Y,yn=re,gn="[object Map]",mn="[object Promise]",bn="[object Set]",jn="[object WeakMap]",wn="[object DataView]",_n=yn(ln),xn=yn(fn),On=yn(pn),kn=yn(dn),Sn=yn(vn),Mn=hn;(ln&&Mn(new ln(new ArrayBuffer(1)))!=wn||fn&&Mn(new fn)!=gn||pn&&Mn(pn.resolve())!=mn||dn&&Mn(new dn)!=bn||vn&&Mn(new vn)!=jn)&&(Mn=function(e){var t=hn(e),r="[object Object]"==t?e.constructor:void 0,n=r?yn(r):"";if(n)switch(n){case _n:return wn;case xn:return gn;case On:return mn;case kn:return bn;case Sn:return jn}return t});var Cn=Mn,An=Object.prototype.hasOwnProperty;var En=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&An.call(e,"index")&&(r.index=e.index,r.input=e.input),r},Pn=B.Uint8Array,Tn=Pn;var Wn=function(e){var t=new e.constructor(e.byteLength);return new Tn(t).set(new Tn(e)),t},Bn=Wn;var Un=function(e,t){var r=t?Bn(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)},zn=/\w*$/;var Hn=function(e){var t=new e.constructor(e.source,zn.exec(e));return t.lastIndex=e.lastIndex,t},Nn=U?U.prototype:void 0,Dn=Nn?Nn.valueOf:void 0;var Ln=Wn;var In=Wn,$n=Un,Fn=Hn,Rn=function(e){return Dn?Object(Dn.call(e)):{}},Zn=function(e,t){var r=t?Ln(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)};var Yn=function(e,t,r){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return In(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return $n(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Zn(e,r);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return Fn(e);case"[object Symbol]":return Rn(e)}},Vn=V,qn=Object.create,Gn=function(){function e(){}return function(t){if(!Vn(t))return{};if(qn)return qn(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),Jn=Lr,Xn=tr;var Kn=function(e){return"function"!=typeof e.constructor||Xn(e)?{}:Gn(Jn(e))},Qn=Cn,eo=bt;var to=function(e){return eo(e)&&"[object Map]"==Qn(e)},ro=Lt,no=It&&It.isMap,oo=no?ro(no):to,io=Cn,ao=bt;var co=function(e){return ao(e)&&"[object Set]"==io(e)},uo=Lt,so=It&&It.isSet,lo=so?uo(so):co,fo=it,po=at,vo=vt,ho=yr,yo=Mr,go=Cr,mo=Ar,bo=Nr,jo=qr,wo=tn,_o=an,xo=Cn,Oo=En,ko=Yn,So=Kn,Mo=At,Co=Et,Ao=oo,Eo=V,Po=lo,To=dr,Wo=Or,Bo="[object Arguments]",Uo="[object Function]",zo="[object Object]",Ho={};Ho[Bo]=Ho["[object Array]"]=Ho["[object ArrayBuffer]"]=Ho["[object DataView]"]=Ho["[object Boolean]"]=Ho["[object Date]"]=Ho["[object Float32Array]"]=Ho["[object Float64Array]"]=Ho["[object Int8Array]"]=Ho["[object Int16Array]"]=Ho["[object Int32Array]"]=Ho["[object Map]"]=Ho["[object Number]"]=Ho[zo]=Ho["[object RegExp]"]=Ho["[object Set]"]=Ho["[object String]"]=Ho["[object Symbol]"]=Ho["[object Uint8Array]"]=Ho["[object Uint8ClampedArray]"]=Ho["[object Uint16Array]"]=Ho["[object Uint32Array]"]=!0,Ho["[object Error]"]=Ho[Uo]=Ho["[object WeakMap]"]=!1;var No=function e(t,r,n,o,i,a){var c,u=1&r,s=2&r,l=4&r;if(n&&(c=i?n(t,o,i,a):n(t)),void 0!==c)return c;if(!Eo(t))return t;var f=Mo(t);if(f){if(c=Oo(t),!u)return mo(t,c)}else{var p=xo(t),d=p==Uo||"[object GeneratorFunction]"==p;if(Co(t))return go(t,u);if(p==zo||p==Bo||d&&!i){if(c=s||d?{}:So(t),!u)return s?jo(t,yo(c,t)):bo(t,ho(c,t))}else{if(!Ho[p])return i?t:{};c=ko(t,p,u)}}a||(a=new fo);var v=a.get(t);if(v)return v;a.set(t,c),Po(t)?t.forEach((function(o){c.add(e(o,r,n,o,t,a))})):Ao(t)&&t.forEach((function(o,i){c.set(i,e(o,r,n,i,t,a))}));var h=f?void 0:(l?s?_o:wo:s?Wo:To)(t);return po(h||t,(function(o,i){h&&(o=t[i=o]),vo(c,i,e(o,r,n,i,t,a))})),c},Do=No;var Lo=function(e){return Do(e,5)},Io={},$o={get exports(){return Io},set exports(e){Io=e}};var Fo=function(e){return function(t,r,n){for(var o=-1,i=Object(t),a=n(t),c=a.length;c--;){var u=a[e?c:++o];if(!1===r(i[u],u,i))break}return t}}(),Ro=dr;var Zo=sr;var Yo=function(e,t){return function(r,n){if(null==r)return r;if(!Zo(r))return e(r,n);for(var o=r.length,i=t?o:-1,a=Object(r);(t?i--:++i<o)&&!1!==n(a[i],i,a););return r}}((function(e,t){return e&&Fo(e,t,Ro)}));var Vo=function(e){return e},qo=Vo;var Go=at,Jo=Yo,Xo=function(e){return"function"==typeof e?e:qo},Ko=At;var Qo=function(e,t){return(Ko(e)?Go:Jo)(e,Xo(t))};!function(e){e.exports=Qo}($o);var ei=u(Io);var ti=function(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o};var ri=qe,ni=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},oi=function(e){return this.__data__.has(e)};function ii(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new ri;++t<r;)this.add(e[t])}ii.prototype.add=ii.prototype.push=ni,ii.prototype.has=oi;var ai=ii;var ci=function(e,t){return e.has(t)},ui=ai,si=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1},li=ci;var fi=function(e,t,r,n,o,i){var a=1&r,c=e.length,u=t.length;if(c!=u&&!(a&&u>c))return!1;var s=i.get(e),l=i.get(t);if(s&&l)return s==t&&l==e;var f=-1,p=!0,d=2&r?new ui:void 0;for(i.set(e,t),i.set(t,e);++f<c;){var v=e[f],h=t[f];if(n)var y=a?n(h,v,f,t,e,i):n(v,h,f,e,t,i);if(void 0!==y){if(y)continue;p=!1;break}if(d){if(!si(t,(function(e,t){if(!li(d,t)&&(v===e||o(v,e,r,n,i)))return d.push(t)}))){p=!1;break}}else if(v!==h&&!o(v,h,r,n,i)){p=!1;break}}return i.delete(e),i.delete(t),p};var pi=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e,n){r[++t]=[n,e]})),r};var di=function(e){var t=-1,r=Array(e.size);return e.forEach((function(e){r[++t]=e})),r},vi=Pn,hi=f,yi=fi,gi=pi,mi=di,bi=U?U.prototype:void 0,ji=bi?bi.valueOf:void 0;var wi=function(e,t,r,n,o,i,a){switch(r){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!i(new vi(e),new vi(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return hi(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var c=gi;case"[object Set]":var u=1&n;if(c||(c=mi),e.size!=t.size&&!u)return!1;var s=a.get(e);if(s)return s==t;n|=2,a.set(e,t);var l=yi(c(e),c(t),n,o,i,a);return a.delete(e),l;case"[object Symbol]":if(ji)return ji.call(e)==ji.call(t)}return!1},_i=tn,xi=Object.prototype.hasOwnProperty;var Oi=it,ki=fi,Si=wi,Mi=function(e,t,r,n,o,i){var a=1&r,c=_i(e),u=c.length;if(u!=_i(t).length&&!a)return!1;for(var s=u;s--;){var l=c[s];if(!(a?l in t:xi.call(t,l)))return!1}var f=i.get(e),p=i.get(t);if(f&&p)return f==t&&p==e;var d=!0;i.set(e,t),i.set(t,e);for(var v=a;++s<u;){var h=e[l=c[s]],y=t[l];if(n)var g=a?n(y,h,l,t,e,i):n(h,y,l,e,t,i);if(!(void 0===g?h===y||o(h,y,r,n,i):g)){d=!1;break}v||(v="constructor"==l)}if(d&&!v){var m=e.constructor,b=t.constructor;m==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof m&&m instanceof m&&"function"==typeof b&&b instanceof b||(d=!1)}return i.delete(e),i.delete(t),d},Ci=Cn,Ai=At,Ei=Et,Pi=Zt,Ti="[object Arguments]",Wi="[object Array]",Bi="[object Object]",Ui=Object.prototype.hasOwnProperty;var zi=function(e,t,r,n,o,i){var a=Ai(e),c=Ai(t),u=a?Wi:Ci(e),s=c?Wi:Ci(t),l=(u=u==Ti?Bi:u)==Bi,f=(s=s==Ti?Bi:s)==Bi,p=u==s;if(p&&Ei(e)){if(!Ei(t))return!1;a=!0,l=!1}if(p&&!l)return i||(i=new Oi),a||Pi(e)?ki(e,t,r,n,o,i):Si(e,t,u,r,n,o,i);if(!(1&r)){var d=l&&Ui.call(e,"__wrapped__"),v=f&&Ui.call(t,"__wrapped__");if(d||v){var h=d?e.value():e,y=v?t.value():t;return i||(i=new Oi),o(h,y,r,n,i)}}return!!p&&(i||(i=new Oi),Mi(e,t,r,n,o,i))},Hi=bt;var Ni=function e(t,r,n,o,i){return t===r||(null==t||null==r||!Hi(t)&&!Hi(r)?t!=t&&r!=r:zi(t,r,n,o,e,i))},Di=it,Li=Ni;var Ii=V;var $i=function(e){return e==e&&!Ii(e)},Fi=$i,Ri=dr;var Zi=function(e,t){return function(r){return null!=r&&(r[e]===t&&(void 0!==t||e in Object(r)))}},Yi=function(e,t,r,n){var o=r.length,i=o,a=!n;if(null==e)return!i;for(e=Object(e);o--;){var c=r[o];if(a&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++o<i;){var u=(c=r[o])[0],s=e[u],l=c[1];if(a&&c[2]){if(void 0===s&&!(u in e))return!1}else{var f=new Di;if(n)var p=n(s,l,u,e,t,f);if(!(void 0===p?Li(l,s,3,n,f):p))return!1}}return!0},Vi=function(e){for(var t=Ri(e),r=t.length;r--;){var n=t[r],o=e[n];t[r]=[n,o,Fi(o)]}return t},qi=Zi;var Gi=function(e){var t=Vi(e);return 1==t.length&&t[0][2]?qi(t[0][0],t[0][1]):function(r){return r===e||Yi(r,e,t)}},Ji=Y,Xi=bt;var Ki=function(e){return"symbol"==typeof e||Xi(e)&&"[object Symbol]"==Ji(e)},Qi=At,ea=Ki,ta=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ra=/^\w*$/;var na=function(e,t){if(Qi(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!ea(e))||(ra.test(e)||!ta.test(e)||null!=t&&e in Object(t))},oa=qe;function ia(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var a=e.apply(this,n);return r.cache=i.set(o,a)||i,a};return r.cache=new(ia.Cache||oa),r}ia.Cache=oa;var aa=ia;var ca=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ua=/\\(\\)?/g,sa=function(e){var t=aa(e,(function(e){return 500===r.size&&r.clear(),e})),r=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ca,(function(e,r,n,o){t.push(n?o.replace(ua,"$1"):r||e)})),t})),la=ti,fa=At,pa=Ki,da=U?U.prototype:void 0,va=da?da.toString:void 0;var ha=function e(t){if("string"==typeof t)return t;if(fa(t))return la(t,e)+"";if(pa(t))return va?va.call(t):"";var r=t+"";return"0"==r&&1/t==-Infinity?"-0":r},ya=ha;var ga=function(e){return null==e?"":ya(e)},ma=At,ba=na,ja=sa,wa=ga;var _a=function(e,t){return ma(e)?e:ba(e,t)?[e]:ja(wa(e))},xa=Ki;var Oa=function(e){if("string"==typeof e||xa(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t},ka=_a,Sa=Oa;var Ma=function(e,t){for(var r=0,n=(t=ka(t,e)).length;null!=e&&r<n;)e=e[Sa(t[r++])];return r&&r==n?e:void 0},Ca=Ma;var Aa=function(e,t,r){var n=null==e?void 0:Ca(e,t);return void 0===n?r:n};var Ea=_a,Pa=Ct,Ta=At,Wa=Wt,Ba=Bt,Ua=Oa;var za=function(e,t){return null!=e&&t in Object(e)},Ha=function(e,t,r){for(var n=-1,o=(t=Ea(t,e)).length,i=!1;++n<o;){var a=Ua(t[n]);if(!(i=null!=e&&r(e,a)))break;e=e[a]}return i||++n!=o?i:!!(o=null==e?0:e.length)&&Ba(o)&&Wa(a,o)&&(Ta(e)||Pa(e))};var Na=function(e,t){return null!=e&&Ha(e,t,za)},Da=Ni,La=Aa,Ia=Na,$a=na,Fa=$i,Ra=Zi,Za=Oa;var Ya=Ma;var Va=function(e){return function(t){return null==t?void 0:t[e]}},qa=function(e){return function(t){return Ya(t,e)}},Ga=na,Ja=Oa;var Xa=Gi,Ka=function(e,t){return $a(e)&&Fa(t)?Ra(Za(e),t):function(r){var n=La(r,e);return void 0===n&&n===t?Ia(r,e):Da(t,n,3)}},Qa=Vo,ec=At,tc=function(e){return Ga(e)?Va(Ja(e)):qa(e)};var rc=function(e){return"function"==typeof e?e:null==e?Qa:"object"==typeof e?ec(e)?Ka(e[0],e[1]):Xa(e):tc(e)},nc=Yo,oc=sr;var ic=ti,ac=rc,cc=function(e,t){var r=-1,n=oc(e)?Array(e.length):[];return nc(e,(function(e,o,i){n[++r]=t(e,o,i)})),n},uc=At;var sc=function(e,t){return(uc(e)?ic:cc)(e,ac(t))},lc=Ct,fc=At,pc=U?U.isConcatSpreadable:void 0;var dc=Dr,vc=function(e){return fc(e)||lc(e)||!!(pc&&e&&e[pc])};var hc=function e(t,r,n,o,i){var a=-1,c=t.length;for(n||(n=vc),i||(i=[]);++a<c;){var u=t[a];r>0&&n(u)?r>1?e(u,r-1,n,o,i):dc(i,u):o||(i[i.length]=u)}return i},yc=Dr,gc=hc,mc=Ar,bc=At;var jc=function(){var e=arguments.length;if(!e)return[];for(var t=Array(e-1),r=arguments[0],n=e;n--;)t[n-1]=arguments[n];return yc(bc(r)?mc(r):[r],gc(t,1))},wc=Array.prototype.join;var _c=function(e,t){return null==e?"":wc.call(e,t)},xc=vt,Oc=_a,kc=Wt,Sc=V,Mc=Oa;var Cc=Ma,Ac=function(e,t,r,n){if(!Sc(e))return e;for(var o=-1,i=(t=Oc(t,e)).length,a=i-1,c=e;null!=c&&++o<i;){var u=Mc(t[o]),s=r;if("__proto__"===u||"constructor"===u||"prototype"===u)return e;if(o!=a){var l=c[u];void 0===(s=n?n(l,u,c):void 0)&&(s=Sc(l)?l:kc(t[o+1])?[]:{})}xc(c,u,s),c=c[u]}return e},Ec=_a;var Pc=function(e,t,r){for(var n=-1,o=t.length,i={};++n<o;){var a=t[n],c=Cc(e,a);r(c,a)&&Ac(i,Ec(a,e),c)}return i},Tc=Na;var Wc=function(e,t){return Pc(e,t,(function(t,r){return Tc(e,r)}))},Bc=hc;var Uc=function(e){return(null==e?0:e.length)?Bc(e,1):[]};var zc=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)},Hc=Math.max;var Nc=function(e,t,r){return t=Hc(void 0===t?e.length-1:t,0),function(){for(var n=arguments,o=-1,i=Hc(n.length-t,0),a=Array(i);++o<i;)a[o]=n[t+o];o=-1;for(var c=Array(t+1);++o<t;)c[o]=n[o];return c[t]=r(a),zc(e,this,c)}};var Dc=function(e){return function(){return e}},Lc=ut,Ic=Lc?function(e,t){return Lc(e,"toString",{configurable:!0,enumerable:!1,value:Dc(t),writable:!0})}:Vo,$c=Date.now;var Fc=function(e){var t=0,r=0;return function(){var n=$c(),o=16-(n-r);if(r=n,o>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}},Rc=Fc(Ic),Zc=Uc,Yc=Nc,Vc=Rc;var qc=Wc,Gc=function(e){return Vc(Yc(e,void 0,Zc),e+"")}((function(e,t){return null==e?{}:qc(e,t)}));function Jc(){let e,t,r=new Promise((function(){e=arguments[0],t=arguments[1]}));return r.resolve=e,r.reject=t,r}var Xc=/\s/;var Kc=function(e){for(var t=e.length;t--&&Xc.test(e.charAt(t)););return t},Qc=/^\s+/;var eu=function(e){return e?e.slice(0,Kc(e)+1).replace(Qc,""):e},tu=V,ru=Ki,nu=/^[-+]0x[0-9a-f]+$/i,ou=/^0b[01]+$/i,iu=/^0o[0-7]+$/i,au=parseInt;var cu=function(e){if("number"==typeof e)return e;if(ru(e))return NaN;if(tu(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=tu(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=eu(e);var r=ou.test(e);return r||iu.test(e)?au(e.slice(2),r?2:8):nu.test(e)?NaN:+e},uu=cu,su=1/0;var lu=function(e){return e?(e=uu(e))===su||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0},fu=lu;var pu=function(e){var t=fu(e),r=t%1;return t==t?r?t-r:t:0},du=pu;var vu=function(e){return"number"==typeof e&&e==du(e)};function hu(e){return"[object String]"===Object.prototype.toString.call(e)}function yu(e){return!(!hu(e)||""===e)}function gu(e){let t=!1;return yu(e)?t=!isNaN(Number(e)):function(e){return"[object Number]"===Object.prototype.toString.call(e)}(e)&&(t=!0),t}function mu(e){if(!gu(e))return 0;return lu(e)}function bu(e){return!!gu(e)&&(e=mu(e),vu(e))}var ju=pu,wu=cu,_u=ga,xu=B.isFinite,Ou=Math.min;var ku=function(e){var t=Math[e];return function(e,r){if(e=wu(e),(r=null==r?0:Ou(ju(r),292))&&xu(e)){var n=(_u(e)+"e").split("e"),o=t(n[0]+"e"+(+n[1]+r));return+((n=(_u(o)+"e").split("e"))[0]+"e"+(+n[1]-r))}return t(e)}}("round");function Su(e){if(!gu(e))return 0;e=mu(e);let t=ku(e);return"0"===String(t)?0:t}function Mu(e){if(!bu(e))return!1;return Su(e)>0}let Cu="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Au=Cu.length;function Eu(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,t=[];e=Mu(e)?Su(e):32;for(let r=0;r<e;r++)t[r]=Cu[0|Math.random()*Au];return t.join("")}function Pu(e){return"[object Object]"===Object.prototype.toString.call(e)}function Tu(e){if(Pu(e)){for(let t in e)return!0;return!1}return!1}function Wu(e,t){if(!yu(e))return"";if(!Tu(t))return"";let r=!1;return ei(t,(function(e,t){hu(e)||(r=!0)})),r?"":(ei(t,(function(t,r){e=function(e,t,r){if(!yu(e))return"";if(!yu(t))return"";if(!hu(r))return"";let n=new RegExp(t,"g");return String(e).replace(n,r)}(e,r,t)})),e)}function Bu(e,t){return!!Pu(e)&&(!(!yu(t)&&!gu(t))&&t in e)}function Uu(){return t().format("YYYY-MM-DDTHH:mm:ssZ")}function zu(e){return"[object Array]"===Object.prototype.toString.call(e)}function Hu(e){return!!function(e){return"[object Undefined]"===Object.prototype.toString.call(e)}(e)||(!!function(e){return"[object Null]"===Object.prototype.toString.call(e)}(e)||(!!function(e){if(Pu(e)){for(let t in e)return!1;return!0}return!1}(e)||(!!function(e){return!(!hu(e)||""!==e)}(e)||!!function(e){return!!zu(e)&&0===e.length}(e))))}function Nu(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"anyone";if(!yu(e))return!1;if("anyone"!==r&&"all"!==r)return!1;if(hu(t)){if(!yu(t))return!1;t=[t]}if(!zu(n=t)||0===n.length||1===n.length&&Hu(n[0]))return!1;var n;let o=!1;if(ei(t,(function(e){yu(e)||(o=!0)})),o)return!1;let i=0;return ei(t,(function(t){-1!==function(e,t){return e.indexOf(t)}(e,t)&&i++})),"anyone"===r?i>0:"all"===r&&i===t.length}function Du(e){let t=Object.prototype.toString.call(e);return"[object Function]"===t||"[object AsyncFunction]"===t}function Lu(e){if(!bu(e))return!1;return Su(e)>=0}function Iu(e,t){return yu(e)&&Lu(t)?0===(t=Su(t))?e:function(e,t){return yu(e)&&Lu(t)?0===(t=Su(t))?"":e.substring(0,t):""}(e,e.length-t):""}function $u(e,t){if(!yu(e))return"";if(!Lu(t))return"";if(0===(t=Su(t)))return"";let r=e.length-t;return r<0&&(r=0),e.substr(r,t)}function Fu(e){let t;return t=$u(e,1),"Z"===t?`${e=Iu(e,1)}+00:00`:e}let Ru={checkTZ:function(e){let t;return t=$u(e,1),"Z"===t||(t=$u(e,6),!!/[+|-]\d\d:\d\d/.test(t))},delTZ:function(e){let t;return t=$u(e,1),Iu(e,"Z"===t?1:6)},normTZ:Fu,sepTZ:function(e){let t=Fu(e);return{t:Iu(t,6),tz:$u(t,6)}}};function Zu(e){return!!yu(e)&&/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e)}var Yu={},Vu={get exports(){return Yu},set exports(e){Yu=e}};var qu,Gu={},Ju={get exports(){return Gu},set exports(e){Gu=e}},Xu=s(Object.freeze({__proto__:null,default:{}}));function Ku(){return qu||(qu=1,function(e,t){var r;e.exports=(r=r||function(e,t){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==c&&c.crypto&&(r=c.crypto),!r)try{r=Xu}catch(e){}var n=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),i={},a=i.lib={},u=a.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=a.WordArray=u.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:4*e.length},toString:function(e){return(e||f).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,o=e.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var a=r[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=a<<24-(n+i)%4*8}else for(var c=0;c<o;c+=4)t[n+c>>>2]=r[c>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new s.init(t,e)}}),l=i.enc={},f=l.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new s.init(r,t/2)}},p=l.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new s.init(r,t)}},d=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(p.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return p.parse(unescape(encodeURIComponent(e)))}},v=a.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,o=n.words,i=n.sigBytes,a=this.blockSize,c=i/(4*a),u=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*a,l=e.min(4*u,i);if(u){for(var f=0;f<u;f+=a)this._doProcessBlock(o,f);r=o.splice(0,u),n.sigBytes-=l}return new s.init(r,l)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});a.Hasher=v.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){v.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}});var h=i.algo={};return i}(Math),r)}(Ju)),Gu}var Qu,es={},ts={get exports(){return es},set exports(e){es=e}};!function(e,t){var r;e.exports=(r=Ku(),Qu||(Qu=1,function(e,t){var r,n,o,i,a,c,u;e.exports=(o=(n=u=Ku()).lib,i=o.Base,a=o.WordArray,(c=n.x64={}).Word=i.extend({init:function(e,t){this.high=e,this.low=t}}),c.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=t!=r?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],n=0;n<t;n++){var o=e[n];r.push(o.high),r.push(o.low)}return a.create(r,this.sigBytes)},clone:function(){for(var e=i.clone.call(this),t=e.words=this.words.slice(0),r=t.length,n=0;n<r;n++)t[n]=t[n].clone();return e}}),u)}(ts)),function(){var e=r,t=e.lib.Hasher,n=e.x64,o=n.Word,i=n.WordArray,a=e.algo;function c(){return o.create.apply(o,arguments)}var u=[c(1116352408,3609767458),c(1899447441,602891725),c(3049323471,3964484399),c(3921009573,2173295548),c(961987163,4081628472),c(1508970993,3053834265),c(2453635748,2937671579),c(2870763221,3664609560),c(3624381080,2734883394),c(310598401,1164996542),c(607225278,1323610764),c(1426881987,3590304994),c(1925078388,4068182383),c(2162078206,991336113),c(2614888103,633803317),c(3248222580,3479774868),c(3835390401,2666613458),c(4022224774,944711139),c(264347078,2341262773),c(604807628,2007800933),c(770255983,1495990901),c(1249150122,1856431235),c(1555081692,3175218132),c(1996064986,2198950837),c(2554220882,3999719339),c(2821834349,766784016),c(2952996808,2566594879),c(3210313671,3203337956),c(3336571891,1034457026),c(3584528711,2466948901),c(113926993,3758326383),c(338241895,168717936),c(666307205,1188179964),c(773529912,1546045734),c(1294757372,1522805485),c(1396182291,2643833823),c(1695183700,2343527390),c(1986661051,1014477480),c(2177026350,1206759142),c(2456956037,344077627),c(2730485921,1290863460),c(2820302411,3158454273),c(3259730800,3505952657),c(3345764771,106217008),c(3516065817,3606008344),c(3600352804,1432725776),c(4094571909,1467031594),c(275423344,851169720),c(430227734,3100823752),c(506948616,1363258195),c(659060556,3750685593),c(883997877,3785050280),c(958139571,3318307427),c(1322822218,3812723403),c(1537002063,2003034995),c(1747873779,3602036899),c(1955562222,1575990012),c(2024104815,1125592928),c(2227730452,2716904306),c(2361852424,442776044),c(2428436474,593698344),c(2756734187,3733110249),c(3204031479,2999351573),c(3329325298,3815920427),c(3391569614,3928383900),c(3515267271,566280711),c(3940187606,3454069534),c(4118630271,4000239992),c(116418474,1914138554),c(174292421,2731055270),c(289380356,3203993006),c(460393269,320620315),c(685471733,587496836),c(852142971,1086792851),c(1017036298,365543100),c(1126000580,2618297676),c(1288033470,3409855158),c(1501505948,4234509866),c(1607167915,987167468),c(1816402316,1246189591)],s=[];!function(){for(var e=0;e<80;e++)s[e]=c()}();var l=a.SHA512=t.extend({_doReset:function(){this._hash=new i.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],i=r[2],a=r[3],c=r[4],l=r[5],f=r[6],p=r[7],d=n.high,v=n.low,h=o.high,y=o.low,g=i.high,m=i.low,b=a.high,j=a.low,w=c.high,_=c.low,x=l.high,O=l.low,k=f.high,S=f.low,M=p.high,C=p.low,A=d,E=v,P=h,T=y,W=g,B=m,U=b,z=j,H=w,N=_,D=x,L=O,I=k,$=S,F=M,R=C,Z=0;Z<80;Z++){var Y,V,q=s[Z];if(Z<16)V=q.high=0|e[t+2*Z],Y=q.low=0|e[t+2*Z+1];else{var G=s[Z-15],J=G.high,X=G.low,K=(J>>>1|X<<31)^(J>>>8|X<<24)^J>>>7,Q=(X>>>1|J<<31)^(X>>>8|J<<24)^(X>>>7|J<<25),ee=s[Z-2],te=ee.high,re=ee.low,ne=(te>>>19|re<<13)^(te<<3|re>>>29)^te>>>6,oe=(re>>>19|te<<13)^(re<<3|te>>>29)^(re>>>6|te<<26),ie=s[Z-7],ae=ie.high,ce=ie.low,ue=s[Z-16],se=ue.high,le=ue.low;V=(V=(V=K+ae+((Y=Q+ce)>>>0<Q>>>0?1:0))+ne+((Y+=oe)>>>0<oe>>>0?1:0))+se+((Y+=le)>>>0<le>>>0?1:0),q.high=V,q.low=Y}var fe,pe=H&D^~H&I,de=N&L^~N&$,ve=A&P^A&W^P&W,he=E&T^E&B^T&B,ye=(A>>>28|E<<4)^(A<<30|E>>>2)^(A<<25|E>>>7),ge=(E>>>28|A<<4)^(E<<30|A>>>2)^(E<<25|A>>>7),me=(H>>>14|N<<18)^(H>>>18|N<<14)^(H<<23|N>>>9),be=(N>>>14|H<<18)^(N>>>18|H<<14)^(N<<23|H>>>9),je=u[Z],we=je.high,_e=je.low,xe=F+me+((fe=R+be)>>>0<R>>>0?1:0),Oe=ge+he;F=I,R=$,I=D,$=L,D=H,L=N,H=U+(xe=(xe=(xe=xe+pe+((fe+=de)>>>0<de>>>0?1:0))+we+((fe+=_e)>>>0<_e>>>0?1:0))+V+((fe+=Y)>>>0<Y>>>0?1:0))+((N=z+fe|0)>>>0<z>>>0?1:0)|0,U=W,z=B,W=P,B=T,P=A,T=E,A=xe+(ye+ve+(Oe>>>0<ge>>>0?1:0))+((E=fe+Oe|0)>>>0<fe>>>0?1:0)|0}v=n.low=v+E,n.high=d+A+(v>>>0<E>>>0?1:0),y=o.low=y+T,o.high=h+P+(y>>>0<T>>>0?1:0),m=i.low=m+B,i.high=g+W+(m>>>0<B>>>0?1:0),j=a.low=j+z,a.high=b+U+(j>>>0<z>>>0?1:0),_=c.low=_+N,c.high=w+H+(_>>>0<N>>>0?1:0),O=l.low=O+L,l.high=x+D+(O>>>0<L>>>0?1:0),S=f.low=S+$,f.high=k+I+(S>>>0<$>>>0?1:0),C=p.low=C+R,p.high=M+F+(C>>>0<R>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[30+(n+128>>>10<<5)]=Math.floor(r/4294967296),t[31+(n+128>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(l),e.HmacSHA512=t._createHmacHelper(l)}(),r.SHA512)}(Vu);var rs=Yu,ns={};!function(e,t){var r;e.exports=(r=Ku(),function(){var e=r,t=e.lib.WordArray;function n(e,r,n){for(var o=[],i=0,a=0;a<r;a++)if(a%4){var c=n[e.charCodeAt(a-1)]<<a%4*2|n[e.charCodeAt(a)]>>>6-a%4*2;o[i>>>2]|=c<<24-i%4*8,i++}return t.create(o,i)}e.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var o=[],i=0;i<r;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,c=0;c<4&&i+.75*c<r;c++)o.push(n.charAt(a>>>6*(3-c)&63));var u=n.charAt(64);if(u)for(;o.length%4;)o.push(u);return o.join("")},parse:function(e){var t=e.length,r=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<r.length;i++)o[r.charCodeAt(i)]=i}var a=r.charAt(64);if(a){var c=e.indexOf(a);-1!==c&&(t=c)}return n(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),r.enc.Base64)}({get exports(){return ns},set exports(e){ns=e}});var os=ns,is={};!function(e,t){e.exports=Ku().enc.Hex}({get exports(){return is},set exports(e){is=e}});var as=is,cs=Y,us=bt;var ss=function(e){return!0===e||!1===e||us(e)&&"[object Boolean]"==cs(e)};function ls(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!yu(e))return"";if(!ss(t))return"";let r=rs(e),n="";return n=t?r.toString(os):r.toString(as),n}function fs(e){return function(){let t=Jc(),r=null,n=null;try{r=e.apply(this,arguments)}catch(e){n=e}return null!==n?t.resolve({state:"error",msg:n}):!function(e){let t,r=Object.prototype.toString.call(e);if(t="[object Promise]"===r,t)return!0;if("[object Function]"!==r)return!1;try{t="function"!=typeof e.subscribe&&"function"==typeof e.then}catch(e){}return t}(r)?t.resolve({state:"success",msg:r}):r.then((function(e){t.resolve({state:"success",msg:e})})).catch((function(e){"cancelled"===Aa(e,"reason")?t.resolve({state:"cancelled",msg:""}):t.resolve({state:"error",msg:e})})),t}}var ps=function(e,t,r,n){for(var o=e.length,i=r+(n?1:-1);n?i--:++i<o;)if(t(e[i],i,e))return i;return-1},ds=function(e){return e!=e},vs=function(e,t,r){for(var n=r-1,o=e.length;++n<o;)if(e[n]===t)return n;return-1};var hs=function(e,t,r){return t==t?vs(e,t,r):ps(e,ds,r)};var ys=function(e,t){return!!(null==e?0:e.length)&&hs(e,t,0)>-1};var gs=function(e,t,r){for(var n=-1,o=null==e?0:e.length;++n<o;)if(r(t,e[n]))return!0;return!1};var ms=sn,bs=function(){},js=ms&&1/di(new ms([,-0]))[1]==1/0?function(e){return new ms(e)}:bs,ws=ai,_s=ys,xs=gs,Os=ci,ks=js,Ss=di;var Ms=rc,Cs=function(e,t,r){var n=-1,o=_s,i=e.length,a=!0,c=[],u=c;if(r)a=!1,o=xs;else if(i>=200){var s=t?null:ks(e);if(s)return Ss(s);a=!1,o=Os,u=new ws}else u=t?[]:c;e:for(;++n<i;){var l=e[n],f=t?t(l):l;if(l=r||0!==l?l:0,a&&f==f){for(var p=u.length;p--;)if(u[p]===f)continue e;t&&u.push(f),c.push(l)}else o(u,f,r)||(u!==c&&u.push(f),c.push(l))}return c};var As=function(e,t){return e&&e.length?Cs(e,Ms(t)):[]},Es=Ni;var Ps=function(e,t){return Es(e,t)};function Ts(e){let t=[],n=[];(e=Lo(e)).port||(e.port=8080),e.apiName||(e.apiName="api"),e.routes||(e.routes=[]);let o=[];async function i(t){let r=Aa(t,"token",""),n=await function(t){let r=Jc();return Du(e.authenticate)?e.authenticate(t).then((function(e){r.resolve(e)})):r.resolve(!0),r}(r);if(n){let n=Aa(t,"func",""),i=Aa(t,"input");if("getFuncs"===n)Du(e.filterFuncs)&&(o=await e.filterFuncs(r,o)),t.output={sys:"sys",funcs:o};else if(function(e,t){function r(e){return zu(e)?e:[e]}if(Hu(e))return!1;if(0===(e=r(e)).length)return!1;if(Hu(e))return!1;if(0===(t=r(t)).length)return!1;for(let r=0;r<e.length;r++)for(let n=0;n<t.length;n++)if(Ps(e[r],t[n]))return!0;return!1}(o,n)){let r=await e.funcs[n](i);t.output=r}else t.output={err:`can not find: ${n}`}}else t.output={err:`can not authenticate token: ${r}`};return delete t.input,JSON.stringify(t)}function a(t){if(Du(e.onClientChange)){let r=As(t,"clientId");Ps(n,r)||(n=r,e.onClientChange(n,e))}}Bu(e,"funcs")&&(o=dr(e.funcs));let c={path:"/"+e.apiName,method:"POST",options:{payload:{maxBytes:1048576e3,timeout:18e4,multipart:!0},timeout:{socket:3e5}},handler:function(e,r){let n=Jc(),o=Eu(),c=Aa(e.payload,"clientId"),u={headers:e.headers,info:e.info};return t.push({clientId:c,connId:o,data:u}),a(t),i(e.payload).then((function(e){n.resolve(e)})).catch((function(e){n.reject(e)})).finally((function(){t=t.filter((function(e){return e.connId!==o})),a(t)})),n}};e.serverHapi?e.serverHapi.route(c):async function(){let t=r.server({port:e.port,routes:{cors:!0}});t.route(c),ei(e.routes,(function(e){t.route(e)})),await t.start(),console.log(`Server running at: ${t.info.uri}`)}()}function Ws(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Jc(),r=Aa(e,"srcName","system by w-email"),o=Aa(e,"srcEmail","");if(!Zu(o))return t.reject("srcEmail is not email"),t;let i=Aa(e,"srcPW",""),a=Aa(e,"srcHost","smtp.gmail.com"),c=Aa(e,"srcPort",465),u=Aa(e,"emTitle",""),s=Aa(e,"emContent",""),l=Aa(e,"emAttachments",[]);Pu(l)&&(l=[l]);let f=Aa(e,"toEmails",[]);hu(f)&&(f=[f]);let p=Aa(e,"toEmailsCC",[]);hu(p)&&(p=[p]);let d=Aa(e,"toEmailsBCC",[]);hu(d)&&(d=[d]);let v=n.createTransport({host:a,port:c,auth:{user:o,pass:i},secure:465===c}),h={from:`${r} <${o}>`,to:f.join(","),cc:p.join(","),bcc:d.join(","),subject:u,html:s,attachments:l};return v.sendMail(h,(function(e,r){e?t.reject(e):t.resolve(r.response)})),t}function Bs(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Us(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Bs(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bs(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function zs(e){return e.format("YYYY-MM-DDTHH:mm:ssZ")}function Hs(){return{state:"success",msg:arguments.length>0&&void 0!==arguments[0]?arguments[0]:null}}function Ns(){return{state:"error",msg:arguments.length>0&&void 0!==arguments[0]?arguments[0]:null}}let Ds="general",Ls="yes",Is=["<",">"];return function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=new e.EventEmitter;function o(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];setTimeout((()=>{n.emit(e,...r),n.emit("all",{eventName:e,data:[...r]})}),1)}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(){let r=Jc(),n=Lo(arguments);function i(e){t&&o(t,{input:n,output:e})}return e.apply(this,arguments).then((function(e){i(e),r.resolve(e)})).catch((function(e){i(e),r.resolve(e)})),r}}if(r=Lo(r),Mu(r.port)||(r.port=8080),yu(r.apiName)||(r.apiName="api"),yu(r.authUrl)||(r.authUrl="http://localhost:8080/auth"),yu(r.salt)||(r.salt=""),Mu(r.timeTokenExp)||(r.timeTokenExp=30),yu(r.webName)||(r.webName=""),yu(r.webUrl)||(r.webUrl=""),yu(r.webDescription)||(r.webDescription=""),yu(r.emSenderName)||(r.emSenderName="WUserServer"),!yu(r.emSenderEmail))return console.log("invalid emSenderEmail"),n;yu(r.emSenderPW)||(r.emSenderPW=""),yu(r.emBCC)||(r.emBCC=""),yu(r.emLetterHtml)||(r.emLetterHtml='<table style="width:100%;">\n<tbody>\n\n<tr style="display:none;">\n    <td>\n        {emMessage}\n    </td>\n</tr>\n\n<tr>\n    <td style="padding:30px; font-family:\'Microsoft JhengHei\'; background-color:#666; text-align:center;">\n        <a style="color:#aaffff; font-size:24pt; text-decoration:none;" href="{emWebUrl}" target="_blank">{emWebName}</a>\n        <p style="margin:10px 0px 0px 0px; color:#eee; font-size:12pt;">\n            {emWebDescription}\n        </p>\n    </td>\n</tr>\n\n<tr>\n    <td style="padding:20px; font-family:\'Microsoft JhengHei\';">\n        <p style="">{emMessage}</p>\n    </td>\n</tr>\n\n<tr>\n    <td style="padding:20px; font-family:\'Microsoft JhengHei\'; background-color:#f5f5f5; text-align:center;">\n        <p style="color:#f26; font-size:11pt;">【{emLetterDoNotReplayMessage}】</p>\n        <p style="">{emLetterTeamMessage}</p>\n        <p style="padding:1em 0px 0px 0px; color:#aaa;">{emLetterLinks}</p>\n    </td>\n</tr>\n\n</tbody>\n</table>'),yu(r.emLetterTeamMessage)||(r.emLetterTeamMessage="Global-User International Company"),yu(r.emLetterDoNotReplayMessage)||(r.emLetterDoNotReplayMessage="This letter is automatically sent by the system, please do not reply to this email."),zu(r.emLetterLinks)||(r.emLetterLinks=[]),yu(r.emSignUpTitle)||(r.emSignUpTitle="Verification letter"),yu(r.emSignUpHtml)||(r.emSignUpHtml='<p>Dear {name} :</p>\n\n<p>Your registration request has been received. Please click the link below to verify your account.</p>\n\n<p><a href="{urlCheckCode}" target="_blank">Confirm Account</a></p>'),yu(r.emResetPWTitle)||(r.emResetPWTitle="Password reset letter"),yu(r.emResetPWHtml)||(r.emResetPWHtml='<p>Dear {name} :</p>\n\n<p>You have received your change password request. Please click the link below to verify your account.</p>\n\n<p><a href="{urlCheckCode}" target="_blank">Confirm Account</a></p>'),yu(r.verifyWebHtml)||(r.verifyWebHtml='<!DOCTYPE html>\n<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-tw">\n\n    <head>\n        <meta http-equiv="content-type" content="text/html charset=UTF-8" />\n        <title>{rdWebName}</title>\n\n        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.slim.js"><\/script>\n\n    </head>\n\n    <body style="padding:0; margin:0;">\n    \n        <div style="display:flex; align-items:center; justify-content:center;">\n            \n            <div style="padding:30px; font-family:\'Microsoft JhengHei\';">\n            \n                <div style="margin:10px 0px 20px 0px; display:flex; align-items:center;">\n\n                    <div style="margin-right:10px;">\n                        {rdLogo}\n                    </div>\n\n                    <div style="margin:-5px 0px 0px 0px;">\n                        <div style="margin:0px 0px 0px 0px; font-size:12pt; color:#999;">Single Sign-On</div>\n                        <div style="margin:-3px 0px 0px 0px; font-size:24pt;">{rdWebName}</div>\n                    </div>\n\n                </div>\n    \n                <div style="padding:20px; text-align:center; background-color:#fee; border-radius:10px;">\n\n                    <div style="">{rdMessage}</div>\n    \n                    <div id="cd" style="margin:10px 0px 0px 0px; font-size:10pt; color:#999; display:none;"></div>\n\n                </div>\n                \n            </div>\n            \n        </div>\n        \n        <script>\n\n            function countdown() {\n                $(\'#cd\').show()\n                let n = 5\n                let tmp = \'{rdCountdownMessage}\'\n                $(\'#cd\').text(tmp.replace(\'{s}\', n))\n                setInterval(function() {\n                    n -= 1\n                    if (n<=0) {\n                        window.location.href = \'{rdWebUrl}\'\n                    }\n                    $(\'#cd\').text(tmp.replace(\'{s}\', n))\n                }, 1000)\n            }\n            if ({rdCountdown}) {\n                countdown()\n            }\n\n        <\/script>\n\n    </body>\n\n</html>'),yu(r.verifyWebLogo)||(r.verifyWebLogo='<svg width="64" height="64" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><defs><style>.cls-1{fill:#c8da52;}.cls-2{fill:#995f5b;}</style></defs><title/><path class="cls-1" d="M23.85,38.78c9.63-2,15,2.07,16.22,8.17S38,58.88,28.4,60.86,5.33,54.71,5.21,54.13,14.23,40.76,23.85,38.78Z"/><path class="cls-1" d="M45.72,18.87C51.31,27,49.66,33.45,44.54,37s-11.78,2.78-17.36-5.3S23.83,8,24.31,7.7,40.14,10.78,45.72,18.87Z"/><path class="cls-1" d="M72.6,31.21c-5.26,8.3-11.88,9.33-17.14,6s-7.16-9.75-1.9-18.05,20.45-12.32,21-12S77.86,22.91,72.6,31.21Z"/><path class="cls-1" d="M71.73,60.78c-9.69-1.6-13.22-7.3-12.21-13.44s6.19-10.4,15.88-8.8,19.33,14,19.24,14.59S81.43,62.38,71.73,60.78Z"/><path class="cls-2" d="M57.46,43.08a1,1,0,0,0-1.41-1.41l-6.22,6.21-6.21-6.21a1,1,0,0,0-1.41,1.41l6.62,6.63v5.08l-5.21-5.21A1,1,0,1,0,42.21,51l6.62,6.63V93.78a1,1,0,0,0,2,0V57.62L57.46,51a1,1,0,0,0-1.41-1.41l-5.22,5.21V49.71Z"/><path class="cls-2" d="M75.86,78.39a1,1,0,0,0-1,1V93.78a1,1,0,0,0,2,0V79.39A1,1,0,0,0,75.86,78.39Z"/><path class="cls-1" d="M65.37,77.4c3.88-.8,6,.83,6.53,3.28s-.83,4.8-4.7,5.6-9.28-2.48-9.32-2.71S61.5,78.2,65.37,77.4Z"/><path class="cls-1" d="M74.17,69.39c2.25,3.25,1.58,5.86-.48,7.29s-4.73,1.11-7-2.14S65.36,65,65.56,64.9,71.92,66.14,74.17,69.39Z"/><path class="cls-1" d="M85,74.35c-2.11,3.34-4.78,3.75-6.89,2.41s-2.88-3.92-.77-7.26,8.23-5,8.43-4.83S87.1,71,85,74.35Z"/><path class="cls-1" d="M84.63,86.25c-3.9-.65-5.32-2.94-4.91-5.41s2.49-4.18,6.39-3.54,7.78,5.64,7.74,5.87S88.53,86.89,84.63,86.25Z"/></svg>'),yu(r.verifyWebMsgSuccess)||(r.verifyWebMsgSuccess="Verify successfully"),yu(r.verifyWebMsgExpired)||(r.verifyWebMsgExpired="Code has expired"),yu(r.verifyWebMsgCount)||(r.verifyWebMsgCount="Go to the website automatically after {s} seconds..."),Pu(r.funcs)||(r.funcs={}),zu(r.routes)||(r.routes=[]);let a=Du(Aa(r,"orm.select",null)),c=Du(Aa(r,"orm.insert",null)),u=Du(Aa(r,"orm.save",null));if(!a||!c||!u)return console.log("invalid orm"),n;let s=r.orm,l={id:{type:"String",public:!0,necessary:!0,exclude:[],canModify:!1},name:{type:"String",public:!0,necessary:!1,exclude:Is,canModify:!0},pwEnc:{type:"String",public:!1,necessary:!0,exclude:[],canModify:!1},email:{type:"String",public:!0,necessary:!0,exclude:Is,canModify:!0},address:{type:"String",public:!0,necessary:!1,exclude:Is,canModify:!0},phone:{type:"String",public:!0,necessary:!1,exclude:Is,canModify:!0},organization:{type:"String",public:!0,necessary:!1,exclude:Is,canModify:!0},position:{type:"String",public:!0,necessary:!1,exclude:Is,canModify:!0},role:{type:"String",public:!0,necessary:!0,exclude:Is,canModify:!1},checkCode:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},token:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},tokenExp:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},timeCreate:{type:"String",public:!1,necessary:!0,exclude:[],canModify:!1},timeLogin:{type:"String",public:!1,necessary:!1,exclude:[],canModify:!1},remark:{type:"String",public:!0,necessary:!1,exclude:[],canModify:!0},active:{type:"String",public:!1,necessary:!0,exclude:[],canModify:!1}},f=fs(s.save);function p(e){return ei(e,(function(e,t){let r=function(e,t){if(Bu(l,e)){let r=l[e].type,n=l[e].exclude;return"String"===r?hu(t)?Nu(t,n)?Ns('can not contain special characters: "<" or ">"'):Hs():Ns("value is not string: "+t):"Object"===r?Pu(t)?Hs():Ns("value is not object: "+t):Ns("type is not defined: "+r)}return Ns("invalid key: "+e)}(t,e);if("error"===r.state)return r})),Hs()}let d=fs((async function(e){let{token:t,find:r}=e,n=Jc(),o=null;return o=await O(t),"error"===o.state?(n.reject(o.msg),n):(s.select(r).then((function(e){if(e.length>=1){let t=e,r=[];ei(l,(function(e,t){e.public&&r.push(t)})),t=sc(t,(function(e){return Gc(e,r)})),n.resolve(t)}else n.reject("can not find user")})).catch((function(e){console.log("selectPublic catch:",e,"find:",r),n.reject("error")})),n)})),v=fs((async function(e){let t=Jc(),n=null;return yu(e.pwEnc)?Zu(e.email)?await function(e){let t=Jc();if(!Tu(e))return t.reject("invalid find"),t;return s.select(e).then((function(e){e.length>=1?t.resolve(!0):t.resolve(!1)})).catch((function(r){console.log("select catch:",r,"find:",e),t.reject("error")})),t}({email:e.email})?(t.reject("email has been used"),t):(n=p(e),"error"===n.state?(t.reject(n.msg),t):(o=e,ei(l,(function(e,t){let r="";"Object"===e.type&&(r={}),Bu(o,t)&&null!==o[t]&&void 0!==o[t]||(o[t]=r)})),(e=o).id=Eu(),""!==r.salt&&(e.pwEnc=ls(e.pwEnc+r.salt)),e.checkCode=Eu(),e.timeCreate=Uu(),e.role=Ds,e.active=Ls,s.insert(e).then((function(r){t.resolve({id:e.id,checkCode:e.checkCode})})).catch((function(r){console.log("insert catch:",r,"user:",e),t.reject("error")})),t)):(t.reject("invalid email"),t):(t.reject("invalid password"),t);var o}));function h(e){let t=Jc();return s.select(e).then((function(e){1===e.length?t.resolve(e[0]):e.length>1?t.reject(`find ${e.length} users`):t.reject("can not find user")})).catch((function(r){console.log("selectOne catch:",r,"find:",e),t.reject("error")})),t}let y=fs(h),g=fs((async function(e){let t=Jc(),n=null;if(n=await v(e),"error"===n.state)return t.reject(n.msg),t;let o=n.msg.id;e.id=o;let i=n.msg.checkCode;e.checkCode=i;let a=`${r.authUrl}?checkCode=${i}`;return n=await E(e.name,a,e.email),"error"===n.state?(console.log("signUp catch:",n.msg,"emailObj:",{name:e.name,urlCheckCode:a,email:e.email}),t.reject("can not send email"),t):(t.resolve(e.id),t)})),m=fs((async function(e){let{email:n,pwEnc:o}=e,i=Jc(),a=null;if(!yu(n))return i.reject("invalid email"),i;if(!yu(o))return i.reject("invalid password"),i;let c={email:n};if(a=await y(c),"error"===a.state)return console.log("logIn catch:",a.msg,"find:",c),i.reject("email or password is incorrect"),i;let u=a.msg;if(""!==u.checkCode)return i.reject("account is not verified"),i;if(""!==r.salt&&(o=ls(o+r.salt)),u.pwEnc!==o)return i.reject("email or password is incorrect"),i;if(u.active!==Ls)return i.reject("account is suspended"),i;if(a=await O(u.token),"success"===a.state)return i.resolve(u.token),i;let s=Eu(),l={id:u.id,token:s,tokenExp:zs(t().add(r.timeTokenExp,"minute")),timeLogin:Uu()};return a=await f(l),"error"===a.state?(console.log("logIn catch:",a.msg,"userModify:",l),i.reject("can not save token"),i):(i.resolve(s),i)})),b=fs((async function(e){let t=Jc(),r=null;if(!yu(e))return t.reject("invalid token"),t;let n={token:e};if(r=await y(n),"error"===r.state)return console.log("logOut catch:",r.msg,"find:",n),t.reject("invalid token"),t;let o={id:r.msg.id,token:"",tokenExp:""};return r=await f(o),"error"===r.state?(console.log("logOut catch:",r.msg,"userModify:",o),t.reject("can not update token"),t):(t.resolve("ok"),t)}));function j(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"false",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=r.verifyWebHtml;return o=Wu(o,{"{rdWebName}":r.webName,"{rdWebDescription}":r.webDescription,"{rdWebUrl}":r.webUrl,"{rdLogo}":r.verifyWebLogo,"{rdMessage}":e,"{rdCountdown}":t,"{rdCountdownMessage}":n}),o}function w(e){let t=Jc(),n=r.verifyWebMsgCount;return function(e){let t=Jc();if(!yu(e))return t.reject(r.verifyWebMsgExpired),t;let n={checkCode:e};return h(n).then((function(e){let t={id:e.id,checkCode:""};return s.save(t)})).then((function(e){t.resolve(r.verifyWebMsgSuccess)})).catch((function(e){console.log("verifyCheckCode catch:",e,"find:",n),t.reject(r.verifyWebMsgExpired)})),t}(e).then((function(r){o("verifyCheckCodeAndGetHtml",{state:"success",msg:r,checkCode:e}),t.resolve(j(r,"true",n))})).catch((function(r){o("verifyCheckCodeAndGetHtml",{state:"error",msg:r,checkCode:e}),t.resolve(j(r,"false",""))})),t}function _(e){let n=Jc();if(function(e){if(!yu(e))return!1;if(!Ru.checkTZ(e))return!1;let r=Ru.delTZ(e),n="YYYY-MM-DDTHH:mm:ss";return r===t(r,n).format(n)}(e)){let o=t(),i=t(e,"YYYY-MM-DDTHH:mm:ssZ").diff(o,"minute");i>0?n.resolve("ok"):i>r.timeTokenExp?(console.log("verifyTokenExp error:","iMinutes="+i,">","timeTokenExp="+r.timeTokenExp),n.reject("invalid tokenExp")):n.reject("token expired")}else n.reject("no expire time for token");return n}let x=fs(_),O=fs((async function(e){let t=Jc(),r=null;if(!yu(e))return t.reject("invalid token"),t;let n={token:e};if(r=await y(n),"error"===r.state)return console.log("isValidToken catch:",r.msg,"find:",n),t.reject("invalid token"),t;let o=r.msg;return r=x(o.tokenExp),"error"===r.state?(t.reject(r.msg),t):(t.resolve("ok"),t)})),k=fs((async function(e){let n=Jc(),o=null;if(!yu(e))return n.reject("invalid token"),n;let i={token:e};if(o=await y(i),"error"===o.state)return console.log("refreshTokenExp catch:",o.msg,"find:",i),n.reject("invalid token"),n;let a=o.msg;if(o=_(a.tokenExp),"error"===o.state)return n.reject(o.err),n;let c={id:a.id,tokenExp:zs(t().add(r.timeTokenExp,"minute"))};return o=await f(c),"error"===o.state?(console.log("refreshTokenExp catch:",o.msg,"userModify:",c),n.reject("can not update token"),n):(n.resolve("ok"),n)})),S=fs((async function(e){let{email:t,pwEnc:n,pwEncNew:o}=e,i=Jc(),a=null;if(!yu(t))return i.reject("invalid email"),i;if(!yu(n))return i.reject("invalid old password"),i;if(!yu(o))return i.reject("invalid new password"),i;let c={email:t};if(a=await y(c),"error"===a.state)return console.log("changePW catch:",a.msg,"find:",c),i.reject("email or password is incorrect"),i;let u=a.msg;if(""!==u.checkCode)return i.reject("account is not verified"),i;if(u.active!==Ls)return i.reject("account is suspended"),i;if(""!==r.salt&&(n=ls(n+r.salt),o=ls(o+r.salt)),u.pwEnc!==n)return i.reject("email or password is incorrect"),i;let s={id:u.id,pwEnc:o};return a=await f(s),"error"===a.state?(console.log("changePW catch:",a.msg,"userModify:",s),i.reject("can not update password"),i):(i.resolve("ok"),i)})),M=fs((async function(e){let{email:t,pwEncNew:n}=e,o=Jc(),i=null;if(!yu(t))return o.reject("invalid email"),o;if(!yu(n))return o.reject("invalid new password"),o;let a={email:t};if(i=await y(a),"error"===i.state)return console.log("resetPW catch:",i.msg,"find:",a),o.reject("email is incorrect"),o;let c=i.msg;if(c.active!==Ls)return o.reject("account is suspended"),o;""!==r.salt&&(n=ls(n+r.salt));let u=Eu(),s={id:c.id,pwEnc:n,checkCode:u};if(i=await f(s),"error"===i.state)return console.log("resetPW catch:",i.msg,"userModify:",s),o.reject("can not update password"),o;let l=`${r.authUrl}?checkCode=${u}`;return i=await P(c.name,l,c.email),"error"===i.state?(console.log("resetPW catch:",i.msg,"emailObj:",{name:c.name,urlCheckCode:l,email:c.email}),o.reject("can not send email"),o):(o.resolve("ok"),o)})),C=fs((async function(e){let{token:t,user:r}=e,n=Jc(),o=null;if(o=await O(t),"error"===o.state)return n.reject(o.msg),n;if(o=p(r),"error"===o.state)return n.reject(o.msg),n;let i=await async function(e){let t=Jc(),r=null,n={token:e};if(r=await y(n),"error"===r.state)return console.log("getUserFromToken catch:",r.msg,"find:",n),t.reject("invalid token"),t;let o=r.msg;return t.resolve(o),t}(t),a={id:i.id},c=!1;return ei(l,(function(e,t){e.canModify&&r[t]&&i[t]!==r[t]&&(c=!0,a[t]=r[t])})),c?(o=await f(a),"error"===o.state?(console.log("modifyInfor catch:",o.msg,"userModify:",a),n.reject("can not modify"),n):(n.resolve("ok"),n)):(n.resolve("no change"),n)}));function A(e,t,n,o,i){let a=r.emLetterHtml,c=r.webName,u=r.webUrl,s=r.emLetterLinks;return""!==c&&""!==u&&(s=jc({name:c,url:u},s)),s=sc(s,(function(e){let t=Aa(e,"name","");return`<a style="text-decoration:none" href="${Aa(e,"url","")}" target="_blank" >${t}</a>`})),s=`| ${_c(s," | ")} |`,a=Wu(a,{"{emMessage}":t,"{emWebName}":c,"{emWebUrl}":u,"{emWebDescription}":r.webDescription,"{emLetterDoNotReplayMessage}":r.emLetterDoNotReplayMessage,"{emLetterTeamMessage}":r.emLetterTeamMessage,"{emLetterLinks}":s}),function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return new Ws({srcName:r.emSenderName,srcEmail:r.emSenderEmail,srcPW:r.emSenderPW,emTitle:e,emContent:t,toEmails:n,toEmailsCC:o,toEmailsBCC:i})}(e,a,n,o,i)}let E=fs((function(e,t,n){let o=r.emSignUpTitle,i=r.emSignUpHtml;return i=Wu(i,{"{name}":e,"{urlCheckCode}":t}),A(o,i,n,[],r.emBCC)})),P=fs((function(e,t,n){let o=r.emResetPWTitle,i=r.emResetPWHtml;return i=Wu(i,{"{name}":e,"{urlCheckCode}":t}),A(o,i,n,[],r.emBCC)})),T={select:function(e){return i(d,"selectPublic")(e)},signUp:function(e){return i(g,"signUp")(e)},logIn:function(e){return i(m,"logIn")(e)},refreshTokenExp:function(e){return i(k,"refreshTokenExp")(e)},isValidToken:function(e){return i(O,"isValidToken")(e)},logOut:function(e){return i(b,"logOut")(e)},changePW:function(e){return i(S,"changePW")(e)},resetPW:function(e){return i(M,"resetPW")(e)},modifyInfor:function(e){return i(C,"modifyInfor")(e)}};ei(r.funcs,(function(e,t){Bu(T,t)?console.log("invalid func: "+t):T[t]=r.funcs[t]}));let W=[{method:"GET",path:"/auth",handler:async function(e,t){return w(e.query.checkCode)}}];return ei(r.routes,(function(e){W.push(e)})),r=Us(Us({},r),{},{onClientChange:function(e,t){o("clientChange",e.length,e)},funcs:T,routes:W}),new Ts(r),n}}));
//# sourceMappingURL=w-user-server.umd.js.map
